<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscription Platform DApp</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #22d3ee;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f3f4f6;
            --border: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            color: var(--dark);
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .network-selector {
            position: relative;
        }

        .network-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-top: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 250px;
            display: none;
        }

        .network-dropdown.active {
            display: block;
        }

        .network-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .network-item:hover {
            background: var(--light);
        }

        .network-item.active {
            background: #eef2ff;
            color: var(--primary);
        }

        .add-network-btn {
            padding: 12px 15px;
            border-top: 1px solid var(--border);
            color: var(--primary);
            cursor: pointer;
            font-weight: 500;
            text-align: center;
        }

        .add-network-btn:hover {
            background: var(--light);
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--light);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .wallet-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #eef2ff;
            border-radius: 8px;
            color: var(--primary);
            font-weight: 500;
        }

        .wallet-status.connected {
            background: #d1fae5;
            color: var(--success);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .role-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .role-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: transparent;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: var(--dark);
        }

        .role-tab:hover {
            background: var(--light);
        }

        .role-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .role-content {
            display: none;
        }

        .role-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
            font-size: 14px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background: #fafafa;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: var(--success);
        }

        .badge-warning {
            background: #fed7aa;
            color: var(--warning);
        }

        .badge-danger {
            background: #fee2e2;
            color: var(--danger);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: var(--dark);
        }

        .tier-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .tier-card {
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .tier-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .tier-card.selected {
            border-color: var(--primary);
            background: #eef2ff;
        }

        .tier-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .tier-price {
            color: var(--primary);
            font-size: 20px;
            font-weight: 700;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--dark);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideUp 0.3s;
            z-index: 3000;
        }

        .toast.show {
            display: block;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .role-tabs {
                flex-direction: column;
            }

            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <span>🚀</span>
                <span id="appTitle">订阅平台 DApp</span>
            </h1>
            <div class="header-controls">
                <!-- Language Switcher -->
                <button class="btn-secondary" onclick="toggleLanguage()">
                    <span id="langBtn">🇨🇳 中文</span>
                </button>

                <!-- Network Selector -->
                <div class="network-selector">
                    <button class="btn-secondary" onclick="toggleNetworkDropdown()">
                        <span>⛓️</span>
                        <span id="currentNetwork">选择网络</span>
                        <span>▼</span>
                    </button>
                    <div class="network-dropdown" id="networkDropdown">
                        <div class="network-item" onclick="selectNetwork('1', 'Ethereum Mainnet')">
                            <span>Ethereum Mainnet</span>
                            <span style="display: flex; gap: 5px;">
                                <span style="cursor: pointer;"
                                    onclick="event.stopPropagation(); viewNetworkDetails('1')" title="查看详情">👁️</span>
                                <span>🟢</span>
                            </span>
                        </div>
                        <div class="network-item" onclick="selectNetwork('11155111', 'Sepolia Testnet')">
                            <span>Sepolia Testnet</span>
                            <span style="display: flex; gap: 5px;">
                                <span style="cursor: pointer;"
                                    onclick="event.stopPropagation(); viewNetworkDetails('11155111')"
                                    title="查看详情">👁️</span>
                                <span>🟡</span>
                            </span>
                        </div>
                        <div class="network-item" onclick="selectNetwork('137', 'Polygon')">
                            <span>Polygon</span>
                            <span style="display: flex; gap: 5px;">
                                <span style="cursor: pointer;"
                                    onclick="event.stopPropagation(); viewNetworkDetails('137')" title="查看详情">👁️</span>
                                <span>🟣</span>
                            </span>
                        </div>
                        <div class="network-item" onclick="selectNetwork('56', 'BSC')">
                            <span>BSC</span>
                            <span style="display: flex; gap: 5px;">
                                <span style="cursor: pointer;"
                                    onclick="event.stopPropagation(); viewNetworkDetails('56')" title="查看详情">👁️</span>
                                <span>🟡</span>
                            </span>
                        </div>
                        <div class="network-item" onclick="selectNetwork('42161', 'Arbitrum One')">
                            <span>Arbitrum One</span>
                            <span style="display: flex; gap: 5px;">
                                <span style="cursor: pointer;"
                                    onclick="event.stopPropagation(); viewNetworkDetails('42161')"
                                    title="查看详情">👁️</span>
                                <span>🔵</span>
                            </span>
                        </div>
                        <div class="network-item" onclick="selectNetwork('10', 'Optimism')">
                            <span>Optimism</span>
                            <span style="display: flex; gap: 5px;">
                                <span style="cursor: pointer;"
                                    onclick="event.stopPropagation(); viewNetworkDetails('10')" title="查看详情">👁️</span>
                                <span>🔴</span>
                            </span>
                        </div>
                        <div class="network-item" onclick="selectNetwork('8453', 'Base')">
                            <span>Base</span>
                            <span style="display: flex; gap: 5px;">
                                <span style="cursor: pointer;"
                                    onclick="event.stopPropagation(); viewNetworkDetails('8453')"
                                    title="查看详情">👁️</span>
                                <span>🔵</span>
                            </span>
                        </div>
                        <div class="add-network-btn" onclick="showAddNetworkModal()">
                            + 添加自定义网络
                        </div>
                    </div>
                </div>

                <!-- Wallet Status -->
                <div class="wallet-status" id="walletStatus">
                    <span class="status-dot"></span>
                    <span id="walletText">未连接</span>
                </div>

                <!-- Connect Wallet Button -->
                <button class="btn-primary" id="connectBtn">
                    <span>🦊</span>
                    <span id="connectBtnText">连接钱包</span>
                </button>
            </div>
        </div>

        <!-- Global Factory Connection Card -->
        <div class="card" style="margin: 20px auto;  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">🏭</span>
                    <h3 style="margin: 0;">
                        <span class="text" data-zh="Factory 合约" data-en="Factory Contract">Factory 合约</span>
                    </h3>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; flex: 1; max-width: 600px;">
                    <input type="text" class="form-input" id="globalFactoryAddress" placeholder="0x..."
                        style="flex: 1; margin: 0;">
                    <button class="btn-primary" onclick="connectGlobalFactory()" style="white-space: nowrap;">
                        <span class="text" data-zh="连接" data-en="Connect">连接</span>
                    </button>
                </div>
                <div id="globalFactoryStatus" style="display: flex; align-items: center; gap: 10px;">
                    <span id="globalFactoryConnectionStatus" style="color: #666;"></span>
                </div>
            </div>
            <!-- Factory Info Display -->
            <div id="globalFactoryInfo" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <span class="text" data-zh="创建费用: " data-en="Creation Fee: " style="color: #666;">创建费用：</span>
                        <span id="globalCreationFee" style="font-weight: bold;">-</span>
                    </div>
                    <div>
                        <span class="text" data-zh="平台费率: " data-en="Platform Fee: " style="color: #666;">平台费率：</span>
                        <span id="globalPlatformFee" style="font-weight: bold;">-</span>
                    </div>
                    <div>
                        <span class="text" data-zh="项目总数: " data-en="Total Projects: " style="color: #666;">项目总数：</span>
                        <span id="globalProjectCount" style="font-weight: bold;">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Role Tabs -->
        <div class="role-tabs">
            <button class="role-tab active" onclick="switchRole('platform', event)">
                <span>🏢</span>
                <span class="role-text" data-zh="平台管理" data-en="Platform">平台管理</span>
            </button>
            <button class="role-tab" onclick="switchRole('project', event)">
                <span>💼</span>
                <span class="role-text" data-zh="项目方" data-en="Project Owner">项目方</span>
            </button>
            <button class="role-tab" onclick="switchRole('referrer', event)">
                <span>📢</span>
                <span class="role-text" data-zh="推广员" data-en="Referrer">推广员</span>
            </button>
            <button class="role-tab" onclick="switchRole('subscriber', event)">
                <span>👤</span>
                <span class="role-text" data-zh="订阅者" data-en="Subscriber">订阅者</span>
            </button>
        </div>

        <!-- Platform Content -->
        <div id="platform-content" class="role-content active">
            <!-- Deploy Contracts Card -->
            <div class="card">
                <h3 class="card-title">
                    <span>🚀</span>
                    <span class="text" data-zh="部署合约" data-en="Deploy Contracts">部署合约</span>
                </h3>

                <!-- Deploy Project Implementation -->
                <div class="card" style="background: #f8f9fa; margin-bottom: 20px;">
                    <h4 class="text" data-zh="步骤 1: 部署 Project 实现合约" data-en="Step 1: Deploy Project Implementation">步骤
                        1: 部署 Project 实现合约</h4>
                    <button class="btn-primary" onclick="deployProjectImplementation()">
                        <span class="text" data-zh="部署 Project 实现合约" data-en="Deploy Project Implementation">部署 Project
                            实现合约</span>
                    </button>
                    <div class="form-group" style="margin-top: 10px;">
                        <input type="text" class="form-input" id="projectImplAddress"
                            placeholder="Project 实现合约地址 (自动填充)" readonly>
                    </div>
                </div>

                <!-- Deploy Factory -->
                <div class="card" style="background: #f8f9fa;">
                    <h4 class="text" data-zh="步骤 2: 部署 Factory 合约" data-en="Step 2: Deploy Factory Contract">步骤 2: 部署
                        Factory 合约</h4>
                    <div class="form-group">
                        <label class="form-label">
                            <span class="text" data-zh="所有者地址" data-en="Owner Address">所有者地址</span>
                        </label>
                        <input type="text" class="form-input" id="factoryOwnerAddress" data-zh-placeholder="留空则使用当前账户"
                            data-en-placeholder="Leave empty to use current account" placeholder="留空则使用当前账户">
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <span class="text" data-zh="项目实现合约地址"
                                data-en="Project Implementation Address">项目实现合约地址</span>
                            <span style="color: red;">*</span>
                        </label>
                        <input type="text" class="form-input" id="projectImplAddressInput"
                            data-zh-placeholder="从步骤 1 复制地址或手动输入"
                            data-en-placeholder="Copy address from Step 1 or enter manually"
                            placeholder="从步骤 1 复制地址或手动输入">
                    </div>
                    <button class="btn-primary" onclick="deployFactory()">
                        <span class="text" data-zh="部署 Factory 合约" data-en="Deploy Factory Contract">部署 Factory
                            合约</span>
                    </button>
                    <div class="form-group" style="margin-top: 10px;">
                        <input type="text" class="form-input" id="factoryAddress" placeholder="Factory 合约地址 (自动填充)"
                            readonly>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <button class="btn-success" onclick="setProjectImplementation()">
                        <span class="text" data-zh="设置 Project 实现地址到 Factory"
                            data-en="Set Project Implementation in Factory">设置 Project 实现地址到 Factory</span>
                    </button>
                </div>
            </div>

            <!-- Platform Settings Card -->
            <div class="card">
                <h3 class="card-title">
                    <span>⚙️</span>
                    <span class="text" data-zh="平台设置" data-en="Platform Settings">平台设置</span>
                </h3>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label text" data-zh="创建项目费用 (ETH)"
                            data-en="Project Creation Fee (ETH)">创建项目费用 (ETH)</label>
                        <input type="number" class="form-input" id="creationFee" step="0.001" placeholder="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label text" data-zh="平台费率 (%)" data-en="Platform Fee (%)">平台费率 (%)</label>
                        <input type="number" class="form-input" id="platformFee" step="0.1" placeholder="5">
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn-success" onclick="updateCreationFee()">
                        <span class="text" data-zh="更新创建费用" data-en="Update Creation Fee">更新创建费用</span>
                    </button>
                    <button class="btn-success" onclick="updatePlatformFee()">
                        <span class="text" data-zh="更新平台费率" data-en="Update Platform Fee">更新平台费率</span>
                    </button>
                    <button class="btn-secondary" onclick="calculateFee()">
                        <span class="text" data-zh="计算平台费用" data-en="Calculate Platform Fee">计算平台费用</span>
                    </button>
                </div>
            </div>

            <!-- Platform Statistics -->
            <div class="card">
                <h3 class="card-title">
                    <span>📊</span>
                    <span class="text" data-zh="平台统计" data-en="Platform Statistics">平台统计</span>
                </h3>
                <div class="grid grid-3">
                    <div class="stat-card">
                        <div class="stat-value" id="totalProjects">0</div>
                        <div class="stat-label text" data-zh="项目总数" data-en="Total Projects">项目总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="platformRevenue">0 ETH</div>
                        <div class="stat-label text" data-zh="平台收入" data-en="Platform Revenue">平台收入</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCreationFees">0 ETH</div>
                        <div class="stat-label text" data-zh="创建费用总计" data-en="Total Creation Fees">创建费用总计</div>
                    </div>
                </div>
                <button class="btn-primary" onclick="loadPlatformStats()" style="margin-top: 20px;">
                    <span class="text" data-zh="刷新统计" data-en="Refresh Stats">刷新统计</span>
                </button>
            </div>

            <!-- All Projects List -->
            <div class="card">
                <h3 class="card-title">
                    <span>📋</span>
                    <span class="text" data-zh="所有项目" data-en="All Projects">所有项目</span>
                </h3>
                <div class="action-buttons">
                    <button class="btn-primary" onclick="loadAllProjects()">
                        <span class="text" data-zh="加载所有项目" data-en="Load All Projects">加载所有项目</span>
                    </button>
                    <button class="btn-secondary" onclick="searchProjectsByOwner()">
                        <span class="text" data-zh="按所有者搜索" data-en="Search by Owner">按所有者搜索</span>
                    </button>
                    <button class="btn-secondary" onclick="checkProjectName()">
                        <span class="text" data-zh="检查项目名称" data-en="Check Project Name">检查项目名称</span>
                    </button>
                </div>
                <div class="table-container" style="margin-top: 20px;">
                    <table id="allProjectsTable">
                        <thead>
                            <tr>
                                <th class="text" data-zh="项目地址" data-en="Project Address">项目地址</th>
                                <th class="text" data-zh="所有者" data-en="Owner">所有者</th>
                                <th class="text" data-zh="名称" data-en="Name">名称</th>
                                <th class="text" data-zh="操作" data-en="Actions">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="empty-state">
                                    <div class="empty-state-icon">📭</div>
                                    <div class="text" data-zh="暂无项目" data-en="No projects yet">暂无项目</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Withdraw Fees -->
            <div class="card">
                <h3 class="card-title">
                    <span>💰</span>
                    <span class="text" data-zh="提取费用" data-en="Withdraw Fees">提取费用</span>
                </h3>
                <div class="form-group">
                    <label class="form-label text" data-zh="接收地址" data-en="Recipient Address">接收地址</label>
                    <input type="text" class="form-input" id="withdrawAddress" placeholder="0x...">
                </div>
                <button class="btn-warning" onclick="withdrawPlatformFees()">
                    <span class="text" data-zh="提取所有费用" data-en="Withdraw All Fees">提取所有费用</span>
                </button>
            </div>
        </div>

        <!-- Project Owner Content -->
        <div id="project-content" class="role-content">

            <!-- Create Project Card -->
            <div class="card">
                <h3 class="card-title">
                    <span>✨</span>
                    <span class="text" data-zh="创建新项目" data-en="Create New Project">创建新项目</span>
                </h3>
                <!-- Basic Project Info -->
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label text" data-zh="项目名称" data-en="Project Name">项目名称</label>
                        <input type="text" class="form-input" id="projectName" placeholder="My Subscription Service">
                    </div>
                    <div class="form-group">
                        <label class="form-label text" data-zh="项目符号" data-en="Project Symbol">项目符号</label>
                        <input type="text" class="form-input" id="projectSymbol" placeholder="MSS">
                    </div>
                </div>
                
                <!-- Additional Brand Config Fields -->
                <div class="form-group">
                    <label class="form-label text" data-zh="项目描述" data-en="Project Description">项目描述</label>
                    <textarea class="form-input" id="projectDescription" rows="2" placeholder="Describe your subscription service..."></textarea>
                </div>
                
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label text" data-zh="Logo 链接 (可选)" data-en="Logo URL (Optional)">Logo 链接</label>
                        <input type="text" class="form-input" id="projectLogoUri" placeholder="https://example.com/logo.png">
                    </div>
                    <div class="form-group">
                        <label class="form-label text" data-zh="网站地址 (可选)" data-en="Website URL (Optional)">网站地址</label>
                        <input type="text" class="form-input" id="projectWebsiteUrl" placeholder="https://example.com">
                    </div>
                </div>
                
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label text" data-zh="主题颜色 (可选)" data-en="Primary Color (Optional)">主题颜色</label>
                        <input type="text" class="form-input" id="projectPrimaryColor" placeholder="#3B82F6">
                    </div>
                    <div class="form-group">
                        <label class="form-label text" data-zh="自定义层级名称 (可选)" data-en="Custom Tier Names (Optional)">层级名称</label>
                        <input type="text" class="form-input" id="projectTierNames" placeholder="Starter,Standard,Pro,Max">
                    </div>
                </div>

                <!-- Subscription Configuration Selection -->
                <div class="grid grid-2" style="margin: 20px 0;">
                    <!-- Select Subscription Tiers -->
                    <div class="card" style="background: #f9fafb;">
                        <h4 class="text" data-zh="选择订阅层级" data-en="Select Subscription Tiers">选择订阅层级</h4>
                        <div style="margin: 15px 0;">
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <input type="checkbox" id="tier-starter" value="0" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span style="margin-right: 10px;">🥉</span>
                                <input type="text" id="tier-name-starter" value="Starter" placeholder="Tier Name"
                                    style="border: 1px solid #e5e7eb; border-radius: 5px; padding: 5px 10px; width: 150px;">
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <input type="checkbox" id="tier-standard" value="1" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span style="margin-right: 10px;">🥈</span>
                                <input type="text" id="tier-name-standard" value="Standard" placeholder="Tier Name"
                                    style="border: 1px solid #e5e7eb; border-radius: 5px; padding: 5px 10px; width: 150px;">
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <input type="checkbox" id="tier-pro" value="2" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span style="margin-right: 10px;">🥇</span>
                                <input type="text" id="tier-name-pro" value="Pro" placeholder="Tier Name"
                                    style="border: 1px solid #e5e7eb; border-radius: 5px; padding: 5px 10px; width: 150px;">
                            </div>
                            <div style="display: flex; align-items: center; margin: 10px 0;">
                                <input type="checkbox" id="tier-max" value="3" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span style="margin-right: 10px;">💎</span>
                                <input type="text" id="tier-name-max" value="Max" placeholder="Tier Name"
                                    style="border: 1px solid #e5e7eb; border-radius: 5px; padding: 5px 10px; width: 150px;">
                            </div>
                        </div>
                    </div>

                    <!-- Select Subscription Periods -->
                    <div class="card" style="background: #f9fafb;">
                        <h4 class="text" data-zh="选择订阅周期" data-en="Select Subscription Periods">选择订阅周期</h4>
                        <div style="margin: 15px 0;">
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" id="period-daily" value="0" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span class="text" data-zh="日付" data-en="Daily">日付</span>
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" id="period-weekly" value="1" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span class="text" data-zh="周付" data-en="Weekly">周付</span>
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" id="period-monthly" value="2" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span class="text" data-zh="月付" data-en="Monthly">月付</span>
                            </label>
                            <label style="display: flex; align-items: center; margin: 10px 0; cursor: pointer;">
                                <input type="checkbox" id="period-yearly" value="3" onchange="updatePricingDisplay()"
                                    style="margin-right: 10px;">
                                <span class="text" data-zh="年付" data-en="Yearly">年付</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Dynamic Pricing Configuration -->
                <h4 class="text" data-zh="订阅层级定价" data-en="Subscription Tier Pricing" style="margin: 20px 0;">订阅层级定价
                </h4>
                <div id="pricingConfiguration" class="grid grid-2">
                    <div style="grid-column: 1/-1; text-align: center; color: #666; padding: 20px;">
                        <span class="text" data-zh="请先选择订阅层级和周期"
                            data-en="Please select subscription tiers and periods first">请先选择订阅层级和周期</span>
                    </div>
                </div>

                <button class="btn-primary" onclick="createProject()" style="margin-top: 20px;">
                    <span class="text" data-zh="创建项目" data-en="Create Project">创建项目</span>
                </button>
            </div>

            <!-- Manage Existing Project -->
            <div class="card">
                <h3 class="card-title">
                    <span>🎯</span>
                    <span class="text" data-zh="管理现有项目" data-en="Manage Existing Project">管理现有项目</span>
                </h3>
                <div class="form-group">
                    <label class="form-label text" data-zh="项目地址" data-en="Project Address">项目地址</label>
                    <input type="text" class="form-input" id="manageProjectAddress" placeholder="0x...">
                </div>

                <!-- Project Statistics -->
                <div class="grid grid-3" style="margin: 20px 0;">
                    <div class="stat-card">
                        <div class="stat-value" id="projectRevenue">0 ETH</div>
                        <div class="stat-label text" data-zh="项目收入" data-en="Project Revenue">项目收入</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalSubscribers">0</div>
                        <div class="stat-label text" data-zh="订阅者总数" data-en="Total Subscribers">订阅者总数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeSubscribers">0</div>
                        <div class="stat-label text" data-zh="活跃订阅者" data-en="Active Subscribers">活跃订阅者</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-success" onclick="loadProjectStats()">
                        <span class="text" data-zh="加载统计" data-en="Load Stats">加载统计</span>
                    </button>
                    <button class="btn-warning" onclick="withdrawProjectFunds()">
                        <span class="text" data-zh="提取资金" data-en="Withdraw Funds">提取资金</span>
                    </button>
                    <button class="btn-primary" onclick="showUpdatePlanModal()">
                        <span class="text" data-zh="更新计划配置" data-en="Update Plan Config">更新计划配置</span>
                    </button>
                    <button class="btn-secondary" onclick="viewSubscribers()">
                        <span class="text" data-zh="查看订阅者" data-en="View Subscribers">查看订阅者</span>
                    </button>
                </div>
            </div>

            <!-- My Projects List -->
            <div class="card" id="myProjectsCard">
                <h3 class="card-title">
                    <span>📁</span>
                    <span class="text" data-zh="我的项目" data-en="My Projects">我的项目</span>
                </h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div>
                        <span class="text" data-zh="总计项目: " data-en="Total Projects: ">总计项目：</span>
                        <span id="totalProjectCount" style="font-weight: bold;">0</span>
                    </div>
                    <button class="btn-secondary" onclick="refreshMyProjects()">
                        <span class="text" data-zh="刷新" data-en="Refresh">刷新</span>
                    </button>
                </div>
                <div class="table-container">
                    <table id="myProjectsTable">
                        <thead>
                            <tr>
                                <th class="text" data-zh="项目信息" data-en="Project Info">项目信息</th>
                                <th class="text" data-zh="合约地址" data-en="Contract Address">合约地址</th>
                                <th class="text" data-zh="净收入" data-en="Net Revenue">净收入</th>
                                <th class="text" data-zh="订阅者" data-en="Subscribers">订阅者</th>
                                <th class="text" data-zh="操作" data-en="Actions">操作</th>
                            </tr>
                        </thead>
                        <tbody id="myProjectsTableBody">
                            <tr>
                                <td colspan="5" class="empty-state">
                                    <div class="empty-state-icon">📭</div>
                                    <div class="text" data-zh="暂无项目" data-en="No projects yet">暂无项目</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Pagination Controls -->
                <div style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;" id="myProjectsPagination">
                    <button class="btn-secondary" onclick="changeMyProjectsPage(-1)" id="myProjectsPrevBtn" disabled>
                        <span class="text" data-zh="上一页" data-en="Previous">上一页</span>
                    </button>
                    <span>
                        <span class="text" data-zh="第" data-en="Page">第</span>
                        <span id="myProjectsCurrentPage">1</span>
                        <span class="text" data-zh="页 / 共" data-en=" of ">页 / 共</span>
                        <span id="myProjectsTotalPages">1</span>
                        <span class="text" data-zh="页" data-en=" pages">页</span>
                    </span>
                    <button class="btn-secondary" onclick="changeMyProjectsPage(1)" id="myProjectsNextBtn" disabled>
                        <span class="text" data-zh="下一页" data-en="Next">下一页</span>
                    </button>
                </div>
            </div>

            <!-- Subscribers List -->
            <div class="card" id="subscribersCard" style="display: none;">
                <h3 class="card-title">
                    <span>👥</span>
                    <span class="text" data-zh="订阅者列表" data-en="Subscribers List">订阅者列表</span>
                </h3>
                <div class="table-container">
                    <table id="subscribersTable">
                        <thead>
                            <tr>
                                <th class="text" data-zh="地址" data-en="Address">地址</th>
                                <th class="text" data-zh="层级" data-en="Tier">层级</th>
                                <th class="text" data-zh="周期" data-en="Period">周期</th>
                                <th class="text" data-zh="状态" data-en="Status">状态</th>
                                <th class="text" data-zh="到期时间" data-en="Expiry">到期时间</th>
                                <th class="text" data-zh="总支付" data-en="Total Paid">总支付</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" class="empty-state">
                                    <div class="empty-state-icon">📭</div>
                                    <div class="text" data-zh="暂无订阅者" data-en="No subscribers yet">暂无订阅者</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Referrer Content -->
        <div id="referrer-content" class="role-content">
            <div class="card">
                <h3 class="card-title">
                    <span>🔗</span>
                    <span class="text" data-zh="推广链接管理" data-en="Referral Link Management">推广链接管理</span>
                </h3>
                <div class="form-group">
                    <label class="form-label text" data-zh="项目地址" data-en="Project Address">项目地址</label>
                    <input type="text" class="form-input" id="referralProjectAddress" placeholder="0x...">
                </div>
                <div class="form-group">
                    <label class="form-label text" data-zh="您的推广链接" data-en="Your Referral Link">您的推广链接</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-input" id="referralLink" readonly>
                        <button class="btn-secondary" onclick="copyReferralLink()">
                            <span class="text" data-zh="复制" data-en="Copy">复制</span>
                        </button>
                    </div>
                </div>
                <button class="btn-primary" onclick="generateReferralLink()">
                    <span class="text" data-zh="生成推广链接" data-en="Generate Referral Link">生成推广链接</span>
                </button>
            </div>

            <!-- Referral Statistics -->
            <div class="card">
                <h3 class="card-title">
                    <span>📈</span>
                    <span class="text" data-zh="推广统计" data-en="Referral Statistics">推广统计</span>
                </h3>
                <div class="grid grid-3">
                    <div class="stat-card">
                        <div class="stat-value" id="totalReferrals">0</div>
                        <div class="stat-label text" data-zh="推广用户数" data-en="Total Referrals">推广用户数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalReferralRewards">0 ETH</div>
                        <div class="stat-label text" data-zh="累计奖励" data-en="Total Rewards">累计奖励</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingReferralRewards">0 ETH</div>
                        <div class="stat-label text" data-zh="待领取奖励" data-en="Pending Rewards">待领取奖励</div>
                    </div>
                </div>
                <button class="btn-success" onclick="claimReferralRewards()">
                    <span class="text" data-zh="领取奖励" data-en="Claim Rewards">领取奖励</span>
                </button>
            </div>

            <!-- Referred Users List -->
            <div class="card">
                <h3 class="card-title">
                    <span>👥</span>
                    <span class="text" data-zh="推广用户列表" data-en="Referred Users List">推广用户列表</span>
                </h3>
                <div class="table-container">
                    <table id="referredUsersTable">
                        <thead>
                            <tr>
                                <th class="text" data-zh="用户地址" data-en="User Address">用户地址</th>
                                <th class="text" data-zh="订阅时间" data-en="Subscribe Time">订阅时间</th>
                                <th class="text" data-zh="订阅层级" data-en="Tier">订阅层级</th>
                                <th class="text" data-zh="贡献奖励" data-en="Reward">贡献奖励</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="4" class="empty-state">
                                    <div class="empty-state-icon">📭</div>
                                    <div class="text" data-zh="暂无推广用户" data-en="No referred users yet">暂无推广用户</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Subscriber Content -->
        <div id="subscriber-content" class="role-content">
            <!-- Connect to Project -->
            <div class="card" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
                <h3 class="card-title">
                    <span>🔗</span>
                    <span class="text" data-zh="连接项目" data-en="Connect to Project">连接项目</span>
                </h3>
                <div style="display: flex; gap: 10px; align-items: flex-end;">
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label text" data-zh="项目合约地址" data-en="Project Contract Address">项目合约地址</label>
                        <input type="text" class="form-input" id="subscriberProjectAddress" placeholder="0x...">
                    </div>
                    <button class="btn-primary" onclick="loadSubscriberProjectDetails()" style="height: 38px;">
                        <span class="text" data-zh="连接" data-en="Connect">连接</span>
                    </button>
                </div>
            </div>

            <!-- Project Details & Subscription Plans -->
            <div id="subscriberProjectInfo" style="display: none;">
                <!-- Project Basic Info -->
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h3 class="card-title" style="margin-bottom: 10px;">
                                <span id="subscriberProjectName" style="font-size: 24px; font-weight: bold;">-</span>
                                <span id="subscriberProjectSymbol" style="font-size: 14px; color: #666; margin-left: 10px;">-</span>
                            </h3>
                            <div id="subscriberProjectDescription" style="color: #666; margin-bottom: 15px;"></div>
                        </div>
                        <div id="subscriberProjectLogo" style="width: 60px; height: 60px; background: #f0f0f0; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 24px;">🎯</span>
                        </div>
                    </div>

                    <div class="grid grid-4" style="margin-top: 20px;">
                        <div style="text-align: center; padding: 10px; background: #f9fafb; border-radius: 8px;">
                            <div id="subscriberProjectStats-subscribers" style="font-size: 20px; font-weight: bold; color: #3b82f6;">0</div>
                            <div style="font-size: 12px; color: #666;" class="text" data-zh="订阅者" data-en="Subscribers">订阅者</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f9fafb; border-radius: 8px;">
                            <div id="subscriberProjectStats-revenue" style="font-size: 20px; font-weight: bold; color: #10b981;">0</div>
                            <div style="font-size: 12px; color: #666;" class="text" data-zh="总收入" data-en="Revenue">总收入</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f9fafb; border-radius: 8px;">
                            <div id="subscriberProjectStats-plans" style="font-size: 20px; font-weight: bold; color: #8b5cf6;">0</div>
                            <div style="font-size: 12px; color: #666;" class="text" data-zh="订阅计划" data-en="Plans">订阅计划</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f9fafb; border-radius: 8px;">
                            <div id="subscriberProjectStats-periods" style="font-size: 20px; font-weight: bold; color: #f59e0b;">0</div>
                            <div style="font-size: 12px; color: #666;" class="text" data-zh="付费周期" data-en="Periods">付费周期</div>
                        </div>
                    </div>
                </div>

                <!-- Current Subscription Status -->
                <div class="card" id="mySubscriptionStatus" style="display: none;">
                    <h3 class="card-title">
                        <span>⭐</span>
                        <span class="text" data-zh="我的订阅状态" data-en="My Subscription Status">我的订阅状态</span>
                    </h3>
                    <div style="padding: 20px; background: linear-gradient(135deg, #dcfce7 0%, #d9f99d 100%); border-radius: 8px;">
                        <div class="grid grid-2" style="gap: 20px;">
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;" class="text" data-zh="当前套餐" data-en="Current Plan">当前套餐</div>
                                <div id="currentSubscriptionTier" style="font-size: 18px; font-weight: bold;">-</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;" class="text" data-zh="付费周期" data-en="Payment Period">付费周期</div>
                                <div id="currentSubscriptionPeriod" style="font-size: 18px; font-weight: bold;">-</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;" class="text" data-zh="到期时间" data-en="Expires">到期时间</div>
                                <div id="currentSubscriptionExpiry" style="font-size: 18px; font-weight: bold;">-</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #666; margin-bottom: 5px;" class="text" data-zh="累计支付" data-en="Total Paid">累计支付</div>
                                <div id="currentSubscriptionTotalPaid" style="font-size: 18px; font-weight: bold;">-</div>
                            </div>
                        </div>
                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button class="btn-success" onclick="showRenewModal()">
                                <span class="text" data-zh="续费" data-en="Renew">续费</span>
                            </button>
                            <button class="btn-primary" onclick="showUpgradeModal()">
                                <span class="text" data-zh="升级" data-en="Upgrade">升级</span>
                            </button>
                            <button class="btn-warning" onclick="showDowngradeModal()">
                                <span class="text" data-zh="降级" data-en="Downgrade">降级</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Available Subscription Plans -->
                <div class="card">
                    <h3 class="card-title">
                        <span>💎</span>
                        <span class="text" data-zh="订阅计划" data-en="Subscription Plans">订阅计划</span>
                    </h3>
                    <div id="subscriptionPlansGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <!-- Plans will be dynamically loaded here -->
                    </div>
                </div>
            </div>

            <!-- My Subscriptions List -->
            <div class="card">
                <h3 class="card-title">
                    <span>📋</span>
                    <span class="text" data-zh="我的所有订阅" data-en="My All Subscriptions">我的所有订阅</span>
                </h3>
                <div class="form-group">
                    <input type="text" class="form-input" id="checkSubscriptionAddress" placeholder="输入项目地址查看订阅">
                    <button class="btn-primary" onclick="loadMySubscription()" style="margin-top: 10px;">
                        <span class="text" data-zh="查看我的订阅" data-en="View My Subscription">查看我的订阅</span>
                    </button>
                </div>
                <div id="subscriptionDetails" style="display: none; margin-top: 20px;">
                    <div class="grid grid-2">
                        <div>
                            <strong class="text" data-zh="当前层级：" data-en="Current Tier: ">当前层级：</strong>
                            <span id="currentTier">-</span>
                        </div>
                        <div>
                            <strong class="text" data-zh="周期：" data-en="Period: ">周期：</strong>
                            <span id="currentPeriod">-</span>
                        </div>
                        <div>
                            <strong class="text" data-zh="状态：" data-en="Status: ">状态：</strong>
                            <span id="subStatus">-</span>
                        </div>
                        <div>
                            <strong class="text" data-zh="到期时间：" data-en="Expiry: ">到期时间：</strong>
                            <span id="expiryDate">-</span>
                        </div>
                    </div>
                    <div class="action-buttons" style="margin-top: 20px;">
                        <button class="btn-success" onclick="showRenewModal()">
                            <span class="text" data-zh="续订" data-en="Renew">续订</span>
                        </button>
                        <button class="btn-primary" onclick="showUpgradeModal()">
                            <span class="text" data-zh="升级" data-en="Upgrade">升级</span>
                        </button>
                        <button class="btn-warning" onclick="showDowngradeModal()">
                            <span class="text" data-zh="降级" data-en="Downgrade">降级</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Subscribe Modal -->
            <div class="card">
                <h3 class="card-title">
                    <span>💳</span>
                    <span class="text" data-zh="订阅服务" data-en="Subscribe to Service">订阅服务</span>
                </h3>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label text" data-zh="项目地址" data-en="Project Address">项目地址</label>
                        <input type="text" class="form-input" id="subscribeProjectAddress" placeholder="0x...">
                    </div>
                    <div class="form-group">
                        <label class="form-label text" data-zh="推荐人地址（可选）"
                            data-en="Referrer Address (Optional)">推荐人地址（可选）</label>
                        <input type="text" class="form-input" id="referrerAddress" placeholder="0x...">
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label text" data-zh="选择层级" data-en="Select Tier">选择层级</label>
                        <select class="form-select" id="subscribeTier">
                            <option value="0">🥉 Starter</option>
                            <option value="1">🥈 Standard</option>
                            <option value="2">🥇 Pro</option>
                            <option value="3">💎 Max</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label text" data-zh="选择周期" data-en="Select Period">选择周期</label>
                        <select class="form-select" id="subscribePeriod">
                            <option value="0" class="text" data-zh="月付" data-en="Monthly">月付</option>
                            <option value="1" class="text" data-zh="季付" data-en="Quarterly">季付</option>
                            <option value="2" class="text" data-zh="半年付" data-en="Semi-Annual">半年付</option>
                            <option value="3" class="text" data-zh="年付" data-en="Annual">年付</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label text" data-zh="支付金额" data-en="Payment Amount">支付金额</label>
                    <input type="text" class="form-input" id="paymentAmount" readonly placeholder="0 ETH">
                </div>

                <button class="btn-primary" onclick="subscribe()">
                    <span class="text" data-zh="确认订阅" data-en="Confirm Subscription">确认订阅</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Update Plan Modal -->
    <div class="modal" id="updatePlanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title text" data-zh="更新计划配置" data-en="Update Plan Configuration">更新计划配置</h2>
                <button class="close-btn" onclick="closeUpdatePlanModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="选择层级" data-en="Select Tier">选择层级</label>
                <select class="form-select" id="updateTier">
                    <option value="0">🥉 Starter</option>
                    <option value="1">🥈 Standard</option>
                    <option value="2">🥇 Pro</option>
                    <option value="3">💎 Max</option>
                </select>
            </div>
            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label text" data-zh="月付价格 (ETH)" data-en="Monthly Price (ETH)">月付价格 (ETH)</label>
                    <input type="number" class="form-input" id="updateMonthly" step="0.001">
                </div>
                <div class="form-group">
                    <label class="form-label text" data-zh="季付价格 (ETH)" data-en="Quarterly Price (ETH)">季付价格
                        (ETH)</label>
                    <input type="number" class="form-input" id="updateQuarterly" step="0.001">
                </div>
                <div class="form-group">
                    <label class="form-label text" data-zh="半年付价格 (ETH)" data-en="Semi-Annual Price (ETH)">半年付价格
                        (ETH)</label>
                    <input type="number" class="form-input" id="updateSemiannual" step="0.001">
                </div>
                <div class="form-group">
                    <label class="form-label text" data-zh="年付价格 (ETH)" data-en="Annual Price (ETH)">年付价格 (ETH)</label>
                    <input type="number" class="form-input" id="updateAnnual" step="0.001">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="功能列表 (每行一个)" data-en="Features (one per line)">功能列表
                    (每行一个)</label>
                <textarea class="form-textarea" id="updateFeatures" rows="4"></textarea>
            </div>
            <button class="btn-primary" onclick="updatePlanConfig()">
                <span class="text" data-zh="更新配置" data-en="Update Configuration">更新配置</span>
            </button>
        </div>
    </div>

    <!-- Network Details Modal -->
    <div class="modal" id="networkDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title text" data-zh="网络详情" data-en="Network Details">网络详情</h2>
                <button class="close-btn" onclick="closeNetworkDetailsModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="网络名称" data-en="Network Name">网络名称</label>
                <input type="text" class="form-input" id="detailNetworkName">
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="链 ID" data-en="Chain ID">链 ID</label>
                <input type="text" class="form-input" id="detailChainId" readonly>
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="RPC URL" data-en="RPC URL">RPC URL</label>
                <input type="text" class="form-input" id="detailRpcUrl">
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="货币符号" data-en="Currency Symbol">货币符号</label>
                <input type="text" class="form-input" id="detailCurrencySymbol">
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="区块浏览器 URL" data-en="Block Explorer URL">区块浏览器 URL</label>
                <input type="text" class="form-input" id="detailExplorerUrl">
            </div>
            <div class="action-buttons">
                <button class="btn-primary" onclick="saveNetworkDetails()">
                    <span class="text" data-zh="保存" data-en="Save">保存</span>
                </button>
                <button class="btn-danger" onclick="deleteCustomNetwork()" id="deleteNetworkBtn" style="display: none;">
                    <span class="text" data-zh="删除网络" data-en="Delete Network">删除网络</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add Network Modal -->
    <div class="modal" id="addNetworkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title text" data-zh="添加自定义网络" data-en="Add Custom Network">添加自定义网络</h2>
                <button class="close-btn" onclick="closeAddNetworkModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="网络名称" data-en="Network Name">网络名称</label>
                <input type="text" class="form-input" id="customNetworkName" placeholder="My Network">
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="RPC URL" data-en="RPC URL">RPC URL</label>
                <input type="text" class="form-input" id="customRpcUrl" placeholder="https://...">
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="链 ID" data-en="Chain ID">链 ID</label>
                <input type="text" class="form-input" id="customChainId" placeholder="1">
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="货币符号" data-en="Currency Symbol">货币符号</label>
                <input type="text" class="form-input" id="customCurrencySymbol" placeholder="ETH">
            </div>
            <div class="form-group">
                <label class="form-label text" data-zh="区块浏览器 URL（可选）" data-en="Block Explorer URL (Optional)">区块浏览器
                    URL（可选）</label>
                <input type="text" class="form-input" id="customExplorerUrl" placeholder="https://...">
            </div>
            <button class="btn-primary" onclick="addCustomNetwork()">
                <span class="text" data-zh="添加网络" data-en="Add Network">添加网络</span>
            </button>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Web3 and Contract Integration Script -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.9.0/dist/web3.min.js"></script>
    <script>
        // Make functions globally available immediately
        window.connectWallet = null;
        window.toggleLanguage = null;
        window.toggleNetworkDropdown = null;
        window.selectNetwork = null;
        window.showAddNetworkModal = null;
        window.closeAddNetworkModal = null;
        window.addCustomNetwork = null;
        window.switchRole = null;
        window.deployFactory = null;
        window.deployProjectImplementation = null;
        window.setProjectImplementation = null;
        window.updateCreationFee = null;
        window.updatePlatformFee = null;
        window.calculateFee = null;
        window.loadPlatformStats = null;
        window.loadAllProjects = null;
        window.searchProjectsByOwner = null;
        window.checkProjectName = null;
        window.withdrawPlatformFees = null;
        window.createProject = null;
        window.loadProjectStats = null;
        window.withdrawProjectFunds = null;
        window.viewSubscribers = null;
        window.showUpdatePlanModal = null;
        window.closeUpdatePlanModal = null;
        window.updatePlanConfig = null;
        window.generateReferralLink = null;
        window.copyReferralLink = null;
        window.claimReferralRewards = null;
        window.loadProjectDetails = null;
        window.loadMySubscription = null;
        window.showRenewModal = null;
        window.showUpgradeModal = null;
        window.showDowngradeModal = null;
        window.subscribe = null;
        window.copyAddress = null;
        window.showToast = null;
        window.viewNetworkDetails = null;
        window.closeNetworkDetailsModal = null;
        window.saveNetworkDetails = null;
        window.deleteCustomNetwork = null;
        window.loadSubscriberProjectDetails = null;
        window.showSubscribeModal = null;
        window.confirmSubscribe = null;
        window.confirmRenew = null;
        window.confirmUpgrade = null;
        window.confirmDowngrade = null;
    </script>
    <script>
        // Language management
        let currentLang = 'zh';

        window.toggleLanguage = function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            document.getElementById('langBtn').textContent = currentLang === 'zh' ? '🇨🇳 中文' : '🇬🇧 English';
            updateTexts();
        }

        function updateTexts() {
            document.querySelectorAll('.text, .role-text').forEach(el => {
                const text = el.getAttribute(`data-${currentLang}`);
                if (text) el.textContent = text;
            });

            // Update specific elements
            document.getElementById('appTitle').textContent = currentLang === 'zh' ? '订阅平台 DApp' : 'Subscription Platform DApp';
            document.getElementById('walletText').textContent = currentLang === 'zh' ? '未连接' : 'Not Connected';
            document.getElementById('connectBtnText').textContent = currentLang === 'zh' ? '连接钱包' : 'Connect Wallet';
            document.getElementById('currentNetwork').textContent = currentLang === 'zh' ? '选择网络' : 'Select Network';
        }

        // Network management
        let web3;
        let accounts = [];
        let currentChainId;
        let factoryContract;
        let projectContract;

        const networks = {
            '1': { name: 'Ethereum Mainnet', rpc: 'https://eth.llamarpc.com' },
            '11155111': { name: 'Sepolia Testnet', rpc: 'https://sepolia.drpc.org' },
            '137': { name: 'Polygon', rpc: 'https://polygon-rpc.com' },
            '56': { name: 'BSC', rpc: 'https://bsc-dataseed.binance.org' },
            '42161': { name: 'Arbitrum One', rpc: 'https://arb1.arbitrum.io/rpc' },
            '10': { name: 'Optimism', rpc: 'https://mainnet.optimism.io' },
            '8453': { name: 'Base', rpc: 'https://mainnet.base.org' }
        };

        window.toggleNetworkDropdown = function toggleNetworkDropdown() {
            const dropdown = document.getElementById('networkDropdown');
            dropdown.classList.toggle('active');
        }

        window.selectNetwork = function selectNetwork(chainId, name) {
            document.getElementById('currentNetwork').textContent = name;
            currentChainId = chainId;
            toggleNetworkDropdown();

            // Save selected network to localStorage
            localStorage.setItem('selectedNetwork', chainId);
            localStorage.setItem('selectedNetworkName', name);

            // Load saved Factory address for this network
            const savedFactoryAddress = localStorage.getItem(`factoryAddress_${chainId}`);
            if (savedFactoryAddress) {
                document.getElementById('globalFactoryAddress').value = savedFactoryAddress;
                // Auto-connect if Factory address exists
                setTimeout(() => {
                    if (typeof connectGlobalFactory === 'function') {
                        connectGlobalFactory();
                    }
                }, 500);
            } else {
                // Clear Factory address and status
                document.getElementById('globalFactoryAddress').value = '';
                document.getElementById('globalFactoryConnectionStatus').textContent = '';
                document.getElementById('globalFactoryInfo').style.display = 'none';
                // Clear factory contract instance
                factoryContract = null;
            }

            // Update pricing display to reflect new currency
            if (typeof updatePricingDisplay === 'function') {
                updatePricingDisplay();
            }

            if (window.ethereum) {
                switchNetwork(chainId);
            }
        }

        async function switchNetwork(chainId) {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x' + parseInt(chainId).toString(16) }],
                });
            } catch (error) {
                if (error.code === 4902) {
                    showToast(currentLang === 'zh' ? '请在MetaMask中添加此网络' : 'Please add this network in MetaMask', 'error');
                }
            }
        }

        window.showAddNetworkModal = function showAddNetworkModal() {
            document.getElementById('addNetworkModal').classList.add('active');
            toggleNetworkDropdown();
        }

        window.closeAddNetworkModal = function closeAddNetworkModal() {
            document.getElementById('addNetworkModal').classList.remove('active');
        }

        window.addCustomNetwork = async function addCustomNetwork() {
            const name = document.getElementById('customNetworkName').value;
            const rpc = document.getElementById('customRpcUrl').value;
            const chainId = document.getElementById('customChainId').value;
            const symbol = document.getElementById('customCurrencySymbol').value;
            const explorer = document.getElementById('customExplorerUrl').value;

            if (!name || !rpc || !chainId || !symbol) {
                showToast(currentLang === 'zh' ? '请填写所有必填字段' : 'Please fill all required fields', 'error');
                return;
            }

            try {
                // Add to MetaMask
                await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                        chainId: '0x' + parseInt(chainId).toString(16),
                        chainName: name,
                        nativeCurrency: {
                            name: symbol,
                            symbol: symbol,
                            decimals: 18
                        },
                        rpcUrls: [rpc],
                        blockExplorerUrls: explorer ? [explorer] : []
                    }]
                });

                // Add to local networks list
                networks[chainId] = { name, rpc };

                // Add to dropdown menu dynamically
                const dropdown = document.getElementById('networkDropdown');
                const addNetworkBtn = dropdown.querySelector('.add-network-btn');

                // Create new network item
                const newNetworkItem = document.createElement('div');
                newNetworkItem.className = 'network-item';
                newNetworkItem.onclick = function () { selectNetwork(chainId, name); };
                newNetworkItem.innerHTML = `
                    <span>${name}</span>
                    <span style="display: flex; gap: 5px;">
                        <span style="cursor: pointer;" onclick="event.stopPropagation(); viewNetworkDetails('${chainId}')" title="查看详情">👁️</span>
                        <span>🟢</span>
                    </span>
                `;

                // Insert before the "Add Custom Network" button
                dropdown.insertBefore(newNetworkItem, addNetworkBtn);

                // Store custom networks in localStorage for persistence
                const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
                customNetworks[chainId] = { name, rpc, symbol, explorer };
                localStorage.setItem('customNetworks', JSON.stringify(customNetworks));

                closeAddNetworkModal();
                showToast(currentLang === 'zh' ? '网络添加成功' : 'Network added successfully', 'success');
            } catch (error) {
                showToast(currentLang === 'zh' ? '添加网络失败' : 'Failed to add network', 'error');
            }
        }

        // Wallet connection
        window.connectWallet = async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showToast(currentLang === 'zh' ? '请安装MetaMask!' : 'Please install MetaMask!', 'error');
                return;
            }

            try {
                web3 = new Web3(window.ethereum);
                accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                currentChainId = await web3.eth.getChainId();

                updateWalletStatus(true);
                showToast(currentLang === 'zh' ? '钱包连接成功' : 'Wallet connected successfully', 'success');

                // Listen for account changes
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', handleChainChanged);

            } catch (error) {
                showToast(currentLang === 'zh' ? '连接失败' : 'Connection failed', 'error');
            }
        }

        function handleAccountsChanged(newAccounts) {
            accounts = newAccounts;
            if (accounts.length === 0) {
                updateWalletStatus(false);
            } else {
                updateWalletStatus(true);
            }
        }

        function handleChainChanged(chainId) {
            window.location.reload();
        }

        function updateWalletStatus(connected) {
            const statusEl = document.getElementById('walletStatus');
            const walletText = document.getElementById('walletText');
            const connectBtn = document.getElementById('connectBtn');

            if (connected && accounts.length > 0) {
                statusEl.classList.add('connected');
                walletText.textContent = `${accounts[0].substring(0, 6)}...${accounts[0].substring(38)}`;
                connectBtn.style.display = 'none';
            } else {
                statusEl.classList.remove('connected');
                walletText.textContent = currentLang === 'zh' ? '未连接' : 'Not Connected';
                connectBtn.style.display = 'flex';
            }
        }

        // Role switching
        window.switchRole = function switchRole(role, event) {
            // Update tabs
            document.querySelectorAll('.role-tab').forEach(tab => tab.classList.remove('active'));
            if (event && event.target) {
                event.target.closest('.role-tab').classList.add('active');
            }

            // Update content
            document.querySelectorAll('.role-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${role}-content`).classList.add('active');
        }

        // Toast notifications
        window.showToast = function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Contract ABIs (simplified - you'll need to add complete ABIs)
        const FACTORY_ABI = [
            {
                "type": "constructor",
                "inputs": [
                    {
                        "name": "owner_",
                        "type": "address",
                        "internalType": "address"
                    },
                    {
                        "name": "projectImplementation_",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "nonpayable"
            },
            {
                "type": "receive",
                "stateMutability": "payable"
            },
            {
                "type": "function",
                "name": "MAX_BASIS_POINTS",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "MAX_PAGINATION_LIMIT",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "MAX_PLATFORM_FEE_BASIS_POINTS",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "calculatePlatformFee",
                "inputs": [
                    {
                        "name": "amount",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "outputs": [
                    {
                        "name": "fee",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "cancelOwnershipHandover",
                "inputs": [],
                "outputs": [],
                "stateMutability": "payable"
            },
            {
                "type": "function",
                "name": "completeOwnershipHandover",
                "inputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "outputs": [],
                "stateMutability": "payable"
            },
            {
                "type": "function",
                "name": "deployNewProject",
                "inputs": [
                    {
                        "name": "brandConfig",
                        "type": "tuple",
                        "internalType": "struct DataTypes.BrandConfig",
                        "components": [
                            {
                                "name": "name",
                                "type": "string",
                                "internalType": "string"
                            },
                            {
                                "name": "symbol",
                                "type": "string",
                                "internalType": "string"
                            },
                            {
                                "name": "description",
                                "type": "string",
                                "internalType": "string"
                            },
                            {
                                "name": "logoUri",
                                "type": "string",
                                "internalType": "string"
                            },
                            {
                                "name": "websiteUrl",
                                "type": "string",
                                "internalType": "string"
                            },
                            {
                                "name": "primaryColor",
                                "type": "string",
                                "internalType": "string"
                            },
                            {
                                "name": "maxTier",
                                "type": "uint8",
                                "internalType": "uint8"
                            },
                            {
                                "name": "enabledPeriods",
                                "type": "bool[4]",
                                "internalType": "bool[4]"
                            },
                            {
                                "name": "tierNames",
                                "type": "string[4]",
                                "internalType": "string[4]"
                            }
                        ]
                    },
                    {
                        "name": "projectOwner",
                        "type": "address",
                        "internalType": "address"
                    },
                    {
                        "name": "prices",
                        "type": "uint256[4][4]",
                        "internalType": "uint256[4][4]"
                    }
                ],
                "outputs": [
                    {
                        "name": "project",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "payable"
            },
            {
                "type": "function",
                "name": "getOwnerProjectCount",
                "inputs": [
                    {
                        "name": "owner",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "getOwnerProjectsPaginated",
                "inputs": [
                    {
                        "name": "owner",
                        "type": "address",
                        "internalType": "address"
                    },
                    {
                        "name": "offset",
                        "type": "uint256",
                        "internalType": "uint256"
                    },
                    {
                        "name": "limit",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "outputs": [
                    {
                        "name": "projectList",
                        "type": "address[]",
                        "internalType": "address[]"
                    },
                    {
                        "name": "totalCount",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "getProjectsPaginated",
                "inputs": [
                    {
                        "name": "offset",
                        "type": "uint256",
                        "internalType": "uint256"
                    },
                    {
                        "name": "limit",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "outputs": [
                    {
                        "name": "projectList",
                        "type": "address[]",
                        "internalType": "address[]"
                    },
                    {
                        "name": "totalCount",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "getRevenueStats",
                "inputs": [],
                "outputs": [
                    {
                        "name": "creationFees",
                        "type": "uint256",
                        "internalType": "uint256"
                    },
                    {
                        "name": "platformFees",
                        "type": "uint256",
                        "internalType": "uint256"
                    },
                    {
                        "name": "directDeposits",
                        "type": "uint256",
                        "internalType": "uint256"
                    },
                    {
                        "name": "totalBalance",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "getTotalProjects",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "isProjectNameTaken",
                "inputs": [
                    {
                        "name": "name",
                        "type": "string",
                        "internalType": "string"
                    },
                    {
                        "name": "symbol",
                        "type": "string",
                        "internalType": "string"
                    }
                ],
                "outputs": [
                    {
                        "name": "exists",
                        "type": "bool",
                        "internalType": "bool"
                    },
                    {
                        "name": "existingProject",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "owner",
                "inputs": [],
                "outputs": [
                    {
                        "name": "result",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "ownerProjects",
                "inputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    },
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "outputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "ownershipHandoverExpiresAt",
                "inputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "outputs": [
                    {
                        "name": "result",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "platformFeeBasisPoints",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "projectCreationFee",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "projectImplementation",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "projectReaderImplementation",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "projectToOwner",
                "inputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "outputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "projects",
                "inputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "outputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "renounceOwnership",
                "inputs": [],
                "outputs": [],
                "stateMutability": "payable"
            },
            {
                "type": "function",
                "name": "requestOwnershipHandover",
                "inputs": [],
                "outputs": [],
                "stateMutability": "payable"
            },
            {
                "type": "function",
                "name": "saltToProject",
                "inputs": [
                    {
                        "name": "",
                        "type": "bytes32",
                        "internalType": "bytes32"
                    }
                ],
                "outputs": [
                    {
                        "name": "",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "setPlatformFeeBasisPoints",
                "inputs": [
                    {
                        "name": "newBasisPoints",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "outputs": [],
                "stateMutability": "nonpayable"
            },
            {
                "type": "function",
                "name": "setProjectCreationFee",
                "inputs": [
                    {
                        "name": "newFee",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "outputs": [],
                "stateMutability": "nonpayable"
            },
            {
                "type": "function",
                "name": "setProjectImplementation",
                "inputs": [
                    {
                        "name": "newImplementation",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "outputs": [],
                "stateMutability": "nonpayable"
            },
            {
                "type": "function",
                "name": "totalCreationFeesCollected",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "totalDirectDeposits",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "totalPlatformFeesReceived",
                "inputs": [],
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ],
                "stateMutability": "view"
            },
            {
                "type": "function",
                "name": "transferOwnership",
                "inputs": [
                    {
                        "name": "newOwner",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "outputs": [],
                "stateMutability": "payable"
            },
            {
                "type": "function",
                "name": "withdrawFees",
                "inputs": [
                    {
                        "name": "recipient",
                        "type": "address",
                        "internalType": "address"
                    }
                ],
                "outputs": [],
                "stateMutability": "nonpayable"
            },
            {
                "type": "event",
                "name": "CreationFeeUpdated",
                "inputs": [
                    {
                        "name": "oldFee",
                        "type": "uint256",
                        "indexed": false,
                        "internalType": "uint256"
                    },
                    {
                        "name": "newFee",
                        "type": "uint256",
                        "indexed": false,
                        "internalType": "uint256"
                    }
                ],
                "anonymous": false
            },
            {
                "type": "event",
                "name": "ImplementationUpdated",
                "inputs": [
                    {
                        "name": "oldImplementation",
                        "type": "address",
                        "indexed": false,
                        "internalType": "address"
                    },
                    {
                        "name": "newImplementation",
                        "type": "address",
                        "indexed": false,
                        "internalType": "address"
                    }
                ],
                "anonymous": false
            },
            {
                "type": "event",
                "name": "OwnershipHandoverCanceled",
                "inputs": [
                    {
                        "name": "pendingOwner",
                        "type": "address",
                        "indexed": true,
                        "internalType": "address"
                    }
                ],
                "anonymous": false
            },
            {
                "type": "event",
                "name": "OwnershipHandoverRequested",
                "inputs": [
                    {
                        "name": "pendingOwner",
                        "type": "address",
                        "indexed": true,
                        "internalType": "address"
                    }
                ],
                "anonymous": false
            },
            {
                "type": "event",
                "name": "OwnershipTransferred",
                "inputs": [
                    {
                        "name": "oldOwner",
                        "type": "address",
                        "indexed": true,
                        "internalType": "address"
                    },
                    {
                        "name": "newOwner",
                        "type": "address",
                        "indexed": true,
                        "internalType": "address"
                    }
                ],
                "anonymous": false
            },
            {
                "type": "event",
                "name": "PlatformFeeUpdated",
                "inputs": [
                    {
                        "name": "oldBasisPoints",
                        "type": "uint256",
                        "indexed": false,
                        "internalType": "uint256"
                    },
                    {
                        "name": "newBasisPoints",
                        "type": "uint256",
                        "indexed": false,
                        "internalType": "uint256"
                    }
                ],
                "anonymous": false
            },
            {
                "type": "event",
                "name": "ProjectDeployed",
                "inputs": [
                    {
                        "name": "project",
                        "type": "address",
                        "indexed": true,
                        "internalType": "address"
                    },
                    {
                        "name": "owner",
                        "type": "address",
                        "indexed": true,
                        "internalType": "address"
                    },
                    {
                        "name": "name",
                        "type": "string",
                        "indexed": false,
                        "internalType": "string"
                    },
                    {
                        "name": "symbol",
                        "type": "string",
                        "indexed": false,
                        "internalType": "string"
                    },
                    {
                        "name": "timestamp",
                        "type": "uint256",
                        "indexed": false,
                        "internalType": "uint256"
                    }
                ],
                "anonymous": false
            },
            {
                "type": "error",
                "name": "AlreadyInitialized",
                "inputs": []
            },
            {
                "type": "error",
                "name": "InvalidBasisPoints",
                "inputs": [
                    {
                        "name": "basisPoints",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ]
            },
            {
                "type": "error",
                "name": "InvalidFee",
                "inputs": [
                    {
                        "name": "sent",
                        "type": "uint256",
                        "internalType": "uint256"
                    },
                    {
                        "name": "required",
                        "type": "uint256",
                        "internalType": "uint256"
                    }
                ]
            },
            {
                "type": "error",
                "name": "InvalidInput",
                "inputs": [
                    {
                        "name": "reason",
                        "type": "string",
                        "internalType": "string"
                    }
                ]
            },
            {
                "type": "error",
                "name": "NewOwnerIsZeroAddress",
                "inputs": []
            },
            {
                "type": "error",
                "name": "NoHandoverRequest",
                "inputs": []
            },
            {
                "type": "error",
                "name": "ProjectAlreadyExists",
                "inputs": [
                    {
                        "name": "existingProject",
                        "type": "address",
                        "internalType": "address"
                    }
                ]
            },
            {
                "type": "error",
                "name": "Reentrancy",
                "inputs": []
            },
            {
                "type": "error",
                "name": "TransferFailed",
                "inputs": []
            },
            {
                "type": "error",
                "name": "Unauthorized",
                "inputs": []
            },
            {
                "type": "error",
                "name": "ZeroAddress",
                "inputs": []
            }
        ]
        const PROJECT_ABI =  [
        {
            "type": "fallback",
            "stateMutability": "payable"
        },
        {
            "type": "receive",
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "CLAIM_COOLDOWN",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "REFERRAL_REWARD_RATE",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "brandConfig",
            "inputs": [],
            "outputs": [
                {
                    "name": "name",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "symbol",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "description",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "logoUri",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "websiteUrl",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "primaryColor",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "maxTier",
                    "type": "uint8",
                    "internalType": "uint8"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "cancelOwnershipHandover",
            "inputs": [],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "claimReferralRewards",
            "inputs": [],
            "outputs": [],
            "stateMutability": "nonpayable"
        },
        {
            "type": "function",
            "name": "completeOwnershipHandover",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "downgrade",
            "inputs": [
                {
                    "name": "newTier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "factory",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "initialize",
            "inputs": [
                {
                    "name": "_brandConfig",
                    "type": "tuple",
                    "internalType": "struct DataTypes.BrandConfig",
                    "components": [
                        {
                            "name": "name",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "symbol",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "description",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "logoUri",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "websiteUrl",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "primaryColor",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "maxTier",
                            "type": "uint8",
                            "internalType": "uint8"
                        },
                        {
                            "name": "enabledPeriods",
                            "type": "bool[4]",
                            "internalType": "bool[4]"
                        },
                        {
                            "name": "tierNames",
                            "type": "string[4]",
                            "internalType": "string[4]"
                        }
                    ]
                },
                {
                    "name": "_factory",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "_owner",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "prices",
                    "type": "uint256[4][4]",
                    "internalType": "uint256[4][4]"
                }
            ],
            "outputs": [],
            "stateMutability": "nonpayable"
        },
        {
            "type": "function",
            "name": "initialized",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "bool",
                    "internalType": "bool"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "operationHistory",
            "inputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "operationType",
                    "type": "uint8",
                    "internalType": "enum DataTypes.OperationType"
                },
                {
                    "name": "fromTier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "toTier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "fromPeriod",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "toPeriod",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "timestamp",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "newEndTime",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "owner",
            "inputs": [],
            "outputs": [
                {
                    "name": "result",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "ownershipHandoverExpiresAt",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "result",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "plans",
            "inputs": [
                {
                    "name": "",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                }
            ],
            "outputs": [
                {
                    "name": "enabled",
                    "type": "bool",
                    "internalType": "bool"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "referralAccounts",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "pendingRewards",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalRewards",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "lastClaimTime",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "referralCount",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "referrerToUsers",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "renew",
            "inputs": [
                {
                    "name": "tier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "renounceOwnership",
            "inputs": [],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "requestOwnershipHandover",
            "inputs": [],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "setPlanConfig",
            "inputs": [
                {
                    "name": "tier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "prices",
                    "type": "uint256[4]",
                    "internalType": "uint256[4]"
                },
                {
                    "name": "features",
                    "type": "string[]",
                    "internalType": "string[]"
                }
            ],
            "outputs": [],
            "stateMutability": "nonpayable"
        },
        {
            "type": "function",
            "name": "subscribe",
            "inputs": [
                {
                    "name": "tier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "referrer",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "subscribersList",
            "inputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalCashbackPaid",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalGrossRevenue",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalNetRevenue",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalPendingReferralRewards",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalPlatformFeesPaid",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalReferralRewardsDistributed",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalReferralSubscriptions",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalReferrers",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalSubscribers",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalValidReferralRevenue",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "transferOwnership",
            "inputs": [
                {
                    "name": "newOwner",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "updateBrandConfig",
            "inputs": [
                {
                    "name": "newConfig",
                    "type": "tuple",
                    "internalType": "struct DataTypes.BrandConfig",
                    "components": [
                        {
                            "name": "name",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "symbol",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "description",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "logoUri",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "websiteUrl",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "primaryColor",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "maxTier",
                            "type": "uint8",
                            "internalType": "uint8"
                        },
                        {
                            "name": "enabledPeriods",
                            "type": "bool[4]",
                            "internalType": "bool[4]"
                        },
                        {
                            "name": "tierNames",
                            "type": "string[4]",
                            "internalType": "string[4]"
                        }
                    ]
                }
            ],
            "outputs": [],
            "stateMutability": "nonpayable"
        },
        {
            "type": "function",
            "name": "upgrade",
            "inputs": [
                {
                    "name": "newTier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "newPeriod",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "userOperationIndices",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "userSubscriptions",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "referrer",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "tier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "startTime",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "endTime",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "paidAmount",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalRewardsEarned",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalSpent",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "withdraw",
            "inputs": [
                {
                    "name": "to",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [],
            "stateMutability": "nonpayable"
        },
        {
            "type": "event",
            "name": "BrandConfigUpdated",
            "inputs": [
                {
                    "name": "name",
                    "type": "string",
                    "indexed": false,
                    "internalType": "string"
                },
                {
                    "name": "symbol",
                    "type": "string",
                    "indexed": false,
                    "internalType": "string"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "Downgraded",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "fromTier",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "toTier",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                },
                {
                    "name": "endTime",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "OwnershipHandoverCanceled",
            "inputs": [
                {
                    "name": "pendingOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "OwnershipHandoverRequested",
            "inputs": [
                {
                    "name": "pendingOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "OwnershipTransferred",
            "inputs": [
                {
                    "name": "oldOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "newOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "PlanConfigUpdated",
            "inputs": [
                {
                    "name": "tier",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "prices",
                    "type": "uint256[4]",
                    "indexed": false,
                    "internalType": "uint256[4]"
                },
                {
                    "name": "customName",
                    "type": "string",
                    "indexed": false,
                    "internalType": "string"
                },
                {
                    "name": "features",
                    "type": "string[]",
                    "indexed": false,
                    "internalType": "string[]"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "ReferralRewardAccrued",
            "inputs": [
                {
                    "name": "referrer",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "subscriber",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "referrerReward",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                },
                {
                    "name": "subscriberReward",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "ReferralRewardsClaimed",
            "inputs": [
                {
                    "name": "referrer",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "Renewed",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "tier",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                },
                {
                    "name": "newEndTime",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "Subscribed",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "tier",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                },
                {
                    "name": "endTime",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "Upgraded",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "fromTier",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "toTier",
                    "type": "uint8",
                    "indexed": false,
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                },
                {
                    "name": "newEndTime",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "Withdrawn",
            "inputs": [
                {
                    "name": "to",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "indexed": false,
                    "internalType": "uint256"
                }
            ],
            "anonymous": false
        },
        {
            "type": "error",
            "name": "AlreadyInitialized",
            "inputs": []
        },
        {
            "type": "error",
            "name": "AlreadySubscribed",
            "inputs": []
        },
        {
            "type": "error",
            "name": "CannotDowngradeToSameTier",
            "inputs": []
        },
        {
            "type": "error",
            "name": "CannotUpgradeToSameTier",
            "inputs": []
        },
        {
            "type": "error",
            "name": "ClaimCooldownNotMet",
            "inputs": []
        },
        {
            "type": "error",
            "name": "ExcessPayment",
            "inputs": []
        },
        {
            "type": "error",
            "name": "InsufficientBalance",
            "inputs": []
        },
        {
            "type": "error",
            "name": "InsufficientPayment",
            "inputs": []
        },
        {
            "type": "error",
            "name": "InvalidPeriod",
            "inputs": []
        },
        {
            "type": "error",
            "name": "InvalidPrice",
            "inputs": []
        },
        {
            "type": "error",
            "name": "InvalidTier",
            "inputs": []
        },
        {
            "type": "error",
            "name": "NewOwnerIsZeroAddress",
            "inputs": []
        },
        {
            "type": "error",
            "name": "NoActiveSubscription",
            "inputs": []
        },
        {
            "type": "error",
            "name": "NoHandoverRequest",
            "inputs": []
        },
        {
            "type": "error",
            "name": "NoRewardsToClaim",
            "inputs": []
        },
        {
            "type": "error",
            "name": "NotInitialized",
            "inputs": []
        },
        {
            "type": "error",
            "name": "ProjectAlreadyInitialized",
            "inputs": []
        },
        {
            "type": "error",
            "name": "Reentrancy",
            "inputs": []
        },
        {
            "type": "error",
            "name": "SubscriptionStillActive",
            "inputs": []
        },
        {
            "type": "error",
            "name": "TransferFailed",
            "inputs": []
        },
        {
            "type": "error",
            "name": "Unauthorized",
            "inputs": []
        },
        {
            "type": "error",
            "name": "ZeroAddress",
            "inputs": []
        },
        {
            "type": "error",
            "name": "ZeroAmount",
            "inputs": []
        },
        
        {
            "type": "function",
            "name": "CLAIM_COOLDOWN",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "REFERRAL_REWARD_RATE",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "brandConfig",
            "inputs": [],
            "outputs": [
                {
                    "name": "name",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "symbol",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "description",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "logoUri",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "websiteUrl",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "primaryColor",
                    "type": "string",
                    "internalType": "string"
                },
                {
                    "name": "maxTier",
                    "type": "uint8",
                    "internalType": "uint8"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "cancelOwnershipHandover",
            "inputs": [],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "completeOwnershipHandover",
            "inputs": [
                {
                    "name": "pendingOwner",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "factory",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getAllPlans",
            "inputs": [],
            "outputs": [
                {
                    "name": "allPlans",
                    "type": "tuple[]",
                    "internalType": "struct DataTypes.SubscriptionPlan[]",
                    "components": [
                        {
                            "name": "enabled",
                            "type": "bool",
                            "internalType": "bool"
                        },
                        {
                            "name": "prices",
                            "type": "uint256[4]",
                            "internalType": "uint256[4]"
                        },
                        {
                            "name": "features",
                            "type": "string[]",
                            "internalType": "string[]"
                        }
                    ]
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getBrandConfig",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "tuple",
                    "internalType": "struct DataTypes.BrandConfig",
                    "components": [
                        {
                            "name": "name",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "symbol",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "description",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "logoUri",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "websiteUrl",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "primaryColor",
                            "type": "string",
                            "internalType": "string"
                        },
                        {
                            "name": "maxTier",
                            "type": "uint8",
                            "internalType": "uint8"
                        },
                        {
                            "name": "enabledPeriods",
                            "type": "bool[4]",
                            "internalType": "bool[4]"
                        },
                        {
                            "name": "tierNames",
                            "type": "string[4]",
                            "internalType": "string[4]"
                        }
                    ]
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getEnabledPeriods",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "bool[4]",
                    "internalType": "bool[4]"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getOperationHistoryPaginated",
            "inputs": [
                {
                    "name": "offset",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "limit",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "records",
                    "type": "tuple[]",
                    "internalType": "struct DataTypes.OperationRecord[]",
                    "components": [
                        {
                            "name": "user",
                            "type": "address",
                            "internalType": "address"
                        },
                        {
                            "name": "operationType",
                            "type": "uint8",
                            "internalType": "enum DataTypes.OperationType"
                        },
                        {
                            "name": "fromTier",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionTier"
                        },
                        {
                            "name": "toTier",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionTier"
                        },
                        {
                            "name": "fromPeriod",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionPeriod"
                        },
                        {
                            "name": "toPeriod",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionPeriod"
                        },
                        {
                            "name": "amount",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "timestamp",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "newEndTime",
                            "type": "uint256",
                            "internalType": "uint256"
                        }
                    ]
                },
                {
                    "name": "total",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getPlan",
            "inputs": [
                {
                    "name": "tier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "tuple",
                    "internalType": "struct DataTypes.SubscriptionPlan",
                    "components": [
                        {
                            "name": "enabled",
                            "type": "bool",
                            "internalType": "bool"
                        },
                        {
                            "name": "prices",
                            "type": "uint256[4]",
                            "internalType": "uint256[4]"
                        },
                        {
                            "name": "features",
                            "type": "string[]",
                            "internalType": "string[]"
                        }
                    ]
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getProjectStats",
            "inputs": [],
            "outputs": [
                {
                    "name": "grossRevenue",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "netRevenue",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "subscribers",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "referrers",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "validReferralRevenue",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "referralRewardsDistributed",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "pendingReferralRewards",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "referralSubscriptions",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "platformFees",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "cashbackPaid",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getReferralAccount",
            "inputs": [
                {
                    "name": "referrer",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "tuple",
                    "internalType": "struct DataTypes.ReferralAccount",
                    "components": [
                        {
                            "name": "pendingRewards",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "totalRewards",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "lastClaimTime",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "referralCount",
                            "type": "uint256",
                            "internalType": "uint256"
                        }
                    ]
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getReferralStats",
            "inputs": [],
            "outputs": [
                {
                    "name": "totalSubscriptions",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalRewards",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "pendingRewards",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getReferralsPaginated",
            "inputs": [
                {
                    "name": "referrer",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "offset",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "limit",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "referredUsers",
                    "type": "address[]",
                    "internalType": "address[]"
                },
                {
                    "name": "total",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getSubscribersPaginated",
            "inputs": [
                {
                    "name": "offset",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "limit",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "subscribers",
                    "type": "address[]",
                    "internalType": "address[]"
                },
                {
                    "name": "subscriptions",
                    "type": "tuple[]",
                    "internalType": "struct DataTypes.UserSubscription[]",
                    "components": [
                        {
                            "name": "user",
                            "type": "address",
                            "internalType": "address"
                        },
                        {
                            "name": "referrer",
                            "type": "address",
                            "internalType": "address"
                        },
                        {
                            "name": "tier",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionTier"
                        },
                        {
                            "name": "period",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionPeriod"
                        },
                        {
                            "name": "startTime",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "endTime",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "paidAmount",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "totalRewardsEarned",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "totalSpent",
                            "type": "uint256",
                            "internalType": "uint256"
                        }
                    ]
                },
                {
                    "name": "total",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getTierNames",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "string[4]",
                    "internalType": "string[4]"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getUserOperationHistoryPaginated",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "offset",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "limit",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "records",
                    "type": "tuple[]",
                    "internalType": "struct DataTypes.OperationRecord[]",
                    "components": [
                        {
                            "name": "user",
                            "type": "address",
                            "internalType": "address"
                        },
                        {
                            "name": "operationType",
                            "type": "uint8",
                            "internalType": "enum DataTypes.OperationType"
                        },
                        {
                            "name": "fromTier",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionTier"
                        },
                        {
                            "name": "toTier",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionTier"
                        },
                        {
                            "name": "fromPeriod",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionPeriod"
                        },
                        {
                            "name": "toPeriod",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionPeriod"
                        },
                        {
                            "name": "amount",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "timestamp",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "newEndTime",
                            "type": "uint256",
                            "internalType": "uint256"
                        }
                    ]
                },
                {
                    "name": "total",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getUserSubscription",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "tuple",
                    "internalType": "struct DataTypes.UserSubscription",
                    "components": [
                        {
                            "name": "user",
                            "type": "address",
                            "internalType": "address"
                        },
                        {
                            "name": "referrer",
                            "type": "address",
                            "internalType": "address"
                        },
                        {
                            "name": "tier",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionTier"
                        },
                        {
                            "name": "period",
                            "type": "uint8",
                            "internalType": "enum DataTypes.SubscriptionPeriod"
                        },
                        {
                            "name": "startTime",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "endTime",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "paidAmount",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "totalRewardsEarned",
                            "type": "uint256",
                            "internalType": "uint256"
                        },
                        {
                            "name": "totalSpent",
                            "type": "uint256",
                            "internalType": "uint256"
                        }
                    ]
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getUserTotalRewards",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "getWithdrawableBalance",
            "inputs": [],
            "outputs": [
                {
                    "name": "withdrawableAmount",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalBalance",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "reservedForReferrals",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "hasActiveSubscription",
            "inputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "bool",
                    "internalType": "bool"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "initialized",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "bool",
                    "internalType": "bool"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "operationHistory",
            "inputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "operationType",
                    "type": "uint8",
                    "internalType": "enum DataTypes.OperationType"
                },
                {
                    "name": "fromTier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "toTier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "fromPeriod",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "toPeriod",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "amount",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "timestamp",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "newEndTime",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "owner",
            "inputs": [],
            "outputs": [
                {
                    "name": "result",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "ownershipHandoverExpiresAt",
            "inputs": [
                {
                    "name": "pendingOwner",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "result",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "plans",
            "inputs": [
                {
                    "name": "",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                }
            ],
            "outputs": [
                {
                    "name": "enabled",
                    "type": "bool",
                    "internalType": "bool"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "referralAccounts",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "pendingRewards",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalRewards",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "lastClaimTime",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "referralCount",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "referrerToUsers",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "renounceOwnership",
            "inputs": [],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "requestOwnershipHandover",
            "inputs": [],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "subscribersList",
            "inputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalCashbackPaid",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalGrossRevenue",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalNetRevenue",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalPendingReferralRewards",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalPlatformFeesPaid",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalReferralRewardsDistributed",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalReferralSubscriptions",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalReferrers",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalSubscribers",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "totalValidReferralRevenue",
            "inputs": [],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "transferOwnership",
            "inputs": [
                {
                    "name": "newOwner",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [],
            "stateMutability": "payable"
        },
        {
            "type": "function",
            "name": "userOperationIndices",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "outputs": [
                {
                    "name": "",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "function",
            "name": "userSubscriptions",
            "inputs": [
                {
                    "name": "",
                    "type": "address",
                    "internalType": "address"
                }
            ],
            "outputs": [
                {
                    "name": "user",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "referrer",
                    "type": "address",
                    "internalType": "address"
                },
                {
                    "name": "tier",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionTier"
                },
                {
                    "name": "period",
                    "type": "uint8",
                    "internalType": "enum DataTypes.SubscriptionPeriod"
                },
                {
                    "name": "startTime",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "endTime",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "paidAmount",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalRewardsEarned",
                    "type": "uint256",
                    "internalType": "uint256"
                },
                {
                    "name": "totalSpent",
                    "type": "uint256",
                    "internalType": "uint256"
                }
            ],
            "stateMutability": "view"
        },
        {
            "type": "event",
            "name": "OwnershipHandoverCanceled",
            "inputs": [
                {
                    "name": "pendingOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "OwnershipHandoverRequested",
            "inputs": [
                {
                    "name": "pendingOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                }
            ],
            "anonymous": false
        },
        {
            "type": "event",
            "name": "OwnershipTransferred",
            "inputs": [
                {
                    "name": "oldOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                },
                {
                    "name": "newOwner",
                    "type": "address",
                    "indexed": true,
                    "internalType": "address"
                }
            ],
            "anonymous": false
        },
        {
            "type": "error",
            "name": "AlreadyInitialized",
            "inputs": []
        },
        {
            "type": "error",
            "name": "NewOwnerIsZeroAddress",
            "inputs": []
        },
        {
            "type": "error",
            "name": "NoHandoverRequest",
            "inputs": []
        },
        {
            "type": "error",
            "name": "Unauthorized",
            "inputs": []
        }
    
    ]
        // Factory bytecode (you'll need to add the actual bytecode)
        const FACTORY_BYTECODE = `0x60803461014e57601f613c2138819003918201601f19168301916001600160401b0383118484101761012b57808492604094855283398101031261014e57610052602061004b83610152565b9201610152565b662386f26fc100006002556101f46003556001600160a01b0390911690811561013f576001600160a01b031690811561013f5780638b78c6d819555f7f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a35f80546001600160a01b0319169190911790556040516125498082016001600160401b0381118382101761012b5782916116d8833903905ff0801561012057600180546001600160a01b0319166001600160a01b039290921691909117905560405161157190816101678239f35b6040513d5f823e3d90fd5b634e487b7160e01b5f52604160045260245ffd5b63d92e233d60e01b5f5260045ffd5b5f80fd5b51906001600160a01b038216820361014e5756fe6080806040526004361015610059575b50361561001a575f80fd5b335f908152600660205260409020546001600160a01b03161561004857610043346009546114ee565b600955005b61005434600a546114ee565b600a55005b5f905f3560e01c908163020e9a931461119e5750806305e9af271461115e5780630cbab4f7146111145780630db25b77146110c0578063107046bd1461109757806312da0db714611065578063164e68de14610f7d5780631f9e55b714610f005780632547ae0014610ee35780632569296214610e4957806333ee056814610ec4578063464d6bae14610ea75780634bc6d08214610e6a5780634cf898ab14610e4e57806354d1f13d14610e495780636bad654114610e2c578063715018a614610e1957806377dde52614610db75780637db2d9c714610d7f578063812739a214610d625780638da5cb5b14610d3657806392c121a614610480578063939e576714610462578063ac18992c1461042d578063b1eca8b414610404578063c247e68614610392578063c58bfb6614610374578063ca017aef146102bb578063f04e283e14610298578063f2fde38b14610227578063f4ea93d81461020a578063fee81cf4146101ea5763ff6acade0361000f57346101e757806003193601126101e757602060405160648152f35b80fd5b50346101e75760203660031901126101e7576102046111c0565b506112f6565b50346101e757806003193601126101e75760206040516127108152f35b5060203660031901126101e75761023c6111c0565b61024461151f565b8060601b1561028b5760018060a01b031680638b78c6d819547f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08480a3638b78c6d8195580f35b637448fbae82526004601cfd5b5060203660031901126101e7576102ad6111c0565b506102b661151f565b6112f6565b50346101e75760403660031901126101e7576004356001600160401b038111610370576102ec9036906004016112b0565b90602435916001600160401b03831161037057602061034b61031460409536906004016112b0565b8286519384928180850197805191829101895e840190828201898152815193849201905e010185815203601f198101835282611274565b519020815260076020528160018060a01b039120541681519080151582526020820152f35b5080fd5b50346101e757806003193601126101e7576020600354604051908152f35b50346101e75760203660031901126101e7576004356103af61151f565b610bb881116103f25760407fd347e206f25a89b917fc9482f1a2d294d749baa4dc9bde7fb495ee11fe49164391600354908060035582519182526020820152a180f35b630cbf8cb160e11b8252600452602490fd5b50346101e757806003193601126101e7576001546040516001600160a01b039091168152602090f35b50346101e757806003193601126101e7576080600854600954600a544791604051938452602084015260408301526060820152f35b50346101e757806003193601126101e7576020600854604051908152f35b50610240366003190112610b04576004356001600160401b038111610b04576101806003198236030112610b04576040519061012082018281106001600160401b03821117610d225760405280600401356001600160401b038111610b04576104ef90600436918401016112b0565b825260248101356001600160401b038111610b045761051490600436918401016112b0565b6020830190815260448201356001600160401b038111610b045761053e90600436918501016112b0565b926040810193845260648301356001600160401b038111610b045761056990600436918601016112b0565b936060820194855260848401356001600160401b038111610b045761059490600436918701016112b0565b906080830191825260a48501356001600160401b038111610b04576105bf90600436918801016112b0565b60a0840190815260c48601359060ff82168203610b045760c085019182523661010388011215610b04576080604051976105f9828a611274565b610164810189368211610b045760e48301905b828210610d0957505060e08801998a5235906001600160401b038211610b04570136602382011215610b0457604051906106468383611274565b81906084810190368211610b045760048101925b828410610cda575050505061010087019081526024356001600160a01b03811699908a9003610b04573660631215610b04576040519361069a8486611274565b843661024411610b04576044905b6102448210610c805750503068929eee149b4bd212685414610c73573068929eee149b4bd2126855600254803403610c5d57506106e7346008546114ee565b6008558a15610c4e5788515115610c085789515115610bc257606489515111610b845760148a515111610b3e57885160206107558c51826040519384928180850197805191829101895e8401908282015f8152815193849201905e01015f815203601f198101835282611274565b5190205f818152600760205260409020549098906001600160a01b0316610b15575f80546c5af43d3d93803e602a57fd5bf36021526001600160a01b031660145273602c3d8160093d39f33d3d3d3d363d3d37363d7381528990603590600c90f58015610b08575f6021526001600160a01b03169c8d3b15610b045760405163c613551560e01b815261026060048201528b5161018061026483015290998a98979695949392918e9061080d906103e48c01906114fb565b90518a820361026319016102848c015261082791906114fb565b905189820361026319016102a48b015261084191906114fb565b905188820361026319016102c48a015261085b91906114fb565b905187820361026319016102e489015261087591906114fb565b9051868203610263190161030488015261088f91906114fb565b955160ff16610324860152515f61034486015b60048210610ae8575050905184860361026319016103c4860152828601959091505f815b60048210610abb5750505050306024840152886044840152606483015f905b60048210610a755750505050805f920381838a5af18015610a6a57610a55575b50600454600160401b811015610a415780600161092792016004556004611202565b81546001600160a01b0360039290921b91821b19169087901b179055838652600560205260408620805490600160401b821015610a2d577f82d2bdec36cf20e995d0ce1e3ce8a38bc182f92659dab188941a2eb513dbd9c5936040602099610a039561099e86610a109660018e9c99018155611202565b81549060031b908b821b9160018060a01b03901b191617905588825260068c528282208a6001600160601b0360a01b825416179055815260078b5220866001600160601b0360a01b8254161790555191516040519384936060855260608501906114fb565b908382038a8501526114fb565b4260408301520390a33868929eee149b4bd2126855604051908152f35b634e487b7160e01b88526041600452602488fd5b634e487b7160e01b87526041600452602487fd5b610a629196505f90611274565b5f945f610905565b6040513d5f823e3d90fd5b909183819495505182905f915b60048310610aa257505050602090600192019401910185939291926108e5565b8151815286935060019092019160209182019101610a82565b91939495509195602080610ad783876001950386528a516114fb565b9801920192018795949391926108c6565b82511515815288965060209283019260019290920191016108a2565b5f80fd5b63301164255f526004601cfd5b5f8981526007602052604081205463e0a460cd60e01b82526001600160a01b0316600452602490fd5b60405163d647364f60e01b815260206004820152601760248201527f50726f6a6563742073796d626f6c20746f6f206c6f6e670000000000000000006044820152606490fd5b60405163d647364f60e01b815260206004820152601560248201527450726f6a656374206e616d6520746f6f206c6f6e6760581b6044820152606490fd5b60405163d647364f60e01b815260206004820152601e60248201527f50726f6a6563742073796d626f6c2063616e6e6f7420626520656d70747900006044820152606490fd5b60405163d647364f60e01b815260206004820152601c60248201527f50726f6a656374206e616d652063616e6e6f7420626520656d707479000000006044820152606490fd5b63d92e233d60e01b5f5260045ffd5b631e0bd6c160e31b5f523460045260245260445ffd5b63ab143c065f526004601cfd5b36601f83011215610b0457604051610c988782611274565b80878401368111610b045791889285949294905b808210610cc4575050815292019160200190506106a8565b813586526020958601958b955090910190610cac565b83356001600160401b038111610b0457602091610cfe8392600436918701016112b0565b81520193019261065a565b81358015158103610b045781526020918201910161060c565b634e487b7160e01b5f52604160045260245ffd5b34610b04575f366003190112610b0457638b78c6d819546040516001600160a01b039091168152602090f35b34610b04575f366003190112610b04576020600454604051908152f35b34610b04576020366003190112610b04576001600160a01b03610da06111c0565b165f526005602052602060405f2054604051908152f35b34610b04576040366003190112610b0457610dd06111c0565b6001600160a01b03165f90815260056020526040902080546024359190821015610b0457602091610e0091611202565b905460405160039290921b1c6001600160a01b03168152f35b5f366003190112610b04576102b661151f565b34610b04575f366003190112610b04576020600254604051908152f35b611217565b34610b04575f366003190112610b04576020604051610bb88152f35b34610b04576060366003190112610b0457610e93610e866111c0565b6044359060243590611441565b90610ea360405192839283611227565b0390f35b34610b04575f366003190112610b04576020600a54604051908152f35b34610b04576040366003190112610b0457610e936024356004356113a5565b34610b04575f366003190112610b04576020600954604051908152f35b34610b04576020366003190112610b0457610f196111c0565b610f2161151f565b6001600160a01b03168015610c4e5760407faa3f731066a578e5f39b4215468d826cdd15373cbc0dfc9cb9bdc649718ef7da915f5490806001600160601b0360a01b8316175f5582519160018060a01b031682526020820152a1005b34610b04576020366003190112610b0457610f966111c0565b610f9e61151f565b3068929eee149b4bd212685414610c73573068929eee149b4bd21268556001600160a01b03168015610c4e5747908115611029575f80809381935af13d15611024573d610fea81611295565b90610ff86040519283611274565b81525f60203d92013e5b15611015573868929eee149b4bd2126855005b6312171d8360e31b5f5260045ffd5b611002565b60405163d647364f60e01b81526020600482015260136024820152724e6f206665657320746f20776974686472617760681b6044820152606490fd5b34610b04576020366003190112610b04576004355f526007602052602060018060a01b0360405f205416604051908152f35b34610b04576020366003190112610b0457600435600454811015610b0457610e006020916111d6565b34610b04576020366003190112610b04577f5de302eeb1c80d4fb0c0953b692353f09ddf431411b8eb2034d5e8576956191260406004356110ff61151f565b600254908060025582519182526020820152a1005b34610b04576020366003190112610b045760035460043581810291811591830414171561114a5760209061271060405191048152f35b634e487b7160e01b5f52601160045260245ffd5b34610b04576020366003190112610b04576001600160a01b0361117f6111c0565b165f526006602052602060018060a01b0360405f205416604051908152f35b34610b04575f366003190112610b04575f546001600160a01b03168152602090f35b600435906001600160a01b0382168203610b0457565b6004548110156111ee5760045f5260205f2001905f90565b634e487b7160e01b5f52603260045260245ffd5b80548210156111ee575f5260205f2001905f90565b5f366003190112156112f6575f80fd5b92919060408401906040855280518092526020606086019101915f5b81811061125557505060209150930152565b83516001600160a01b0316835260209384019390920191600101611243565b90601f801991011681019081106001600160401b03821117610d2257604052565b6001600160401b038111610d2257601f01601f191660200190565b81601f82011215610b04578035906112c782611295565b926112d56040519485611274565b82845260208383010111610b0457815f926020809301838601378301015290565b60405162461bcd60e51b815260206004820152601960248201527f546869732066756e6374696f6e2069732064697361626c6564000000000000006044820152606490fd5b6001600160401b038111610d225760051b60200190565b9061135c8261133b565b6113696040519182611274565b828152809261137a601f199161133b565b0190602036910137565b9190820391821161114a57565b80518210156111ee5760209160051b010190565b916004549182841015611424576064811161141c575b6113c58484611384565b908082101561141557505b6113d981611352565b935f5b8281106113e857505050565b806113f660019284016111d6565b838060a01b0391549060031b1c1661140e8289611391565b52016113dc565b90506113d0565b5060646113bb565b50909150604051611436602082611274565b5f81525f3681379190565b6001600160a01b03165f908152600560205260409020805491939192838510156114db57606481116114d3575b6114788585611384565b90808210156114cb5750905b61148d82611352565b945f5b83811061149d5750505050565b806114ac600192840185611202565b838060a01b0391549060031b1c166114c4828a611391565b5201611490565b905090611484565b50606461146e565b5050909150604051611436602082611274565b9190820180921161114a57565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b638b78c6d81954330361152e57565b6382b429005f526004601cfdfea2646970667358221220c92c0c64b62d1a9a135ac93387485c5b987fe737e1a653547b6f9e6e7a009be164736f6c634300081c00336080806040523460155761252f908161001a8239f35b5f80fdfe6080806040526004361015610012575f80fd5b5f3560e01c90816309ebc66f14611824575080630a0e419e146114585780630d4e80ae1461138e578063158ef93e1461136957806315e2475f1461134c5780631ca2f88a1461131357806325692962146112ca57806327108cb1146112ad57806327c9fce7146112555780632aeaf7f6146112385780632c86b7b21461121b5780632d6c1661146111af5780633171b76f1461111157806337c909ec146110f4578063414a1100146110785780634a944a041461105b57806354d1f13d146110175780635ebdc22e14610fdf57806360a31a8814610f9e57806362d03cb714610f81578063666c4b5c14610f465780636b5adf3b14610f0e578063715018a614610ec55780637399a71914610e9c5780637ee7305314610e8557806383f9eb4614610e685780638da5cb5b14610e3c57806398de396a14610c4e578063a12b212114610b53578063a21ed26c14610b36578063a2aaed2614610b0f578063bb4356a714610ade578063be788e7014610a8b578063bebe4a5714610a4e578063c30dce51146109f4578063c45a0155146109cc578063ca86908a146109af578063ca8c7e9e1461094d578063cf14b9e414610897578063d6ec7db71461087a578063ebbeec08146107ae578063f04e283e14610761578063f2fde38b14610724578063fdb78243146102415763fee81cf41461020b575f80fd5b3461023d57602036600319011261023d57610224611b94565b63389a75e1600c525f52602080600c2054604051908152f35b5f80fd5b3461023d575f36600319011261023d5760405161025d8161188a565b60608152606060208201526060604082015260608082015260606080820152606060a08201525f60c082015260809060405161029983826118a7565b8236823760e08201526101006102ad612153565b9101526040516102bc8161188a565b6040515f5f548060011c916001821691821561071a575b6020841083146105705783855284929081156106fb575060011461069e575b6102fe925003826118a7565b8152604051915f6001548060011c9160018216918215610694575b6020841083146105705783875286929081156106755750600114610616575b610344925003846118a7565b602082019283526040515f6002548060011c916001821691821561060c575b6020841083146105705783855284929081156105ed575060011461058e575b61038e925003826118a7565b604083019081526040515f600354908160011c60018316928315610584575b60208210841461057057818552849390811561055457506001146104fa575b50036103d890826118a7565b606084019081526103e76118c9565b8385019081526103f5611997565b9060a0860191825260065460ff169460c08701958652610413611e74565b9360e08801948552610423612180565b956101008901968752604051998a9960208b525160208b0161018090526101a08b0161044e91611af9565b90518a8203601f190160408c01526104669190611af9565b9051898203601f190160608b015261047e9190611af9565b905191601f19898303019089015261049591611af9565b9051868203601f190160a08801526104ad9190611af9565b9051858203601f190160c08701526104c59190611af9565b925160ff1660e08501525161010084016104de91611b6b565b51828203601f19016101808401526104f69190611ca0565b0390f35b60035f90815291507fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b5b8183106105385750508101602001876103cc565b6020919350806001915483858801015201910190918392610524565b90506020925060ff191682840152151560051b820101876103cc565b634e487b7160e01b5f52602260045260245ffd5b90607f16906103ad565b5060025f90815290917f405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace5b8183106105d157505090602061038e92820101610382565b60209193508060019154838588010152019101909183926105b9565b6020925061038e94915060ff191682840152151560051b820101610382565b92607f1692610363565b5060015f90815290917fb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf65b81831061065957505090602061034492820101610338565b6020919350806001915483858a01015201910190918592610641565b6020925061034494915060ff191682840152151560051b820101610338565b92607f1692610319565b505f80805290917f290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e5635b8183106106df5750509060206102fe928201016102f2565b60209193508060019154838588010152019101909183926106c7565b602092506102fe94915060ff191682840152151560051b8201016102f2565b92607f16926102d3565b602036600319011261023d57610738611b94565b6107406124a0565b8060601b1561075457610752906124bc565b005b637448fbae5f526004601cfd5b602036600319011261023d57610775611b94565b61077d6124a0565b63389a75e1600c52805f526020600c2090815442116107a1575f61075292556124bc565b636f5e88185f526004601cfd5b3461023d57602036600319011261023d576107c7611b94565b6107cf611efe565b5060018060a01b03165f52600d60205261012060405f206006604051916107f58361188a565b80546001600160a01b0390811684526001820154908116602085015260ff9060a081901c821661082481611b4d565b604086015260a81c1661083681611b4d565b606084015260028101546080840152600381015460a0840152600481015460c0840152600581015460e084015201546101008201526108786040518092611c29565bf35b3461023d575f36600319011261023d576020601454604051908152f35b3461023d57602036600319011261023d576001600160a01b036108b8611b94565b165f52600d60205261012060405f2060018060a01b038154169060018101549060ff8260a01c1660ff8360a81c166002830154600384015491600485015493600660058701549601549660405198895260018060a01b0316602089015261091e81611b4d565b604088015261092c81611b4d565b6060870152608086015260a085015260c084015260e0830152610100820152f35b3461023d57604036600319011261023d57610966611b94565b6001600160a01b03165f908152601b602052604090208054602435919082101561023d5760209161099691611bc2565b905460405160039290921b1c6001600160a01b03168152f35b3461023d575f36600319011261023d576020601554604051908152f35b3461023d575f36600319011261023d57600c546040516001600160a01b039091168152602090f35b3461023d57602036600319011261023d576001600160a01b03610a15611b94565b165f52600f602052608060405f208054906001810154906003600282015491015491604051938452602084015260408301526060820152f35b3461023d57602036600319011261023d576001600160a01b03610a6f611b94565b165f52600d6020526020600360405f2001546040519042108152f35b3461023d575f36600319011261023d57476012548082115f14610ad4576104f6610ab58284611fc9565b915b604051938493846040919493926060820195825260208201520152565b6104f65f91610ab7565b3461023d575f36600319011261023d5760105460115460125460408051938452602084019290925290820152606090f35b3461023d57610b26610b2036611bd7565b9061240e565b906104f660405192839283611d08565b3461023d575f36600319011261023d576020601654604051908152f35b3461023d57602036600319011261023d57600435600481101561023d57610b786123de565b50610b8281611b4d565b5f52600e60205260405f2060405190610b9a8261186e565b805460ff1615158252604051600182015f825b60048210610c38578560058686610bc56080826118a7565b602084015201908154610bd781611eb4565b92610be560405194856118a7565b81845260208401905f5260205f205f915b838310610c1b576104f685876040820152604051918291602083526020830190611dd7565b600160208192610c2a85611a43565b815201920192019190610bf6565b6001602081928554815201930191019091610bad565b3461023d575f36600319011261023d5760ff6006541660018101808211610d7757610c7881611eb4565b90610c8660405192836118a7565b808252610c95601f1991611eb4565b015f5b818110610e25575f84845b60ff831692828411610dbe57610cb884611b4d565b610cc184611b4d565b835f52600e60205260405f2060405190610cda8261186e565b805460ff16151582526040515f60018301825b60048310610da8575050509081610d0760806005946118a7565b6020840152018054610d1881611eb4565b91610d2660405193846118a7565b81835260208301905f5260205f20905f905b838210610d8b5750505050948160ff9495966040610d63940152610d5c8287611fe3565b5284611fe3565b501660ff8114610d77576001019190610ca3565b634e487b7160e01b5f52601160045260245ffd5b600160208192610d9a86611a43565b815201930191019091610d38565b6001602081928454815201920192019190610ced565b506040518091602082016020835281518091526040830190602060408260051b8601019301915f905b828210610df657505050500390f35b91936001919395506020610e158192603f198a82030186528851611dd7565b9601920192018594939192610de7565b602090610e306123de565b82828601015201610c98565b3461023d575f36600319011261023d57638b78c6d819546040516001600160a01b039091168152602090f35b3461023d575f36600319011261023d576020601054604051908152f35b3461023d57610b26610e9636611cde565b9161231b565b3461023d57602036600319011261023d57600435601a5481101561023d57610996602091611baa565b5f36600319011261023d57610ed86124a0565b5f638b78c6d819547f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08280a35f638b78c6d81955005b3461023d57610f3c610f28610f2236611cde565b916121bc565b604051928392604084526040840190611bed565b9060208301520390f35b3461023d57602036600319011261023d576001600160a01b03610f67611b94565b165f52600d6020526020600560405f200154604051908152f35b3461023d575f36600319011261023d576020601854604051908152f35b3461023d57602036600319011261023d57600435600481101561023d57610fc481611b4d565b5f52600e602052602060ff60405f2054166040519015158152f35b3461023d575f36600319011261023d57610ff7612153565b506104f6611003612180565b604051918291602083526020830190611ca0565b5f36600319011261023d5763389a75e1600c52335f525f6020600c2055337ffa7b8eab7da67f412cc9575ed43464468f9bfbae89d1675917346ca6d8fe3c925f80a2005b3461023d575f36600319011261023d576020601354604051908152f35b3461023d5761108f61108936611bd7565b90611ff7565b91906110a660405192606084526060840190611bed565b9282840360208401526020808351958681520192015f945b8086106110d357505082935060408301520390f35b90926020610120826110e86001948851611c29565b019401950194906110be565b3461023d575f36600319011261023d57602060405162093a808152f35b3461023d57602036600319011261023d5761112a611b94565b5f60606040516111398161183e565b828152826020820152826040820152015260018060a01b03165f52600f602052608060405f2060405161116b8161183e565b815491828252600181015460208301908152606060036002840154936040860194855201549301928352604051938452516020840152516040830152516060820152f35b3461023d575f36600319011261023d5761014060135460145460175460185460195460115460125491601054936015549560165497604051998a5260208a015260408901526060880152608087015260a086015260c085015260e0840152610100830152610120820152f35b3461023d575f36600319011261023d576020601154604051908152f35b3461023d575f36600319011261023d576020601954604051908152f35b3461023d57604036600319011261023d5761126e611b94565b6001600160a01b03165f908152601d602052604090208054602435919082101561023d5760209161129e91611bc2565b90549060031b1c604051908152f35b3461023d575f36600319011261023d576020601254604051908152f35b5f36600319011261023d5763389a75e1600c52335f526202a30042016020600c2055337fdbf36a107da19e49527a7176a1babf963b4b0ff8cde35ee35d6cd8f1f9ac7e1d5f80a2005b3461023d575f36600319011261023d57608060405161133282826118a7565b369037608061133f611e74565b6108786040518092611b6b565b3461023d575f36600319011261023d576020601754604051908152f35b3461023d575f36600319011261023d57602060ff600c5460a01c166040519015158152f35b3461023d57602036600319011261023d57600435601c5481101561023d576113b861012091611b1d565b5080549060ff8260a01c169060ff8360a81c1660ff8460b01c1660ff8560b81c1660ff8660c01c169160018501549360036002870154960154966040519860018060a01b0316895261140981611b4d565b602089015261141781611b4d565b604088015261142581611b4d565b606087015261143381611b4d565b608086015261144181611b4d565b60a085015260c084015260e0830152610100820152f35b3461023d575f36600319011261023d576040515f5f548060011c916001821691821561181a575b6020841083146105705783855284929081156117fb575060011461179e575b6114aa925003826118a7565b604051905f6001548060011c9160018216918215611794575b6020841083146105705783865285929081156117755750600114611716575b6114ee925003836118a7565b604051915f6002548060011c916001821691821561170c575b6020841083146105705783875286929081156116ed575060011461168e575b611532925003846118a7565b604051925f6003548060011c90600181168015611684575b602083108114610570578288529081156116605750600114611606575b50906115ee8561157f60e096976115fc9503826118a7565b6115e061158a6118c9565b916115d2611596611997565b956115c460ff60065416996115b66040519d8d8f9e8f9081520190611af9565b8c810360208e015290611af9565b908a820360408c0152611af9565b9088820360608a0152611af9565b908682036080880152611af9565b9084820360a0860152611af9565b9060c08301520390f35b60035f90815291507fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b5b81831061164657505084016020016115ee611567565b6001816020929493945483858b0101520191019190611630565b60ff191660208089019190915291151560051b870190910191506115ee9050611567565b91607f169161154a565b5060025f90815290917f405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace5b8183106116d157505090602061153292820101611526565b6020919350806001915483858a010152019101909185926116b9565b6020925061153294915060ff191682840152151560051b820101611526565b92607f1692611507565b5060015f90815290917fb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf65b8183106117595750509060206114ee928201016114e2565b6020919350806001915483858901015201910190918492611741565b602092506114ee94915060ff191682840152151560051b8201016114e2565b92607f16926114c3565b505f80805290917f290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e5635b8183106117df5750509060206114aa9282010161149e565b60209193508060019154838588010152019101909183926117c7565b602092506114aa94915060ff191682840152151560051b82010161149e565b92607f169261147f565b3461023d575f36600319011261023d57806103e860209252f35b6080810190811067ffffffffffffffff82111761185a57604052565b634e487b7160e01b5f52604160045260245ffd5b6060810190811067ffffffffffffffff82111761185a57604052565b610120810190811067ffffffffffffffff82111761185a57604052565b90601f8019910116810190811067ffffffffffffffff82111761185a57604052565b604051905f6004548060011c916001821691821561198d575b60208410831461057057838652859290811561196e575060011461190f575b61190d925003836118a7565b565b5060045f90815290917f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b5b81831061195257505090602061190d92820101611901565b602091935080600191548385890101520191019091849261193a565b6020925061190d94915060ff191682840152151560051b820101611901565b92607f16926118e2565b604051905f6005548060011c9160018216918215611a39575b60208410831461057057838652859290811561196e57506001146119da5761190d925003836118a7565b5060055f90815290917f036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db05b818310611a1d57505090602061190d92820101611901565b6020919350806001915483858901015201910190918492611a05565b92607f16926119b0565b90604051915f8154908160011c9260018316928315611aef575b602085108414610570578487528693908115611acd5750600114611a89575b5061190d925003836118a7565b90505f9291925260205f20905f915b818310611ab157505090602061190d928201015f611a7c565b6020919350806001915483858901015201910190918492611a98565b90506020925061190d94915060ff191682840152151560051b8201015f611a7c565b93607f1693611a5d565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b601c54811015611b3957601c5f5260205f209060021b01905f90565b634e487b7160e01b5f52603260045260245ffd5b60041115611b5757565b634e487b7160e01b5f52602160045260245ffd5b905f905b60048210611b7c57505050565b60208060019285511515815201930191019091611b6f565b600435906001600160a01b038216820361023d57565b601a54811015611b3957601a5f5260205f2001905f90565b8054821015611b39575f5260205f2001905f90565b604090600319011261023d576004359060243590565b90602080835192838152019201905f5b818110611c0a5750505090565b82516001600160a01b0316845260209384019390920191600101611bfd565b80516001600160a01b039081168352602080830151909116908301526040810151610100918291611c5981611b4d565b60408501526060810151611c6c81611b4d565b60608501526080810151608085015260a081015160a085015260c081015160c085015260e081015160e08501520151910152565b60808201915f815b60048210611cb7575050505090565b90919293602080611cd083876001950386528851611af9565b960192019201909291611ca8565b606090600319011261023d576004356001600160a01b038116810361023d57906024359060443590565b92919060408401906040855280518092526020606086019101915f5b818110611d3657505060209150930152565b909160206101206001926101008751858060a01b03815116835284810151611d5d81611b4d565b858401526040810151611d6f81611b4d565b60408401526060810151611d8281611b4d565b60608401526080810151611d9581611b4d565b608084015260a0810151611da881611b4d565b60a084015260c081015160c084015260e081015160e08401520151610100820152019401910192919092611d24565b9060c08101918051151582526020810151602083015f905b60048210611e5d57505050604001519160c060a0830152825180915260e0820191602060e08360051b8301019401925f915b838310611e3057505050505090565b9091929394602080611e4e60019360df198682030187528951611af9565b97019301930191939290611e21565b825181526020928301926001929092019101611def565b6040519060ff60075481811615158452818160081c1615156020850152818160101c161515604085015260181c161515606083015261190d6080836118a7565b67ffffffffffffffff811161185a5760051b60200190565b90611ed682611eb4565b611ee360405191826118a7565b8281528092611ef4601f1991611eb4565b0190602036910137565b60405190611f0b8261188a565b5f610100838281528260208201528260408201528260608201528260808201528260a08201528260c08201528260e08201520152565b60405190611f506020836118a7565b5f80835282815b828110611f6357505050565b602090611f6e611efe565b82828501015201611f57565b90611f8482611eb4565b611f9160405191826118a7565b8281528092611fa2601f1991611eb4565b01905f5b828110611fb257505050565b602090611fbd611efe565b82828501015201611fa6565b91908203918211610d7757565b91908201809211610d7757565b8051821015611b395760209160051b010190565b90601a54908183101561212e5760648111612126575b6120178383611fc9565b908082101561211e5750925b61202c84611ecc565b9361203681611f7a565b935f5b82811061204557505050565b8061205a61205560019385611fd6565b611baa565b838060a01b0391549060031b1c1680612073838b611fe3565b525f52600d60205260405f2060066040519161208e8361188a565b848060a01b03815416835260ff85820154868060a01b0381166020860152818160a01c166120bb81611b4d565b604086015260a81c166120cd81611b4d565b606084015260028101546080840152600381015460a0840152600481015460c0840152600581015460e0840152015461010082015261210c8289611fe3565b526121178188611fe3565b5001612039565b905092612023565b50606461200d565b509050604051916121406020846118a7565b5f83525f36813761214f611f41565b9190565b60405190608061216381846118a7565b825f5b82811061217257505050565b606082820152602001612166565b6040519061218d8261183e565b60085f835b6004821061219f57505050565b6001602081926121ae86611a43565b815201930191019091612192565b6001600160a01b03165f908152601b602052604090208054919391928385101561225d5760648111612255575b6121f38585611fc9565b908082101561224d5750905b61220882611ecc565b945f5b8381106122185750505050565b8061222e61222860019385611fd6565b85611bc2565b838060a01b0391549060031b1c16612246828a611fe3565b520161220b565b9050906121ff565b5060646121e9565b50509091506040516122706020826118a7565b5f81525f3681379190565b906040516122888161188a565b6101006003829460ff815460018060a01b0381168652818160a01c166122ad81611b4d565b6020870152818160a81c166122c181611b4d565b6040870152818160b01c166122d581611b4d565b6060870152818160b81c166122e981611b4d565b608087015260c01c166122fb81611b4d565b60a0850152600181015460c0850152600281015460e08501520154910152565b6001600160a01b03165f908152601d60205260409020805491939192838510156123d157606481116123c9575b6123528585611fc9565b90808210156123c15750905b61236782611f7a565b945f5b8381106123775750505050565b806123a561239f61239361238d60019587611fd6565b87611bc2565b90549060031b1c611b1d565b5061227b565b6123af828a611fe3565b526123ba8189611fe3565b500161236a565b90509061235e565b506064612348565b505090915061214f611f41565b604051906123eb8261186e565b60606040835f815281516124006080826118a7565b608036823760208201520152565b91601c549182841015612494576064811161248c575b61242e8484611fc9565b908082101561248557505b61244281611f7a565b935f5b82811061245157505050565b8061246961239f61246460019486611fd6565b611b1d565b6124738289611fe3565b5261247e8188611fe3565b5001612445565b9050612439565b506064612424565b5090915061214f611f41565b638b78c6d8195433036124af57565b6382b429005f526004601cfd5b60018060a01b031680638b78c6d819547f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e05f80a3638b78c6d8195556fea2646970667358221220c58ba55b419376d5601f1b556beecac2c94faf599b42fb3996f4a24c7714518864736f6c634300081c0033` // Add actual bytecode here
        const PROJECT_BYTECODE = `0x608080604052346015576138d3908161001a8239f35b5f80fdfe60806040526004361015610015575b36612e6457005b5f3560e01c806305eaab4b1461026f57806309ebc66f1461026a5780630a0e419e146102655780630d4e80ae14610260578063158ef93e1461025b57806315e2475f14610256578063256929621461022457806327108cb1146102515780632796a5301461024c57806327c9fce7146102475780632aeaf7f6146102425780632c86b7b21461023d57806337c909ec146102385780634a944a041461023357806351cff8d91461022e578063549d4ae41461022957806354d1f13d1461022457806360a31a881461021f57806362d03cb71461021a578063631864dd14610215578063715018a6146102105780637399a7191461020b57806383f9eb46146102065780638da5cb5b1461020157806394d74f45146101fc578063962b6c96146101f7578063a21ed26c146101f2578063c30dce51146101ed578063c45a0155146101e8578063c6135515146101e3578063ca86908a146101de578063ca8c7e9e146101d9578063cf14b9e4146101d4578063d6ec7db7146101cf578063e5392bf9146101ca578063f04e283e146101c5578063f2fde38b146101c05763fee81cf40361000e57611d74565b611d01565b611ce2565b611a42565b611a25565b6119a0565b6118df565b6118c2565b611821565b6117f9565b61179c565b61177f565b611651565b61131b565b6112ef565b6112d2565b611278565b611260565b611066565b611049565b611008565b610a3e565b610e2c565b610d4c565b610d2f565b610d12565b610cf5565b610cd8565b610c7c565b610b95565b610a4e565b610a21565b6109fc565b61097e565b6107e2565b610377565b34610373575f366003190112610373573068929eee149b4bd212685414610366573068929eee149b4bd2126855335f908152600f6020526040902080549081156103575760028101906102c28254611da4565b4210610348575f90554290556102e26102dd82601254611dc1565b601255565b5f80808084335af16102f2611dce565b50156103395760405190815233907f98741ecf35c5d20a8ed68dbd8540500684864a6c98c2a41a5844d0b3a2357d439080602081015b0390a23868929eee149b4bd2126855005b6312171d8360e31b5f5260045ffd5b637c17012360e01b5f5260045ffd5b6373380d9960e01b5f5260045ffd5b63ab143c065f526004601cfd5b5f80fd5b34610373575f3660031901126103735760206040516103e88152f35b90600182811c921680156103c1575b60208310146103ad57565b634e487b7160e01b5f52602260045260245ffd5b91607f16916103a2565b634e487b7160e01b5f52604160045260245ffd5b61012081019081106001600160401b038211176103fb57604052565b6103cb565b90601f801991011681019081106001600160401b038211176103fb57604052565b604051905f825f549161043383610393565b80835292600181169081156104b65750600114610459575b61045792500383610400565b565b505f80805290917f290decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e5635b81831061049a5750509060206104579282010161044b565b6020919350806001915483858901015201910190918492610482565b6020925061045794915060ff191682840152151560051b82010161044b565b604051905f82600154916104e883610393565b80835292600181169081156104b6575060011461050b5761045792500383610400565b5060015f90815290917fb10e2d527612073b26eecdfd717e6a320cf44b4afac2b0732d9fcbe2b7fa0cf65b81831061054e5750509060206104579282010161044b565b6020919350806001915483858901015201910190918492610536565b604051905f826002549161057d83610393565b80835292600181169081156104b657506001146105a05761045792500383610400565b5060025f90815290917f405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace5b8183106105e35750509060206104579282010161044b565b60209193508060019154838589010152019101909184926105cb565b604051905f826003549161061283610393565b80835292600181169081156104b657506001146106355761045792500383610400565b5060035f90815290917fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b5b8183106106785750509060206104579282010161044b565b6020919350806001915483858901015201910190918492610660565b604051905f82600454916106a783610393565b80835292600181169081156104b657506001146106ca5761045792500383610400565b5060045f90815290917f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b5b81831061070d5750509060206104579282010161044b565b60209193508060019154838589010152019101909184926106f5565b604051905f826005549161073c83610393565b80835292600181169081156104b6575060011461075f5761045792500383610400565b5060055f90815290917f036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db05b8183106107a25750509060206104579282010161044b565b602091935080600191548385890101520191019091849261078a565b805180835260209291819084018484015e5f828201840152601f01601f1916010190565b34610373575f366003190112610373576107fa610421565b60e06108046104d5565b61089761080f61056a565b61088961081a6105ff565b61087b610825610694565b9161086d610831610729565b9561085f60ff60065416996108516040519d8d8f9e8f90815201906107be565b8c810360208e0152906107be565b908a820360408c01526107be565b9088820360608a01526107be565b9086820360808801526107be565b9084820360a08601526107be565b9060c08301520390f35b634e487b7160e01b5f52603260045260245ffd5b601c548110156108d157601c5f5260205f209060021b01905f90565b6108a1565b80548210156108d1575f5260205f209060021b01905f90565b600411156108f957565b634e487b7160e01b5f52602160045260245ffd5b95926101009794919a9998959261012088019b60018060a01b03168852610933816108ef565b6020880152610941816108ef565b604087015261094f816108ef565b606086015261095d816108ef565b608085015261096b816108ef565b60a084015260c083015260e08201520152565b3461037357602036600319011261037357600435601c54811015610373576109a5906108b5565b5080546109f86001830154926003600282015491015490604051948460ff879660c01c169060ff8160b81c169060ff8160b01c169060ff8160a81c169060ff8160a01c169060018060a01b03168a61090d565b0390f35b34610373575f36600319011261037357602060ff600c5460a01c166040519015158152f35b34610373575f366003190112610373576020601754604051908152f35b5f36600319011215611dfd575f80fd5b34610373575f366003190112610373576020601254604051908152f35b6004111561037357565b6040519061045761012083610400565b60405190610457606083610400565b80604312156103735760405190610aac608083610400565b819060a411610373576024905b60a48210610ac657505090565b8135815260209182019101610ab9565b9080601f830112156103735760405191610af1608084610400565b82906080810192831161037357905b828210610b0d5750505090565b8135815260209182019101610b00565b6001600160401b0381116103fb5760051b60200190565b6001600160401b0381116103fb57601f01601f191660200190565b81601f8201121561037357803590610b6682610b34565b92610b746040519485610400565b8284526020838301011161037357815f926020809301838601378301015290565b346103735760c036600319011261037357600435610bb281610a6b565b610bbb36610a94565b60a435906001600160401b038211610373573660238301121561037357816004013592610be784610b1d565b92610bf56040519485610400565b8484526024602085019560051b820101903682116103735760248101955b828710610c2757610c25868686611e42565b005b86356001600160401b03811161037357602091610c4b839260243691870101610b4f565b815201960195610c13565b6001600160a01b0381160361037357565b80548210156108d1575f5260205f2001905f90565b3461037357604036600319011261037357600435610c9981610c56565b6001600160a01b03165f908152601d602052604090208054602435919082101561037357602091610cc991610c67565b90549060031b1c604051908152f35b34610373575f366003190112610373576020601954604051908152f35b34610373575f366003190112610373576020601154604051908152f35b34610373575f36600319011261037357602060405162093a808152f35b34610373575f366003190112610373576020601354604051908152f35b3461037357602036600319011261037357600435610d6981610c56565b610d71612f10565b3068929eee149b4bd212685414610366573068929eee149b4bd21268556001600160a01b038116908115610df55747906012548203918211610df05781610ddb7f7084f5476618d8e60b11ef0d7d3f06914655adb8793e28ff7f018d4c76d505d593602093612f2c565b604051908152a23868929eee149b4bd2126855005b611d90565b63d92e233d60e01b5f5260045ffd5b604090600319011261037357600435610e1c81610a6b565b90602435610e2981610a6b565b90565b610e3536610e04565b60ff600c5460a01c1615610fe257610e4c826108ef565b60ff600654168211610fd357610e61816108ef565b600381118015610fb0575b610fa1573068929eee149b4bd212685414610366573068929eee149b4bd2126855335f908152600d60205260409020610ea433612f4f565b610ead33612f7f565b600181018054929060a084901c60ff1692610ec7846108ef565b610ed0866108ef565b83861015610f9257610f8161032892610f3385610f237f67a8bb85cc575ca4a91129fa6a1b3a52fc9676be1bb2a0c790fa461e9704fec299610f1a610f15848e61303d565b6130ed565b60a81c60ff1690565b92610f2e8b826126c2565b6126e6565b4260028401556006610f4d610f478761313b565b42611db4565b936003810194855534600482015501610f67348254611db4565b9055610f7334336131db565b8254908534918a8933613556565b54604051938493339734928661270a565b630a26d2db60e11b5f5260045ffd5b6302e8f35960e31b5f5260045ffd5b5060048110156108d15760ff8160051c6007015460f88360031b161c1615610e6c565b63e142361760e01b5f5260045ffd5b6321c4e35760e21b5f5260045ffd5b610ffa816108ef565b5f52600e60205260405f2090565b346103735760203660031901126103735760043561102581610a6b565b61102e816108ef565b5f52600e602052602060ff60405f2054166040519015158152f35b34610373575f366003190112610373576020601854604051908152f35b61106f36610e04565b60ff600c5460a01c1615610fe257611086826108ef565b60ff600654168211610fd35761109b816108ef565b60038111801561123d575b610fa1573068929eee149b4bd212685414610366573068929eee149b4bd2126855335f908152600d60205260409020906110df336136eb565b600182018054909260a082901c60ff16926110f9866108ef565b611102846108ef565b85841461122e57611112846108ef565b61111b866108ef565b838610610fd3577f878f9a9d812d80cfb8bfdf46f3b54022bf1352a580946ad4dddc2053a7f6d597946006836004896111e6600361120e9801986111df886111726111688d544290611dc1565b9360a81c60ff1690565b98610f2e61117f8b61313b565b966111898461313b565b956111c58b6111bf61119b888661303d565b9c8d92019b6111b48d54956111b98d6111b48388611f4e565b612748565b96611f4e565b92611db4565b808211611223576111d991610f1591611dc1565b826126c2565b8954611db4565b885555016111f5348254611db4565b905561120134336131db565b8354913491888733613601565b54906103286040519283923396349185612766565b50506111d95f6130ed565b631c27251160e11b5f5260045ffd5b5060048110156108d15760ff8160051c6007015460f88360031b161c16156110a6565b5f36600319011261037357611273612f10565b611dfd565b3461037357602036600319011261037357600435601a5481101561037357601a5f527f057c384a7d1c54f3a1b2e5e67b2617b8224fdfd1ea7234eea573a6ff665ff63e01546040516001600160a01b039091168152602090f35b34610373575f366003190112610373576020601054604051908152f35b34610373575f36600319011261037357638b78c6d819546040516001600160a01b039091168152602090f35b61132436610e04565b9060ff600c5460a01c1615610fe25761133c816108ef565b60ff600654168111610fd357611351826108ef565b60038211801561143a575b610fa1573068929eee149b4bd212685414610366577feb3c6be4dd634a39db190ec19cf2b6c9713dc5d6b495a2e6d2306b7b93bda681903068929eee149b4bd2126855335f52600d60205260405f206113b433612f4f565b6113bd33612f7f565b61120e6001820180546113f3876113db6111688460ff9060a01c1690565b936113e9610f15838a61303d565b610f2e88826126c2565b4260028501556006611407610f478961313b565b946003810195865534600482015501611421348254611db4565b905561142d34336131db565b8684549286349333613642565b5060048210156108d15760ff8260051c6007015460f88460031b161c161561135c565b359060ff8216820361037357565b81601f820112156103735760405191611485608084610400565b82916080810191821161037357915b8183106114a15750505090565b8235801515810361037357815260209283019201611494565b9080601f8301121561037357604051916114d5608084610400565b6080810190838383116103735781905b8382106114f457505050505090565b81356001600160401b038111610373576020916115148784938701610b4f565b8152019101906114e5565b9190916101808184031261037357611535610a75565b9281356001600160401b0381116103735781611552918401610b4f565b845260208201356001600160401b0381116103735781611573918401610b4f565b602085015260408201356001600160401b0381116103735781611597918401610b4f565b604085015260608201356001600160401b03811161037357816115bb918401610b4f565b606085015260808201356001600160401b03811161037357816115df918401610b4f565b608085015260a08201356001600160401b0381116103735781611603918401610b4f565b60a085015261161460c0830161145d565b60c08501526116268160e0840161146b565b60e08501526101608201356001600160401b0381116103735761164992016114ba565b610100830152565b34610373576020366003190112610373576004356001600160401b0381116103735761168190369060040161151f565b611689612f10565b60ff600c5460a01c1615610fe257610100816116bf61174c9351602081519101206116b2612794565b60208151910120146127c0565b6116e36020820151602081519101206116d66127ad565b6020815191012014612805565b6116f06040820151612021565b6116fd6060820151612104565b61170a60808201516121db565b61171760a08201516122b2565b61173861172860c083015160ff1690565b60ff1660ff196006541617600655565b61174560e0820151612851565b01516128cf565b7fe8d968cda3dc6327b5b331bdf9cf3e2e6de836f13f62c41983927d9737bcf6896040518061177a81612aa5565b0390a1005b34610373575f366003190112610373576020601654604051908152f35b34610373576020366003190112610373576004356117b981610c56565b60018060a01b03165f52600f602052608060405f208054906001810154906003600282015491015491604051938452602084015260408301526060820152f35b34610373575f36600319011261037357600c546040516001600160a01b039091168152602090f35b3461037357610260366003190112610373576004356001600160401b0381116103735761185290369060040161151f565b6024359061185f82610c56565b60443561186b81610c56565b36608312156103735760809260405192611886608085610400565b833661026411610373576064905b61026482106118a9575050610c259450612bf1565b602087916118b73685610ad6565b815201910190611894565b34610373575f366003190112610373576020601554604051908152f35b34610373576040366003190112610373576004356118fc81610c56565b6001600160a01b03165f908152601b602052604090208054602435908110156103735761192891610c67565b905460405160039290921b1c6001600160a01b03168152602090f35b6001600160a01b039182168152911660208201526101208101989796610100969195909491939092611975816108ef565b6040870152611983816108ef565b6060860152608085015260a084015260c083015260e08201520152565b34610373576020366003190112610373576004356119bd81610c56565b60018060a01b03165f52600d60205260405f2060018060a01b03815416906109f860018201549160028101549060038101546004820154906006600584015493015493604051978760ff8a9960a81c169160ff8260a01c169160018060a01b0316908a611944565b34610373575f366003190112610373576020601454604051908152f35b606036600319011261037357600435611a5a81610a6b565b60243590611a6782610a6b565b60443590611a7482610c56565b60ff600c5460a01c1615610fe257611a8b816108ef565b60ff600654168111610fd357611aa0836108ef565b600383118015611cbf575b610fa1573068929eee149b4bd212685414610366573068929eee149b4bd2126855335f908152600d60205260409020546001600160a01b031615908115611cb0577ffcf95381264fce3d0acbb5d4a40f00c77c48d9cf3e842ad7fe58ef9f7f28278a925f906001600160a01b0381168015159081611ca5575b50611c7b575b50611b38610f15868461303d565b611b44610f478661313b565b92611bba611b50610a75565b3381526001600160a01b0384166020820152611b6f8560408301612cd5565b611b7c8860608301612cd5565b4260808201528560a08201523460c08201525f60e082015234610100820152611bb53360018060a01b03165f52600d60205260405f2090565b612ce1565b611c5a575b6001600160a01b038116611bf9575b50611bd934336131db565b611be68234868433613683565b6103286040519283923396349185612766565b6001600160a01b0381165f908152600f60205260409020611c3c91906003015415611c42575b6001600160a01b03165f908152601b602052604090203390612df5565b5f611bce565b611c55611c50601854612e36565b601855565b611c1f565b611c6333612d90565b611c76611c71601754612e36565b601755565b611bbf565b6001600160a01b0381165f908152600d6020526040902060030154421015611b2a5790505f611b2a565b90503314155f611b24565b632fec509960e11b5f5260045ffd5b5060048310156108d15760ff8360051c6007015460f88560031b161c1615611aab565b602036600319011261037357611cf9600435610c56565b611273612f10565b602036600319011261037357600435611d1981610c56565b611d21612f10565b8060601b15611d675760018060a01b031680638b78c6d819547f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e05f80a3638b78c6d81955005b637448fbae5f526004601cfd5b3461037357602036600319011261037357611273600435610c56565b634e487b7160e01b5f52601160045260245ffd5b9062093a808201809211610df057565b91908201809211610df057565b91908203918211610df057565b3d15611df8573d90611ddf82610b34565b91611ded6040519384610400565b82523d5f602084013e565b606090565b60405162461bcd60e51b815260206004820152601960248201527f546869732066756e6374696f6e2069732064697361626c6564000000000000006044820152606490fd5b929192611e4d612f10565b60ff600c5460a01c1615610fe257611e64816108ef565b60ff600654168111610fd357611e79816108ef565b805f52600e60205260405f2093825f5b60048110611f0d5750507fe60a3d5cf86d70b167bf9dabe0c57cc7588ce5bb77f1ad3ccccc2842ee1b823693945080611ed0611f08926005611eca86610ff1565b01612448565b611ee9611edc84610ff1565b805460ff19166001179055565b611ef2836108ef565b611efb83612578565b5060405194859485612619565b0390a1565b6001906020835193019282828a01015501611e89565b634e487b7160e01b5f525f60045260245ffd5b906103e88202918083046103e81490151715610df057565b81810292918115918404141715610df057565b818110611f6c575050565b5f8155600101611f61565b818110611f82575050565b80611f8f60019254610393565b80611f9c575b5001611f77565b601f81118314611fb157505f81555b5f611f95565b611fcd90825f5283601f60205f20920160051c82019101611f61565b5f8181526020812081835555611fab565b9190601f8111611fed57505050565b610457925f5260205f20906020601f840160051c83019310612017575b601f0160051c0190611f61565b909150819061200a565b9081516001600160401b0381116103fb5761204881612041600254610393565b6002611fde565b602092601f821160011461208857612078929382915f9261207d575b50508160011b915f199060031b1c19161790565b600255565b015190505f80612064565b60025f52601f198216937f405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace915f5b8681106120ec57508360019596106120d4575b505050811b01600255565b01515f1960f88460031b161c191690555f80806120c9565b919260206001819286850151815501940192016120b6565b9081516001600160401b0381116103fb5761212b81612124600354610393565b6003611fde565b602092601f821160011461215f5761215a929382915f9261207d5750508160011b915f199060031b1c19161790565b600355565b60035f52601f198216937fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b915f5b8681106121c357508360019596106121ab575b505050811b01600355565b01515f1960f88460031b161c191690555f80806121a0565b9192602060018192868501518155019401920161218d565b9081516001600160401b0381116103fb57612202816121fb600454610393565b6004611fde565b602092601f821160011461223657612231929382915f9261207d5750508160011b915f199060031b1c19161790565b600455565b60045f52601f198216937f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b915f5b86811061229a5750836001959610612282575b505050811b01600455565b01515f1960f88460031b161c191690555f8080612277565b91926020600181928685015181550194019201612264565b9081516001600160401b0381116103fb576122d9816122d2600554610393565b6005611fde565b602092601f821160011461230d57612308929382915f9261207d5750508160011b915f199060031b1c19161790565b600555565b60055f52601f198216937f036b6384b5eca791c62761152d0c79bb0604c104a5fb6f4eb0703f3154bb3db0915f5b8681106123715750836001959610612359575b505050811b01600555565b01515f1960f88460031b161c191690555f808061234e565b9192602060018192868501518155019401920161233b565b91909182516001600160401b0381116103fb576123b0816123aa8454610393565b84611fde565b6020601f82116001146123e35781906123df9394955f9261207d5750508160011b915f199060031b1c19161790565b9055565b601f198216906123f6845f5260205f2090565b915f5b81811061243057509583600195969710612418575b505050811b019055565b01515f1960f88460031b161c191690555f808061240e565b9192602060018192868b0151815501940192016123f9565b90805190600160401b82116103fb57602090835483855580841061255d575b5001915f5260205f20915f905b8282106124815750505050565b80518051906001600160401b0382116103fb576124a8826124a28854610393565b88611fde565b602090601f83116001146124ed57926124de836001959460209487965f9261207d5750508160011b915f199060031b1c19161790565b87555b01940191019092612474565b90601f19831691612501885f5260205f2090565b925f5b818110612545575093602093600196938796938388951061252d575b505050811b0187556124e1565b01515f1960f88460031b161c191690555f8080612520565b92936020600181928786015181550195019301612504565b61257290855f5284845f209182019101611f77565b5f612467565b60048110156108d157600801905f90565b60048210156108d15701905f90565b5f92918154916125a783610393565b80835292600181169081156125fc57506001146125c357505050565b5f9081526020812093945091925b8383106125e2575060209250010190565b6001816020929493945483858701015201910191906125d1565b915050602093945060ff929192191683830152151560051b010190565b929190612625816108ef565b83525f602084015b600482106126ac5750505061264d9060e060a084015260e0830190612598565b9060c0818303910152815180825260208201916020808360051b8301019401925f915b83831061267f57505050505090565b909192939460208061269d600193601f1986820301875289516107be565b97019301930191939290612670565b602080600192855181520193019101909161262d565b906126cc816108ef565b815460ff60a01b191660a09190911b60ff60a01b16179055565b906126f0816108ef565b815460ff60a81b191660a89190911b60ff60a81b16179055565b60a0810196959460809491939092612721816108ef565b845261272c816108ef565b602084015261273a816108ef565b604083015260608201520152565b8115612752570490565b634e487b7160e01b5f52601260045260245ffd5b90949392606092608083019661277b816108ef565b8352612786816108ef565b602083015260408201520152565b60405190610457826127a6815f612598565b0383610400565b60405190610457826127a6816001612598565b156127c757565b60405162461bcd60e51b815260206004820152601660248201527513985b594818d85b9b9bdd0818994818da185b99d95960521b6044820152606490fd5b1561280c57565b60405162461bcd60e51b815260206004820152601860248201527f53796d626f6c2063616e6e6f74206265206368616e67656400000000000000006044820152606490fd5b5f905f5b60048110612864575050600755565b909160206128886001928486511515919060ff809160031b9316831b921b19161790565b93019101612855565b5f915f5b600481106128a257505055565b909260206128c66001928487511515919060ff809160031b9316831b921b19161790565b94019101612895565b6008905f905b600482106128e257505050565b80518051906001600160401b0382116103fb57612909826129038754610393565b87611fde565b602090601f831160011461294e579261293f836001959460209487965f9261207d5750508160011b915f199060031b1c19161790565b86555b019301910190916128d5565b90601f19831691612962875f5260205f2090565b925f5b8181106129a6575093602093600196938796938388951061298e575b505050811b018655612942565b01515f1960f88460031b161c191690555f8080612981565b92936020600181928786015181550195019301612965565b905f905b600482106129cf57505050565b80518051906001600160401b0382116103fb576129f0826129038754610393565b602090601f8311600114612a355792612a26836001959460209487965f9261207d5750508160011b915f199060031b1c19161790565b86555b019301910190916129c2565b90601f19831691612a49875f5260205f2090565b925f5b818110612a8d5750936020936001969387969383889510612a75575b505050811b018655612a29565b01515f1960f88460031b161c191690555f8080612a68565b92936020600181928786015181550195019301612a4c565b610e299060408152612aba604082015f612598565b9060208183039101526001612598565b61010061045791612adc81515f612389565b612aeb60208201516001612389565b612afa60408201516002612389565b612b0960608201516003612389565b612b1860808201516004612389565b612b2760a08201516005612389565b60ff8060c0830151161660ff196006541617600655612b4b60e08201516007612891565b015160086129be565b60ff1660ff8114610df05760010190565b9060048110156108d15760051b0190565b60405190612b85602083610400565b5f80835282815b828110612b9857505050565b806060602080938501015201612b8c565b908051151560ff8019845416911617825560208101515f5b60048110612bdb5750506040015161045791600501612448565b6001906020835193019282828701015501612bc1565b91909160ff600c5460a01c16612cc657600c805460ff60a01b1916600160a01b179055612c4c92612c4791612c2590612aca565b60018060a01b03166bffffffffffffffffffffffff60a01b600c541617600c55565b61370e565b5f5b612c63612c5d60065460ff1690565b60ff1690565b9060ff8116918211612cc157612cb782612c7f612cbc946108ef565b612cb2612c8c8287612b65565b5191612c96612b76565b612c9e610a85565b600181529360208501526040840152610ff1565b612ba9565b612b54565b612c4e565b505050565b6309398a1960e41b5f5260045ffd5b612cde826108ef565b52565b815190916006916101009190612d17906001600160a01b03165b85546001600160a01b0319166001600160a01b03909116178555565b60208101516001850180546001600160a01b0319166001600160a01b03909216919091178155612d6190612d5260408401516111d9816108ef565b606083015190610f2e826108ef565b6080810151600285015560a0810151600385015560c0810151600485015560e081015160058501550151910155565b601a54600160401b8110156103fb5760018101601a55601a548110156108d157601a5f527f057c384a7d1c54f3a1b2e5e67b2617b8224fdfd1ea7234eea573a6ff665ff63e0180546001600160a01b0319166001600160a01b03909216919091179055565b8054600160401b8110156103fb57612e1291600182018155610c67565b81546001600160a01b0393841660039290921b91821b9390911b1916919091179055565b5f198114610df05760010190565b908160209103126103735751610e2981610c56565b6040513d5f823e3d90fd5b600c54600490602090612e8d90612e81906001600160a01b031681565b6001600160a01b031690565b604051632c7b2a2d60e21b815292839182905afa908115612f0b575f91612edc575b506001600160a01b03811615610373575f8091368280378136915af43d5f803e15612ed8573d5ff35b3d5ffd5b612efe915060203d602011612f04575b612ef68183610400565b810190612e44565b5f612eaf565b503d612eec565b612e59565b638b78c6d819543303612f1f57565b6382b429005f526004601cfd5b5f918291829182916001600160a01b03165af1612f47611dce565b501561033957565b6001600160a01b039081165f908152600d60205260409020541615612f7057565b635eb2472560e01b5f5260045ffd5b6001600160a01b03165f908152600d60205260409020600301544210612fa157565b63e72f2f7560e01b5f5260045ffd5b15612fb757565b60405162461bcd60e51b815260206004820152601260248201527114195c9a5bd9081b9bdd08195b98589b195960721b6044820152606490fd5b15612ff857565b60405162461bcd60e51b815260206004820152601d60248201527f5072696365206e6f742073657420666f72207468697320706572696f640000006044820152606490fd5b613046816108ef565b5f52600e60205260405f2061305a826108ef565b60ff815416156130b55760048210156108d1578160016130a09261309a6130956130aa9660051c600701601f8616905460ff9160031b1c1690565b612fb0565b01612589565b90549060031b1c90565b610e29811515612ff1565b60405162461bcd60e51b815260206004820152601060248201526f151a595c881b9bdd08195b98589b195960821b6044820152606490fd5b8034036130f75750565b80341061312c57600c810290808204600c1490151715610df057600a9004341161311d57565b63c57d98bb60e01b5f5260045ffd5b63cd1c886760e01b5f5260045ffd5b613144816108ef565b801561318357613153816108ef565b6001811461317b57600290613167816108ef565b14613174576301e1338090565b62278d0090565b5062093a8090565b506201518090565b90816020910312610373575190565b156131a157565b60405162461bcd60e51b8152602060048201526012602482015271496e73756666696369656e742066756e647360701b6044820152606490fd5b9061320960016131fb8460018060a01b03165f52600d60205260405f2090565b01546001600160a01b031690565b600c5461322090612e81906001600160a01b031681565b604051630cbab4f760e01b8152600481018490529290602090849060249082905afa928315612f0b575f936133af575b505f928390816001600160a01b038516613354575b6132cd6132c56132d2926132848761327d8b88611db4565b111561319a565b61329861329388601354611db4565b601355565b856132ad6132a887601554611db4565b601555565b613327575b6132c0896132c0878a611dc1565b611dc1565b601454611db4565b601455565b8061330b575b506132e4575b50505050565b836132ee92613747565b806132fb575b80806132de565b61330491612f2c565b5f806132f4565b600c5461332191906001600160a01b0316612f2c565b5f6132d8565b61333b6133368a601654611db4565b601655565b61334f61334a88601954611db4565b601955565b6132b2565b6001600160a01b0385165f908152600d60205260409020600301544210925082156132655750935061339061338883611f36565b612710900490565b936132d26132cd6132c56133a661338887611f36565b92505050613265565b6133d291935060203d6020116133d9575b6133ca8183610400565b81019061318b565b915f613250565b503d6133c0565b906133ea816108ef565b815460ff60b01b191660b09190911b60ff60b01b16179055565b9061340e816108ef565b815460ff60b81b191660b89190911b60ff60b81b16179055565b90613432816108ef565b815460ff60c01b191660c09190911b60ff60c01b16179055565b601c54600160401b8110156103fb5780600161346d9201601c55601c6108d6565b91909161351d5780516003916101009161348f906001600160a01b0316612cfb565b6134a660208201516134a0816108ef565b856126c2565b6134bd60408201516134b7816108ef565b856126e6565b6134d460608201516134ce816108ef565b856133e0565b6134eb60808201516134e5816108ef565b85613404565b61350260a08201516134fc816108ef565b85613428565b60c0810151600185015560e081015160028501550151910155565b611f23565b8054600160401b8110156103fb5761353f91600182018155610c67565b819291549060031b91821b915f19901b1916179055565b92936135fc94610457979396929660405197613571896103df565b6001600160a01b038716895261358760026108ef565b600260208a0152613597816108ef565b60408901526135a5816108ef565b60608801526135b3816108ef565b60808701526135c1816108ef565b60a086015260c08501524260e08501526101008401526135e3601c549361344c565b6001600160a01b03165f908152601d6020526040902090565b613522565b92936135fc9461045797939692966040519761361c896103df565b6001600160a01b038716895261363260016108ef565b600160208a0152613597816108ef565b92936135fc9461045797939692966040519761365d896103df565b6001600160a01b038716895261367360036108ef565b600360208a0152613597816108ef565b909293610457946135fc936040519561369b876103df565b6001600160a01b03851687526136b05f6108ef565b5f60208801526136bf5f6108ef565b5f60408801526136ce816108ef565b60608701526136dc5f6108ef565b5f60808701526135c1816108ef565b6001600160a01b03165f908152600d6020526040902060030154421015612f7057565b6001600160a01b0316638b78c6d8198190555f7f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e08180a3565b909161384d6137796133887f927edc6a2ba12aea3853fd74ed72954a32b4a8d009004decf87af75d3ce2005193611f36565b6001600160a01b0384165f908152600f6020526040902090949061379e868254611db4565b8155600181016137af878254611db4565b90556137c06102dd87601254611db4565b6001600160a01b038281165f908152600d6020526040902060010154958116951685148061387a575b613852575b506001600160a01b0381165f908152600d60205260409020600501613814868254611db4565b905561382a61382586601154611db4565b601155565b6040805186815260208101969096526001600160a01b0390911694918291820190565b0390a3565b60030161385f8154612e36565b905561387461386f601054612e36565b601055565b5f6137ee565b506001600160a01b0382165f908152600d602052604090206002015442146137e956fea26469706673582212205df700d0b5318d453206c129defc80c6a54bbccfc5d99c1dd79c143be9bdf70764736f6c634300081c0033` // Add actual bytecode here

        // Platform Functions
        window.deployFactory = async function deployFactory() {
            if (!web3 || accounts.length === 0) {
                showToast(currentLang === 'zh' ? '请先连接钱包' : 'Please connect wallet first', 'error');
                return;
            }

            try {
                // Get constructor parameters
                const ownerAddress = document.getElementById('factoryOwnerAddress').value || accounts[0];
                const projectImplAddress = document.getElementById('projectImplAddressInput').value;

                if (!projectImplAddress) {
                    showToast(currentLang === 'zh' ? '请输入项目实现合约地址' : 'Please enter project implementation address', 'error');
                    return;
                }

                // Validate addresses
                if (!web3.utils.isAddress(ownerAddress)) {
                    showToast(currentLang === 'zh' ? '无效的所有者地址' : 'Invalid owner address', 'error');
                    return;
                }
                if (!web3.utils.isAddress(projectImplAddress)) {
                    showToast(currentLang === 'zh' ? '无效的项目实现合约地址' : 'Invalid project implementation address', 'error');
                    return;
                }

                const factory = new web3.eth.Contract(FACTORY_ABI);
                const deploy = factory.deploy({
                    data: FACTORY_BYTECODE,
                    arguments: [ownerAddress, projectImplAddress]
                });

                console.log(1, [ownerAddress, projectImplAddress])
                const gas = await deploy.estimateGas({ from: accounts[0] });
                console.log(2)
                const result = await deploy.send({ from: accounts[0], gas });
                console.log(3)
                document.getElementById('factoryAddress').value = result.options.address;
                showToast(currentLang === 'zh' ? 'Factory 合约部署成功' : 'Factory contract deployed successfully', 'success');

                // Initialize factory contract instance
                factoryContract = new web3.eth.Contract(FACTORY_ABI, result.options.address);

            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '部署失败' : 'Deployment failed', 'error');
            }
        }

        window.deployProjectImplementation = async function deployProjectImplementation() {
            if (!web3 || accounts.length === 0) {
                showToast(currentLang === 'zh' ? '请先连接钱包' : 'Please connect wallet first', 'error');
                return;
            }

            try {
                const project = new web3.eth.Contract(PROJECT_ABI);
                const deploy = project.deploy({ data: PROJECT_BYTECODE });

                const gas = await deploy.estimateGas({ from: accounts[0] });
                const result = await deploy.send({ from: accounts[0], gas });

                document.getElementById('projectImplAddress').value = result.options.address;
                showToast(currentLang === 'zh' ? 'Project 实现合约部署成功' : 'Project implementation deployed successfully', 'success');

            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '部署失败' : 'Deployment failed', 'error');
            }
        }


        window.setProjectImplementation = async function setProjectImplementation() {
            const factoryAddress = document.getElementById('factoryAddress').value;
            const projectImplAddress = document.getElementById('projectImplAddress').value;

            if (!factoryAddress || !projectImplAddress) {
                showToast(currentLang === 'zh' ? '请先部署合约' : 'Please deploy contracts first', 'error');
                return;
            }

            try {
                if (!factoryContract) {
                    factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);
                }

                await factoryContract.methods.setProjectImplementation(projectImplAddress).send({ from: accounts[0] });
                showToast(currentLang === 'zh' ? 'Project 实现地址设置成功' : 'Project implementation set successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '设置失败' : 'Setting failed', 'error');
            }
        }

        window.updateCreationFee = async function updateCreationFee() {
            if (!factoryContract) {
                showToast(currentLang === 'zh' ? '请先部署或连接 Factory 合约' : 'Please deploy or connect to Factory contract first', 'error');
                return;
            }

            const fee = document.getElementById('creationFee').value;
            if (!fee) {
                showToast(currentLang === 'zh' ? '请输入费用' : 'Please enter fee', 'error');
                return;
            }

            try {
                const weiAmount = web3.utils.toWei(fee, 'ether');
                await factoryContract.methods.setProjectCreationFee(weiAmount).send({ from: accounts[0] });
                showToast(currentLang === 'zh' ? '创建费用更新成功' : 'Creation fee updated successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '更新失败' : 'Update failed', 'error');
            }
        }

        window.updatePlatformFee = async function updatePlatformFee() {
            if (!factoryContract) {
                showToast(currentLang === 'zh' ? '请先部署或连接 Factory 合约' : 'Please deploy or connect to Factory contract first', 'error');
                return;
            }

            const fee = document.getElementById('platformFee').value;
            if (!fee) {
                showToast(currentLang === 'zh' ? '请输入费率' : 'Please enter fee rate', 'error');
                return;
            }

            try {
                const basisPoints = parseFloat(fee) * 100; // Convert percentage to basis points
                await factoryContract.methods.setPlatformFeeBasisPoints(basisPoints).send({ from: accounts[0] });
                showToast(currentLang === 'zh' ? '平台费率更新成功' : 'Platform fee updated successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '更新失败' : 'Update failed', 'error');
            }
        }

        window.withdrawPlatformFees = async function withdrawPlatformFees() {
            if (!factoryContract) {
                showToast(currentLang === 'zh' ? '请先部署或连接 Factory 合约' : 'Please deploy or connect to Factory contract first', 'error');
                return;
            }

            const recipient = document.getElementById('withdrawAddress').value;
            if (!recipient) {
                showToast(currentLang === 'zh' ? '请输入接收地址' : 'Please enter recipient address', 'error');
                return;
            }

            try {
                await factoryContract.methods.withdrawFees(recipient).send({ from: accounts[0] });
                showToast(currentLang === 'zh' ? '提取成功' : 'Withdrawal successful', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '提取失败' : 'Withdrawal failed', 'error');
            }
        }

        window.loadPlatformStats = async function loadPlatformStats() {
            if (!factoryContract) {
                const factoryAddress = document.getElementById('factoryAddress').value;
                if (!factoryAddress) {
                    showToast(currentLang === 'zh' ? '请先部署或输入 Factory 合约地址' : 'Please deploy or enter Factory contract address', 'error');
                    return;
                }
                factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);
            }

            try {
                // Get revenue stats using zero address to avoid circuit breaker
                const revenueStats = await factoryContract.methods.getRevenueStats().call({ from: '0x0000000000000000000000000000000000000000' });
                const currency = getNetworkCurrency();
                document.getElementById('totalCreationFees').textContent = web3.utils.fromWei(revenueStats.creationFees, 'ether') + ' ' + currency;
                document.getElementById('platformRevenue').textContent = web3.utils.fromWei(revenueStats.platformFees, 'ether') + ' ' + currency;

                // Get total projects
                const totalProjects = await factoryContract.methods.getTotalProjects().call({ from: '0x0000000000000000000000000000000000000000' });
                document.getElementById('totalProjects').textContent = totalProjects;

                showToast(currentLang === 'zh' ? '统计数据加载成功' : 'Stats loaded successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '加载失败' : 'Loading failed', 'error');
            }
        }

        window.loadAllProjects = async function loadAllProjects() {
            if (!factoryContract) {
                const factoryAddress = document.getElementById('factoryAddress').value;
                if (!factoryAddress) {
                    showToast(currentLang === 'zh' ? '请先部署或输入 Factory 合约地址' : 'Please deploy or enter Factory contract address', 'error');
                    return;
                }
                factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);
            }

            try {
                const result = await factoryContract.methods.getProjectsPaginated(0, 100).call({ from: '0x0000000000000000000000000000000000000000' });
                const projects = result[0];

                const tbody = document.querySelector('#allProjectsTable tbody');
                tbody.innerHTML = '';

                if (projects.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">
                                <div class="empty-state-icon">📭</div>
                                <div>${currentLang === 'zh' ? '暂无项目' : 'No projects yet'}</div>
                            </td>
                        </tr>
                    `;
                } else {
                    for (const projectAddr of projects) {
                        const owner = await factoryContract.methods.projectToOwner(projectAddr).call({ from: '0x0000000000000000000000000000000000000000' });
                        const project = new web3.eth.Contract(PROJECT_ABI, projectAddr);
                        let projectName = 'Unknown';
                        try {
                            const brandConfig = await project.methods.getBrandConfig().call({ from: '0x0000000000000000000000000000000000000000' });
                            projectName = brandConfig.name;
                        } catch (e) {
                            console.error('Error getting project name:', e);
                        }

                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${projectAddr.substring(0, 6)}...${projectAddr.substring(38)}</td>
                            <td>${owner.substring(0, 6)}...${owner.substring(38)}</td>
                            <td>${projectName}</td>
                            <td>
                                <button class="btn-secondary" onclick="copyAddress('${projectAddr}')">
                                    ${currentLang === 'zh' ? '复制' : 'Copy'}
                                </button>
                            </td>
                        `;
                    }
                }

                showToast(currentLang === 'zh' ? '项目列表加载成功' : 'Projects loaded successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '加载失败' : 'Loading failed', 'error');
            }
        }

        window.searchProjectsByOwner = async function searchProjectsByOwner() {
            const ownerAddress = prompt(currentLang === 'zh' ? '输入所有者地址:' : 'Enter owner address:');
            if (!ownerAddress) return;

            if (!factoryContract) {
                const factoryAddress = document.getElementById('factoryAddress').value;
                if (!factoryAddress) {
                    showToast(currentLang === 'zh' ? '请先部署或输入 Factory 合约地址' : 'Please deploy or enter Factory contract address', 'error');
                    return;
                }
                factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);
            }

            try {
                const projectCount = await factoryContract.methods.getOwnerProjectCount(ownerAddress).call({ from: '0x0000000000000000000000000000000000000000' });
                const result = await factoryContract.methods.getOwnerProjectsPaginated(ownerAddress, 0, 100).call({ from: '0x0000000000000000000000000000000000000000' });
                const projects = result[0];

                // Create beautiful modal for owner projects
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;

                let projectListHTML = '';
                projects.forEach((proj, idx) => {
                    projectListHTML += `
                        <div style="display: flex; align-items: center; padding: 8px; background: ${idx % 2 === 0 ? '#f9fafb' : 'white'}; border-radius: 4px;">
                            <span style="color: #666; margin-right: 10px;">${idx + 1}.</span>
                            <span style="font-family: monospace; font-size: 12px; color: #0ea5e9; cursor: pointer;"
                                  onclick="copyToClipboard('${proj}')">
                                ${proj}
                            </span>
                        </div>
                    `;
                });

                modal.innerHTML = `
                    <div style="background: white; border-radius: 12px; padding: 25px; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="color: #0f172a; margin: 0;">
                                ${currentLang === 'zh' ? '项目所有者查询结果' : 'Project Owner Query Result'}
                            </h2>
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()"
                                    style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">
                                ×
                            </button>
                        </div>

                        <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <div style="margin-bottom: 10px;">
                                <span style="color: #666; font-size: 12px;">${currentLang === 'zh' ? '所有者地址' : 'Owner Address'}</span>
                                <div style="font-family: monospace; font-size: 14px; color: #0f172a; margin-top: 4px;">${ownerAddress}</div>
                            </div>
                            <div>
                                <span style="color: #666; font-size: 12px;">${currentLang === 'zh' ? '项目总数' : 'Total Projects'}</span>
                                <div style="font-size: 24px; font-weight: bold; color: #3b82f6; margin-top: 4px;">${projectCount}</div>
                            </div>
                        </div>

                        <div>
                            <h3 style="color: #334155; font-size: 14px; margin-bottom: 10px;">
                                ${currentLang === 'zh' ? '项目地址列表' : 'Project Address List'}
                            </h3>
                            <div style="max-height: 300px; overflow-y: auto;">
                                ${projectListHTML || '<div style="text-align: center; color: #999; padding: 20px;">' + (currentLang === 'zh' ? '暂无项目' : 'No projects') + '</div>'}
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) modal.remove();
                });

            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '搜索失败' : 'Search failed', 'error');
            }
        }

        window.checkProjectName = async function checkProjectName() {
            const name = prompt(currentLang === 'zh' ? '输入项目名称:' : 'Enter project name:');
            const symbol = prompt(currentLang === 'zh' ? '输入项目符号:' : 'Enter project symbol:');

            if (!name || !symbol) return;

            if (!factoryContract) {
                const factoryAddress = document.getElementById('factoryAddress').value;
                if (!factoryAddress) {
                    showToast(currentLang === 'zh' ? '请先部署或输入 Factory 合约地址' : 'Please deploy or enter Factory contract address', 'error');
                    return;
                }
                factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);
            }

            try {
                const result = await factoryContract.methods.isProjectNameTaken(name, symbol).call({ from: '0x0000000000000000000000000000000000000000' });

                // Create beautiful modal for name check result
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;

                const isAvailable = !result.exists;
                const statusColor = isAvailable ? '#10b981' : '#ef4444';
                const statusIcon = isAvailable ? '✓' : '✗';

                modal.innerHTML = `
                    <div style="background: white; border-radius: 12px; padding: 25px; max-width: 500px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="color: #0f172a; margin: 0;">
                                ${currentLang === 'zh' ? '名称检查结果' : 'Name Check Result'}
                            </h2>
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()"
                                    style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">
                                ×
                            </button>
                        </div>

                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; color: ${statusColor}; margin-bottom: 15px;">${statusIcon}</div>
                            <div style="font-size: 18px; font-weight: bold; color: ${statusColor}; margin-bottom: 10px;">
                                ${isAvailable ?
                                    (currentLang === 'zh' ? '名称可用!' : 'Name is available!') :
                                    (currentLang === 'zh' ? '名称已被占用!' : 'Name is already taken!')}
                            </div>
                            <div style="margin-top: 15px;">
                                <div style="color: #666; font-size: 14px; margin-bottom: 5px;">
                                    ${currentLang === 'zh' ? '项目名称' : 'Project Name'}: <strong>${name}</strong>
                                </div>
                                <div style="color: #666; font-size: 14px;">
                                    ${currentLang === 'zh' ? '项目符号' : 'Project Symbol'}: <strong>${symbol}</strong>
                                </div>
                            </div>
                            ${!isAvailable ? `
                                <div style="margin-top: 20px; padding: 15px; background: #fef2f2; border-radius: 8px;">
                                    <div style="color: #666; font-size: 12px; margin-bottom: 5px;">
                                        ${currentLang === 'zh' ? '已存在的项目地址' : 'Existing Project Address'}
                                    </div>
                                    <div style="font-family: monospace; font-size: 12px; color: #0ea5e9; cursor: pointer;"
                                         onclick="copyToClipboard('${result.existingProject}')">
                                        ${result.existingProject}
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()"
                                    style="background: #3b82f6; color: white; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                ${currentLang === 'zh' ? '确定' : 'OK'}
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) modal.remove();
                });

            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '检查失败' : 'Check failed', 'error');
            }
        }

        window.copyAddress = function copyAddress(address) {
            const textarea = document.createElement('textarea');
            textarea.value = address;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            showToast(currentLang === 'zh' ? '地址已复制' : 'Address copied', 'success');
        }

        window.calculateFee = async function calculateFee() {
            const amount = prompt(currentLang === 'zh' ? '输入金额 (ETH):' : 'Enter amount (ETH):');
            if (!amount) return;

            if (!factoryContract) {
                const factoryAddress = document.getElementById('factoryAddress').value;
                if (!factoryAddress) {
                    showToast(currentLang === 'zh' ? '请先部署或输入 Factory 合约地址' : 'Please deploy or enter Factory contract address', 'error');
                    return;
                }
                factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);
            }

            try {
                const weiAmount = web3.utils.toWei(amount, 'ether');
                const fee = await factoryContract.methods.calculatePlatformFee(weiAmount).call({ from: '0x0000000000000000000000000000000000000000' });

                // Create beautiful modal for fee calculation
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;

                const feeAmount = parseFloat(web3.utils.fromWei(fee, 'ether'));
                const feePercentage = (feeAmount / parseFloat(amount) * 100).toFixed(2);
                const netAmount = (parseFloat(amount) - feeAmount).toFixed(6);

                modal.innerHTML = `
                    <div style="background: white; border-radius: 12px; padding: 25px; max-width: 450px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="color: #0f172a; margin: 0;">
                                ${currentLang === 'zh' ? '费用计算器' : 'Fee Calculator'}
                            </h2>
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()"
                                    style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">
                                ×
                            </button>
                        </div>

                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                                <span style="color: #666; font-size: 14px;">${currentLang === 'zh' ? '订阅金额' : 'Subscription Amount'}</span>
                                <span style="font-weight: bold; font-size: 16px;">${amount} ETH</span>
                            </div>
                        </div>

                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                                <span style="color: #666; font-size: 14px;">${currentLang === 'zh' ? '平台费用' : 'Platform Fee'}</span>
                                <div style="text-align: right;">
                                    <div style="font-weight: bold; font-size: 16px; color: #f59e0b;">${feeAmount.toFixed(6)} ETH</div>
                                    <div style="font-size: 12px; color: #92400e;">(${feePercentage}%)</div>
                                </div>
                            </div>
                        </div>

                        <div style="background: #dcfce7; padding: 15px; border-radius: 8px;">
                            <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                                <span style="color: #666; font-size: 14px;">${currentLang === 'zh' ? '项目方实收' : 'Project Receives'}</span>
                                <span style="font-weight: bold; font-size: 18px; color: #10b981;">${netAmount} ETH</span>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()"
                                    style="background: #3b82f6; color: white; border: none; padding: 10px 24px; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                ${currentLang === 'zh' ? '关闭' : 'Close'}
                            </button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) modal.remove();
                });

            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '计算失败' : 'Calculation failed', 'error');
            }
        }


        // Get current network currency symbol
        function getNetworkCurrency() {
            // First check custom networks (includes user-added and edited built-in networks)
            const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');

            // Check if currentChainId exists in customNetworks (edited built-in or custom)
            if (customNetworks[currentChainId]) {
                return customNetworks[currentChainId].currency || customNetworks[currentChainId].symbol || 'ETH';
            }

            // Then check built-in networks
            if (networks[currentChainId]) {
                return networks[currentChainId].currency || 'ETH';
            }

            // If no network selected, try to get from saved selection
            const savedNetwork = localStorage.getItem('selectedNetwork');
            if (savedNetwork) {
                if (customNetworks[savedNetwork]) {
                    return customNetworks[savedNetwork].currency || customNetworks[savedNetwork].symbol || 'ETH';
                }
                if (networks[savedNetwork]) {
                    return networks[savedNetwork].currency || 'ETH';
                }
            }

            // Default to ETH
            return 'ETH';
        }

        // Get network RPC URL
        function getNetworkRpcUrl(chainId) {
            // First check custom networks (includes user-added and edited built-in networks)
            const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');

            // Check if chainId exists in customNetworks
            if (customNetworks[chainId]) {
                return customNetworks[chainId].rpc || customNetworks[chainId].rpcUrl;
            }

            // Then check built-in networks
            const networks = {
                '1': { name: 'Ethereum Mainnet', rpc: 'https://eth.llamarpc.com' },
                '11155111': { name: 'Sepolia Testnet', rpc: 'https://sepolia.drpc.org' },
                '137': { name: 'Polygon', rpc: 'https://polygon-rpc.com' },
                '56': { name: 'BSC', rpc: 'https://bsc-dataseed.binance.org' },
                '42161': { name: 'Arbitrum One', rpc: 'https://arb1.arbitrum.io/rpc' },
                '10': { name: 'Optimism', rpc: 'https://mainnet.optimism.io' },
                '8453': { name: 'Base', rpc: 'https://mainnet.base.org' }
            };

            if (networks[chainId]) {
                return networks[chainId].rpc;
            }

            // Default to Base RPC
            return 'https://mainnet.base.org';
        }

        // Dynamic pricing display update
        window.updatePricingDisplay = function updatePricingDisplay() {
            const tiers = [
                { id: 'starter', name: '🥉 Starter', checked: document.getElementById('tier-starter').checked },
                { id: 'standard', name: '🥈 Standard', checked: document.getElementById('tier-standard').checked },
                { id: 'pro', name: '🥇 Pro', checked: document.getElementById('tier-pro').checked },
                { id: 'max', name: '💎 Max', checked: document.getElementById('tier-max').checked }
            ];

            const periods = [
                { id: 'daily', name: currentLang === 'zh' ? '日付' : 'Daily', checked: document.getElementById('period-daily').checked },
                { id: 'weekly', name: currentLang === 'zh' ? '周付' : 'Weekly', checked: document.getElementById('period-weekly').checked },
                { id: 'monthly', name: currentLang === 'zh' ? '月付' : 'Monthly', checked: document.getElementById('period-monthly').checked },
                { id: 'yearly', name: currentLang === 'zh' ? '年付' : 'Yearly', checked: document.getElementById('period-yearly').checked }
            ];

            const pricingContainer = document.getElementById('pricingConfiguration');
            pricingContainer.innerHTML = '';

            // Get current network currency
            const currency = getNetworkCurrency();

            // Only show pricing for selected tiers
            const selectedTiers = tiers.filter(t => t.checked);
            const selectedPeriods = periods.filter(p => p.checked);

            if (selectedTiers.length === 0 || selectedPeriods.length === 0) {
                pricingContainer.innerHTML = `<div style="grid-column: 1/-1; text-align: center; color: #666;">
                    ${currentLang === 'zh' ? '请先选择订阅层级和周期' : 'Please select subscription tiers and periods first'}
                </div>`;
                return;
            }

            selectedTiers.forEach(tier => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.background = '#f9fafb';
                card.innerHTML = `<h5 style="margin-bottom: 15px;">${tier.name}</h5>`;

                selectedPeriods.forEach(period => {
                    const formGroup = document.createElement('div');
                    formGroup.className = 'form-group';
                    formGroup.innerHTML = `
                        <label class="form-label">${period.name} (${currency})</label>
                        <input type="number" class="form-input" id="${tier.id}-${period.id}" step="0.001" placeholder="0.00">
                    `;
                    card.appendChild(formGroup);
                });

                pricingContainer.appendChild(card);
            });
        }

        // Global Factory Connection Function
        window.connectGlobalFactory = async function connectGlobalFactory() {
            const factoryAddress = document.getElementById('globalFactoryAddress').value;
            if (!factoryAddress) {
                showToast(currentLang === 'zh' ? '请输入 Factory 合约地址' : 'Please enter Factory contract address', 'error');
                return;
            }

            // Save Factory address for current network
            const selectedChainId = localStorage.getItem('selectedNetwork') || '8453'; // Default to Base
            localStorage.setItem(`factoryAddress_${selectedChainId}`, factoryAddress);

            // Get current RPC URL from selected network using the unified function
            const rpcUrl = getNetworkRpcUrl(selectedChainId);

            try {
                // Create a direct Web3 instance with RPC for read operations
                const directWeb3 = new Web3(new Web3.providers.HttpProvider(rpcUrl));

                // Create contract instance using direct RPC connection
                const readOnlyContract = new directWeb3.eth.Contract(FACTORY_ABI, factoryAddress);

                // Get Factory contract status
                let creationFee, platformFeeBasisPoints, projectCount;
                try {
                    // Fetch creation fee and platform fee
                    creationFee = await readOnlyContract.methods.projectCreationFee().call({ from: '0x0000000000000000000000000000000000000000' });
                    platformFeeBasisPoints = await readOnlyContract.methods.platformFeeBasisPoints().call({ from: '0x0000000000000000000000000000000000000000' });
                    projectCount = await readOnlyContract.methods.getTotalProjects().call({ from: '0x0000000000000000000000000000000000000000' });
                } catch (e) {
                    console.error('Error fetching factory info:', e);
                    throw new Error(currentLang === 'zh' ? '无效的 Factory 合约地址' : 'Invalid Factory contract address');
                }

                // Update status display
                const statusEl = document.getElementById('globalFactoryConnectionStatus');
                statusEl.style.color = '#10b981';
                statusEl.textContent = currentLang === 'zh' ? '✓ 已连接' : '✓ Connected';

                // Update Factory info display
                document.getElementById('globalCreationFee').textContent = `${directWeb3.utils.fromWei(creationFee, 'ether')} ETH`;
                document.getElementById('globalPlatformFee').textContent = `${(platformFeeBasisPoints / 100).toFixed(2)}%`;
                document.getElementById('globalProjectCount').textContent = projectCount;

                // Show Factory info display
                document.getElementById('globalFactoryInfo').style.display = 'block';

                showToast(currentLang === 'zh' ? 'Factory 合约连接成功' : 'Factory contract connected successfully', 'success');

                // If wallet is connected, also create contract instance with wallet web3
                if (web3 && typeof web3 !== 'undefined') {
                    // Keep a wallet-connected instance for write operations
                    factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);

                    // Load user projects if wallet is connected and in project owner role
                    if (accounts && accounts.length > 0 && document.querySelector('#project-content').style.display !== 'none') {
                        loadMyProjects();
                    }
                } else {
                    // Store the read-only contract for read operations
                    factoryContract = readOnlyContract;
                }

            } catch (error) {
                console.error(error);
                const statusEl = document.getElementById('globalFactoryConnectionStatus');
                statusEl.style.color = '#ef4444';
                statusEl.textContent = currentLang === 'zh' ? '✗ 连接失败' : '✗ Connection failed';

                // Hide info display on error
                document.getElementById('globalFactoryInfo').style.display = 'none';

                showToast(error.message || (currentLang === 'zh' ? '无效的 Factory 合约地址' : 'Invalid Factory contract address'), 'error');
            }
        }

        // Project Owner Functions
        window.connectProjectFactory = async function connectProjectFactory() {
            const factoryAddress = document.getElementById('projectFactoryAddress').value;
            if (!factoryAddress) {
                showToast(currentLang === 'zh' ? '请输入 Factory 合约地址' : 'Please enter Factory contract address', 'error');
                return;
            }

            // Get current RPC URL from selected network
            const selectedChainId = localStorage.getItem('selectedNetwork');
            let rpcUrl;

            if (selectedChainId) {
                // First check custom networks
                const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
                if (customNetworks[selectedChainId]) {
                    rpcUrl = customNetworks[selectedChainId].rpc;
                } else if (networks[selectedChainId]) {
                    // Then check built-in networks
                    rpcUrl = networks[selectedChainId].rpc;
                }
            }

            if (!rpcUrl) {
                showToast(currentLang === 'zh' ? '请先选择网络' : 'Please select a network first', 'error');
                return;
            }

            // Create Web3 instance with RPC directly
            const directWeb3 = new Web3(rpcUrl);

            try {
                // First verify the address has code (is a contract)
                const code = await directWeb3.eth.getCode(factoryAddress);
                if (code === '0x' || code === '0x0') {
                    showToast(currentLang === 'zh' ? '该地址不是合约地址' : 'This address is not a contract', 'error');
                    return;
                }

                // Create contract instance using direct RPC connection
                factoryContract = new directWeb3.eth.Contract(FACTORY_ABI, factoryAddress);

                // Get Factory contract status
                let creationFee, platformFeeBasisPoints;
                try {
                    // Fetch creation fee and platform fee
                    creationFee = await factoryContract.methods.projectCreationFee().call();
                    platformFeeBasisPoints = await factoryContract.methods.platformFeeBasisPoints().call();
                } catch (readError) {
                    console.warn('Failed to read factory data:', readError);
                    creationFee = '0';
                    platformFeeBasisPoints = '0';
                }

                const statusEl = document.getElementById('factoryConnectionStatus');
                statusEl.style.color = '#10b981';
                statusEl.textContent = currentLang === 'zh' ? '✓ 已连接' : '✓ Connected';

                // Get currency for selected network
                const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
                let currency = 'ETH';
                if (customNetworks[selectedChainId]) {
                    currency = customNetworks[selectedChainId].currency || 'ETH';
                } else if (networks[selectedChainId]) {
                    currency = networks[selectedChainId].currency || 'ETH';
                }

                // Update Factory status display
                const statusDisplay = document.getElementById('factoryStatusDisplay');
                statusDisplay.style.display = 'block';

                // Format and display creation fee
                const creationFeeFormatted = creationFee !== '0' ?
                    `${directWeb3.utils.fromWei(creationFee, 'ether')} ${currency}` :
                    `0 ${currency}`;
                document.getElementById('factoryCreationFee').textContent = creationFeeFormatted;

                // Format and display platform fee (convert basis points to percentage)
                const platformFeePercentage = (parseInt(platformFeeBasisPoints) / 100).toFixed(1);
                document.getElementById('factoryPlatformFee').textContent = `${platformFeePercentage}%`;

                // Max fee is always 30% (hardcoded in contract as MAX_PLATFORM_FEE_BASIS_POINTS = 3000)
                document.getElementById('factoryMaxFee').textContent = '30%';

                showToast(currentLang === 'zh' ?
                    'Factory 合约连接成功!' :
                    'Factory contract connected!',
                    'success'
                );

                // Auto-fill if Factory address exists in platform section
                const platformFactoryAddress = document.getElementById('factoryAddress').value;
                if (platformFactoryAddress && !factoryAddress) {
                    document.getElementById('projectFactoryAddress').value = platformFactoryAddress;
                }

                // If wallet is connected, also create contract instance with wallet web3
                if (web3 && typeof web3 !== 'undefined') {
                    // Keep a wallet-connected instance for write operations
                    factoryContract = new web3.eth.Contract(FACTORY_ABI, factoryAddress);

                    // Load user projects if wallet is connected
                    if (accounts && accounts.length > 0) {
                        loadMyProjects();
                    }
                }

            } catch (error) {
                console.error(error);
                const statusEl = document.getElementById('factoryConnectionStatus');
                statusEl.style.color = '#ef4444';
                statusEl.textContent = currentLang === 'zh' ? '✗ 连接失败' : '✗ Connection failed';

                // Hide status display on error
                document.getElementById('factoryStatusDisplay').style.display = 'none';

                showToast(currentLang === 'zh' ? '无效的 Factory 合约地址' : 'Invalid Factory contract address', 'error');
            }
        }

        window.createProject = async function createProject() {
            if (!factoryContract) {
                showToast(currentLang === 'zh' ? '请先连接 Factory 合约' : 'Please connect to Factory contract first', 'error');
                return;
            }

            const name = document.getElementById('projectName').value;
            const symbol = document.getElementById('projectSymbol').value;

            if (!name || !symbol) {
                showToast(currentLang === 'zh' ? '请填写项目信息' : 'Please fill in project information', 'error');
                return;
            }

            // Collect pricing data based on selections
            const tierIds = ['starter', 'standard', 'pro', 'max'];
            const periodIds = ['daily', 'weekly', 'monthly', 'yearly'];
            const prices = [];

            // Build 4x4 price matrix, filling with 0 for unselected options
            for (let i = 0; i < 4; i++) {
                const tierPrices = [];
                for (let j = 0; j < 4; j++) {
                    const inputId = `${tierIds[i]}-${periodIds[j]}`;
                    const input = document.getElementById(inputId);
                    const value = input && input.value ? input.value : '0';
                    tierPrices.push(web3.utils.toWei(value, 'ether'));
                }
                prices.push(tierPrices);
            }

            // Get enabled periods from checkboxes
            const enabledPeriods = [
                document.getElementById('period-daily').checked,
                document.getElementById('period-weekly').checked,
                document.getElementById('period-monthly').checked,
                document.getElementById('period-yearly').checked
            ];

            // Get custom tier names
            const tierNames = [
                document.getElementById('tier-name-starter').value || 'Starter',
                document.getElementById('tier-name-standard').value || 'Standard',
                document.getElementById('tier-name-pro').value || 'Pro',
                document.getElementById('tier-name-max').value || 'Max'
            ];

            // Determine maxTier based on selected tiers (highest selected tier)
            let maxTier = 0;
            for (let i = 3; i >= 0; i--) {
                if (document.getElementById(`tier-${tierIds[i]}`).checked) {
                    maxTier = i;
                    break;
                }
            }

            const brandConfig = {
                name: name,
                symbol: symbol,
                description: '',  // Empty for now, can add input field later
                logoUri: '',      // Empty for now, can add input field later
                websiteUrl: '',   // Empty for now, can add input field later
                primaryColor: '#000000',  // Default color, can add color picker later
                maxTier: maxTier,
                enabledPeriods: enabledPeriods,
                tierNames: tierNames
            };

            try {
                const creationFee = await factoryContract.methods.projectCreationFee().call({ from: '0x0000000000000000000000000000000000000000' });


                console.log("deployNewProject", brandConfig,
                    accounts[0], creationFee,
                    prices)
                const result = await factoryContract.methods.deployNewProject(
                    brandConfig,
                    accounts[0],
                    prices
                ).send({
                    from: accounts[0],
                    value: creationFee
                });



                showToast(currentLang === 'zh' ? '项目创建成功！' : 'Project created successfully!', 'success');

                // Get the project address from the event
                const projectAddress = result.events.ProjectDeployed.returnValues.project;
                document.getElementById('manageProjectAddress').value = projectAddress;

                // Refresh the project list to show the new project
                await loadMyProjects();

                // Note: Reader implementation is now set at Factory level, no need for project-level setting

            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '创建失败' : 'Creation failed', 'error');
            }
        }

        // My Projects Management
        let myProjectsCurrentPage = 1;
        const myProjectsPerPage = 10;
        let myProjectsTotalCount = 0;

        window.refreshMyProjects = async function refreshMyProjects() {
            await loadMyProjects();
        }

        window.loadMyProjects = async function loadMyProjects() {
            if (!factoryContract || !accounts || accounts.length === 0) {
                return;
            }

            try {
                // Create a direct RPC connection for read operations
                const selectedChainId = localStorage.getItem('selectedNetwork') || '8453';
                const rpcUrl = getNetworkRpcUrl(selectedChainId);
                const directWeb3 = new Web3(new Web3.providers.HttpProvider(rpcUrl));
                const factoryReadOnly = new directWeb3.eth.Contract(FACTORY_ABI, factoryContract._address || factoryContract.options.address);

                // Get total count using RPC directly
                myProjectsTotalCount = await factoryReadOnly.methods.getOwnerProjectCount(accounts[0]).call({
                    from: '0x0000000000000000000000000000000000000000'
                });

                document.getElementById('totalProjectCount').textContent = myProjectsTotalCount;

                if (myProjectsTotalCount === '0' || myProjectsTotalCount === 0) {
                    document.getElementById('myProjectsTableBody').innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-state-icon">📭</div>
                                <div class="text" data-zh="暂无项目" data-en="No projects yet">${currentLang === 'zh' ? '暂无项目' : 'No projects yet'}</div>
                            </td>
                        </tr>
                    `;
                    updateMyProjectsPagination();
                    return;
                }

                // Calculate pagination
                const offset = (myProjectsCurrentPage - 1) * myProjectsPerPage;
                const limit = myProjectsPerPage;

                // Get paginated projects using RPC directly
                const result = await factoryReadOnly.methods.getOwnerProjectsPaginated(
                    accounts[0],
                    offset,
                    limit
                ).call({ from: '0x0000000000000000000000000000000000000000' });

                const projectAddresses = result[0];
                const tbody = document.getElementById('myProjectsTableBody');
                tbody.innerHTML = '';

                if (projectAddresses.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-state-icon">📭</div>
                                <div class="text" data-zh="暂无项目" data-en="No projects yet">${currentLang === 'zh' ? '暂无项目' : 'No projects yet'}</div>
                            </td>
                        </tr>
                    `;
                } else {
                    // Fetch details for each project using RPC directly
                    for (const address of projectAddresses) {
                        try {
                            const project = new directWeb3.eth.Contract(PROJECT_ABI, address);

                            // Get brand config and stats in parallel for better performance
                            const [brandConfig, stats] = await Promise.all([
                                project.methods.getBrandConfig().call({
                                    from: '0x0000000000000000000000000000000000000000'
                                }),
                                project.methods.getProjectStats().call({
                                    from: '0x0000000000000000000000000000000000000000'
                                })
                            ]);

                            // Format revenue with proper decimals
                            const revenue = parseFloat(web3.utils.fromWei(stats.netRevenue || '0', 'ether')).toFixed(4);
                            const currency = getNetworkCurrency();

                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div>
                                            <div style="font-weight: bold;">${brandConfig.name || 'Unnamed'}</div>
                                            <div style="font-size: 11px; color: #666;">${brandConfig.symbol || '-'}</div>
                                        </div>
                                    </div>
                                </td>
                                <td style="font-family: monospace; font-size: 12px;">
                                    <a href="#" onclick="copyToClipboard('${address}'); return false;" title="${currentLang === 'zh' ? '点击复制' : 'Click to copy'}" style="color: #0ea5e9; text-decoration: none;">
                                        ${address.substring(0, 6)}...${address.substring(38)}
                                    </a>
                                </td>
                                <td>
                                    <div style="text-align: right;">
                                        <div style="font-weight: bold; color: #10b981;">${revenue} ${currency}</div>
                                        <div style="font-size: 11px; color: #666;">${currentLang === 'zh' ? '净收入' : 'Net Revenue'}</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="text-align: center;">
                                        <div style="font-size: 18px; font-weight: bold; color: #3b82f6;">${stats.subscribers || 0}</div>
                                        <div style="font-size: 11px; color: #666;">${currentLang === 'zh' ? '订阅者' : 'Subscribers'}</div>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 5px;">
                                        <button class="btn-primary" style="padding: 5px 10px; font-size: 12px;" onclick="manageProject('${address}')">
                                            ${currentLang === 'zh' ? '管理' : 'Manage'}
                                        </button>
                                        <button class="btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="viewProjectDetails('${address}')">
                                            ${currentLang === 'zh' ? '详情' : 'Details'}
                                        </button>
                                    </div>
                                </td>
                            `;
                            tbody.appendChild(row);
                        } catch (error) {
                            console.error(`Error loading project ${address}:`, error);

                            // Handle loading errors with better UI
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <div style="color: #ef4444;">⚠️</div>
                                        <div>
                                            <div style="color: #666;">${currentLang === 'zh' ? '加载失败' : 'Failed to load'}</div>
                                            <div style="font-size: 11px; color: #999;">${currentLang === 'zh' ? '点击重试' : 'Click to retry'}</div>
                                        </div>
                                    </div>
                                </td>
                                <td style="font-family: monospace; font-size: 12px;">
                                    <a href="#" onclick="copyToClipboard('${address}'); return false;" title="${currentLang === 'zh' ? '点击复制' : 'Click to copy'}" style="color: #0ea5e9; text-decoration: none;">
                                        ${address.substring(0, 6)}...${address.substring(38)}
                                    </a>
                                </td>
                                <td style="text-align: center; color: #999;">-</td>
                                <td style="text-align: center; color: #999;">-</td>
                                <td>
                                    <div style="display: flex; gap: 5px;">
                                        <button class="btn-warning" style="padding: 5px 10px; font-size: 12px;" onclick="retryLoadProject('${address}')">
                                            ${currentLang === 'zh' ? '🔄 重试' : '🔄 Retry'}
                                        </button>
                                        <button class="btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="manageProject('${address}')">
                                            ${currentLang === 'zh' ? '管理' : 'Manage'}
                                        </button>
                                    </div>
                                </td>
                            `;
                            tbody.appendChild(row);
                        }
                    }
                }

                updateMyProjectsPagination();
            } catch (error) {
                console.error('Error loading projects:', error);
                showToast(currentLang === 'zh' ? '加载项目列表失败' : 'Failed to load projects', 'error');
            }
        }

        window.updateMyProjectsPagination = function updateMyProjectsPagination() {
            const totalPages = Math.ceil(myProjectsTotalCount / myProjectsPerPage) || 1;

            document.getElementById('myProjectsCurrentPage').textContent = myProjectsCurrentPage;
            document.getElementById('myProjectsTotalPages').textContent = totalPages;

            document.getElementById('myProjectsPrevBtn').disabled = myProjectsCurrentPage <= 1;
            document.getElementById('myProjectsNextBtn').disabled = myProjectsCurrentPage >= totalPages;
        }

        window.changeMyProjectsPage = async function changeMyProjectsPage(direction) {
            const totalPages = Math.ceil(myProjectsTotalCount / myProjectsPerPage) || 1;
            const newPage = myProjectsCurrentPage + direction;

            if (newPage >= 1 && newPage <= totalPages) {
                myProjectsCurrentPage = newPage;
                await loadMyProjects();
            }
        }

        window.manageProject = function manageProject(address) {
            // Store the project address globally for management
            window.currentManagedProject = address;
            showToast(currentLang === 'zh' ? `项目 ${address.substring(0, 6)}...${address.substring(38)} 已选中进行管理` : `Project ${address.substring(0, 6)}...${address.substring(38)} selected for management`, 'success');

            // Load the project details modal
            viewProjectDetails(address);
        }

        window.viewProjectDetails = async function viewProjectDetails(address) {
            try {
                showToast(currentLang === 'zh' ? '正在加载项目详情...' : 'Loading project details...', 'info');

                // Create a direct RPC connection for read operations
                const selectedChainId = localStorage.getItem('selectedNetwork') || '8453';
                const rpcUrl = getNetworkRpcUrl(selectedChainId);
                const directWeb3 = new Web3(new Web3.providers.HttpProvider(rpcUrl));
                const project = new directWeb3.eth.Contract(PROJECT_ABI, address);

                // Fetch all data in parallel for better performance using RPC directly
                const [brandConfig, stats, plans, withdrawableBalance, owner] = await Promise.all([
                    project.methods.getBrandConfig().call({ from: '0x0000000000000000000000000000000000000000' }),
                    project.methods.getProjectStats().call({ from: '0x0000000000000000000000000000000000000000' }),
                    project.methods.getAllPlans().call({ from: '0x0000000000000000000000000000000000000000' }),
                    project.methods.getWithdrawableBalance().call({ from: '0x0000000000000000000000000000000000000000' }),
                    project.methods.owner().call({ from: '0x0000000000000000000000000000000000000000' })
                ]);

                const currency = getNetworkCurrency();

                // Build detailed HTML modal content
                let modalContent = `
                    <div style="max-width: 1200px; width: 90vw; max-height: 80vh; overflow-y: auto; padding: 20px;">
                        <h2 style="margin-bottom: 20px; color: #0f172a;">
                            ${brandConfig.name || 'Unnamed Project'}
                            <span style="font-size: 14px; color: #666; margin-left: 10px;">${brandConfig.symbol || 'N/A'}</span>
                        </h2>

                        <!-- Basic Info -->
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 10px; color: #334155; font-size: 16px;">
                                ${currentLang === 'zh' ? '基本信息' : 'Basic Information'}
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                <div>
                                    <span style="color: #666; font-size: 12px;">${currentLang === 'zh' ? '合约地址' : 'Contract Address'}</span>
                                    <div style="font-family: monospace; font-size: 11px; color: #0ea5e9; cursor: pointer;" onclick="copyToClipboard('${address}')">
                                        ${address}
                                    </div>
                                </div>
                                <div>
                                    <span style="color: #666; font-size: 12px;">${currentLang === 'zh' ? '所有者' : 'Owner'}</span>
                                    <div style="font-family: monospace; font-size: 11px;">
                                        ${owner.substring(0, 6)}...${owner.substring(38)}
                                    </div>
                                </div>
                                ${brandConfig.description ? `
                                <div style="grid-column: 1 / -1;">
                                    <span style="color: #666; font-size: 12px;">${currentLang === 'zh' ? '描述' : 'Description'}</span>
                                    <div style="font-size: 13px;">${brandConfig.description}</div>
                                </div>` : ''}
                                ${brandConfig.websiteUrl ? `
                                <div>
                                    <span style="color: #666; font-size: 12px;">${currentLang === 'zh' ? '网站' : 'Website'}</span>
                                    <div><a href="${brandConfig.websiteUrl}" target="_blank" style="color: #0ea5e9;">${brandConfig.websiteUrl}</a></div>
                                </div>` : ''}
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <h3 style="margin-bottom: 10px; color: #334155; font-size: 16px;">
                                ${currentLang === 'zh' ? '统计数据' : 'Statistics'}
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #10b981;">
                                        ${parseFloat(web3.utils.fromWei(stats.grossRevenue || '0', 'ether')).toFixed(4)}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '总收入' : 'Gross Revenue'} (${currency})</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #3b82f6;">
                                        ${parseFloat(web3.utils.fromWei(stats.netRevenue || '0', 'ether')).toFixed(4)}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '净收入' : 'Net Revenue'} (${currency})</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #8b5cf6;">
                                        ${stats.subscribers || 0}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '订阅者总数' : 'Total Subscribers'}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">
                                        ${parseFloat(web3.utils.fromWei(withdrawableBalance.withdrawableAmount || '0', 'ether')).toFixed(4)}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '可提取' : 'Withdrawable'} (${currency})</div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 18px; font-weight: bold; color: #666;">
                                        ${stats.referrers || 0}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '推广员数' : 'Referrers'}</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 18px; font-weight: bold; color: #666;">
                                        ${parseFloat(web3.utils.fromWei(stats.platformFees || '0', 'ether')).toFixed(4)}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '平台费用' : 'Platform Fees'} (${currency})</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 18px; font-weight: bold; color: #666;">
                                        ${parseFloat(web3.utils.fromWei(stats.referralRewardsDistributed || '0', 'ether')).toFixed(4)}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '已发推广奖励' : 'Referral Rewards'} (${currency})</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 18px; font-weight: bold; color: #666;">
                                        ${stats.referralSubscriptions || 0}
                                    </div>
                                    <div style="font-size: 12px; color: #666;">${currentLang === 'zh' ? '推广订阅数' : 'Referral Subs'}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Subscription Plans -->
                        <div style="background: #fef3c7; padding: 15px; border-radius: 8px;">
                            <h3 style="margin-bottom: 10px; color: #334155; font-size: 16px;">
                                ${currentLang === 'zh' ? '订阅计划' : 'Subscription Plans'}
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                `;

                const periodNames = currentLang === 'zh' ?
                    ['日付', '周付', '月付', '年付'] :
                    ['Daily', 'Weekly', 'Monthly', 'Yearly'];

                const enabledPeriods = brandConfig.enabledPeriods || [false, false, false, false];

                plans.forEach(plan => {
                    if (plan.isActive) {
                        const tierName = plan.customName || brandConfig.tierNames[plan.tier] || `Tier ${plan.tier}`;
                        modalContent += `
                            <div style="background: white; padding: 10px; border-radius: 6px;">
                                <h4 style="margin-bottom: 8px; color: #0f172a; font-size: 14px;">${tierName}</h4>
                        `;

                        plan.prices.forEach((price, idx) => {
                            if (price !== '0' && enabledPeriods[idx]) {
                                modalContent += `
                                    <div style="display: flex; justify-content: space-between; padding: 4px 0; font-size: 12px;">
                                        <span style="color: #666;">${periodNames[idx]}:</span>
                                        <span style="font-weight: bold;">${parseFloat(web3.utils.fromWei(price, 'ether')).toFixed(4)} ${currency}</span>
                                    </div>
                                `;
                            }
                        });

                        if (plan.features && plan.features.length > 0) {
                            modalContent += `
                                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                                    <div style="font-size: 11px; color: #666; margin-bottom: 4px;">${currentLang === 'zh' ? '功能' : 'Features'}:</div>
                                    <ul style="margin: 0; padding-left: 16px; font-size: 11px;">
                            `;
                            plan.features.forEach(feature => {
                                modalContent += `<li>${feature}</li>`;
                            });
                            modalContent += `</ul></div>`;
                        }

                        modalContent += `</div>`;
                    }
                });

                modalContent += `
                            </div>
                        </div>
                    </div>
                `;

                // Create and show modal
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;

                modal.innerHTML = `
                    <div style="background: white; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); position: relative;">
                        <button onclick="this.closest('div[style*=\\"position: fixed\\"]').remove()"
                                style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">
                            ×
                        </button>
                        ${modalContent}
                    </div>
                `;

                document.body.appendChild(modal);

                // Close modal when clicking outside
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });

            } catch (error) {
                console.error('Error viewing project details:', error);
                showToast(currentLang === 'zh' ? '获取项目详情失败' : 'Failed to get project details', 'error');
            }
        }

        window.copyToClipboard = function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast(currentLang === 'zh' ? '已复制到剪贴板' : 'Copied to clipboard', 'success');
            }).catch(() => {
                showToast(currentLang === 'zh' ? '复制失败' : 'Copy failed', 'error');
            });
        }

        window.retryLoadProject = async function retryLoadProject(address) {
            // Simply reload the entire project list
            await loadMyProjects();
            showToast(currentLang === 'zh' ? '正在重新加载...' : 'Reloading...', 'info');
        }

        window.loadProjectStats = async function loadProjectStats() {
            const projectAddress = document.getElementById('manageProjectAddress').value;
            if (!projectAddress) {
                showToast(currentLang === 'zh' ? '请输入项目地址' : 'Please enter project address', 'error');
                return;
            }

            try {
                projectContract = new web3.eth.Contract(PROJECT_ABI, projectAddress);
                const stats = await projectContract.methods.getProjectStats().call({ from: '0x0000000000000000000000000000000000000000' });

                document.getElementById('projectRevenue').textContent = web3.utils.fromWei(stats.grossRevenue, 'ether') + ' ETH';
                document.getElementById('totalSubscribers').textContent = stats.subscribers;
                document.getElementById('activeSubscribers').textContent = stats.subscribers; // You might want to calculate active separately

                showToast(currentLang === 'zh' ? '统计加载成功' : 'Stats loaded successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '加载失败' : 'Loading failed', 'error');
            }
        }

        window.withdrawProjectFunds = async function withdrawProjectFunds() {
            if (!projectContract) {
                showToast(currentLang === 'zh' ? '请先加载项目' : 'Please load project first', 'error');
                return;
            }

            try {
                await projectContract.methods.withdraw(accounts[0]).send({ from: accounts[0] });
                showToast(currentLang === 'zh' ? '提取成功' : 'Withdrawal successful', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '提取失败' : 'Withdrawal failed', 'error');
            }
        }

        window.viewSubscribers = async function viewSubscribers() {
            const projectAddress = document.getElementById('manageProjectAddress').value;
            if (!projectAddress) {
                showToast(currentLang === 'zh' ? '请输入项目地址' : 'Please enter project address', 'error');
                return;
            }

            try {
                if (!projectContract) {
                    projectContract = new web3.eth.Contract(PROJECT_ABI, projectAddress);
                }

                const result = await projectContract.methods.getSubscribersPaginated(0, 100).call({ from: '0x0000000000000000000000000000000000000000' });
                const subscribers = result[0];
                const subscriptions = result[1];

                const tbody = document.querySelector('#subscribersTable tbody');
                tbody.innerHTML = '';

                if (subscribers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="empty-state">
                                <div class="empty-state-icon">📭</div>
                                <div>${currentLang === 'zh' ? '暂无订阅者' : 'No subscribers yet'}</div>
                            </td>
                        </tr>
                    `;
                } else {
                    const tierNames = ['Starter', 'Standard', 'Pro', 'Max']
                    const periodNames = currentLang === 'zh' ?
                        ['月付', '季付', '半年付', '年付'] :
                        ['Monthly', 'Quarterly', 'Semi-Annual', 'Annual'];

                    subscribers.forEach((addr, index) => {
                        const sub = subscriptions[index];
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${addr.substring(0, 6)}...${addr.substring(38)}</td>
                            <td>${tierNames[sub.tier]}</td>
                            <td>${periodNames[sub.period]}</td>
                            <td><span class="badge ${sub.isActive ? 'badge-success' : 'badge-danger'}">${sub.isActive ? (currentLang === 'zh' ? '活跃' : 'Active') : (currentLang === 'zh' ? '过期' : 'Expired')
                            }</span></td>
                            <td>${new Date(sub.endTime * 1000).toLocaleDateString()}</td>
                            <td>${web3.utils.fromWei(sub.totalPaid, 'ether')} ETH</td>
                        `;
                    });
                }

                document.getElementById('subscribersCard').style.display = 'block';
                showToast(currentLang === 'zh' ? '订阅者列表加载成功' : 'Subscribers loaded successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '加载失败' : 'Loading failed', 'error');
            }
        }

        window.showUpdatePlanModal = function showUpdatePlanModal() {
            if (!projectContract) {
                showToast(currentLang === 'zh' ? '请先加载项目' : 'Please load project first', 'error');
                return;
            }
            document.getElementById('updatePlanModal').classList.add('active');
        }

        window.closeUpdatePlanModal = function closeUpdatePlanModal() {
            document.getElementById('updatePlanModal').classList.remove('active');
        }

        window.updatePlanConfig = async function updatePlanConfig() {
            if (!projectContract) {
                showToast(currentLang === 'zh' ? '请先加载项目' : 'Please load project first', 'error');
                return;
            }

            const tier = document.getElementById('updateTier').value;
            const prices = [
                web3.utils.toWei(document.getElementById('updateMonthly').value || '0', 'ether'),
                web3.utils.toWei(document.getElementById('updateQuarterly').value || '0', 'ether'),
                web3.utils.toWei(document.getElementById('updateSemiannual').value || '0', 'ether'),
                web3.utils.toWei(document.getElementById('updateAnnual').value || '0', 'ether')
            ];
            const features = document.getElementById('updateFeatures').value.split('\n').filter(f => f.trim());

            try {
                await projectContract.methods.setPlanConfig(tier, prices, features).send({ from: accounts[0] });
                showToast(currentLang === 'zh' ? '计划配置更新成功' : 'Plan configuration updated', 'success');
                closeUpdatePlanModal();
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '更新失败' : 'Update failed', 'error');
            }
        }

        // Referrer Functions
        window.generateReferralLink = function generateReferralLink() {
            const projectAddress = document.getElementById('referralProjectAddress').value;
            if (!projectAddress || !accounts[0]) {
                showToast(currentLang === 'zh' ? '请输入项目地址并连接钱包' : 'Please enter project address and connect wallet', 'error');
                return;
            }

            const baseUrl = window.location.origin + window.location.pathname;
            const referralLink = `${baseUrl}?project=${projectAddress}&ref=${accounts[0]}`;
            document.getElementById('referralLink').value = referralLink;
            showToast(currentLang === 'zh' ? '推广链接已生成' : 'Referral link generated', 'success');
        }

        window.copyReferralLink = function copyReferralLink() {
            const linkInput = document.getElementById('referralLink');
            linkInput.select();
            document.execCommand('copy');
            showToast(currentLang === 'zh' ? '链接已复制' : 'Link copied', 'success');
        }

        window.claimReferralRewards = async function claimReferralRewards() {
            const projectAddress = document.getElementById('referralProjectAddress').value;
            if (!projectAddress) {
                showToast(currentLang === 'zh' ? '请输入项目地址' : 'Please enter project address', 'error');
                return;
            }

            try {
                const project = new web3.eth.Contract(PROJECT_ABI, projectAddress);
                await project.methods.claimReferralRewards().send({ from: accounts[0] });
                showToast(currentLang === 'zh' ? '奖励领取成功' : 'Rewards claimed successfully', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '领取失败' : 'Claim failed', 'error');
            }
        }

        // Subscriber Functions
        window.loadProjectDetails = async function loadProjectDetails() {
            const projectAddress = document.getElementById('browseProjectAddress').value;
            if (!projectAddress) {
                showToast(currentLang === 'zh' ? '请输入项目地址' : 'Please enter project address', 'error');
                return;
            }

            try {
                const project = new web3.eth.Contract(PROJECT_ABI, projectAddress);
                const brandConfig = await project.methods.getBrandConfig().call({ from: '0x0000000000000000000000000000000000000000' });
                const plans = await project.methods.getAllPlans().call({ from: '0x0000000000000000000000000000000000000000' });

                document.getElementById('projectDetailName').textContent = brandConfig.name;
                document.getElementById('projectDetails').style.display = 'block';

                // Display tier information
                const tierSelection = document.getElementById('tierSelection');
                tierSelection.innerHTML = '';

                plans.forEach((plan, index) => {
                    if (plan.isActive) {
                        const tierCard = document.createElement('div');
                        tierCard.className = 'tier-card';
                        tierCard.innerHTML = `
                            <div class="tier-name">${['🥉 Starter', '🥈 Standard', '🥇 Pro', '💎 Max'][index]}</div>
                            <div class="tier-price">${web3.utils.fromWei(plan.prices[0], 'ether')} ETH/月</div>
                        `;
                        tierSelection.appendChild(tierCard);
                    }
                });

                showToast(currentLang === 'zh' ? '项目详情加载成功' : 'Project details loaded', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '加载失败' : 'Loading failed', 'error');
            }
        }

        window.subscribe = async function subscribe() {
            const projectAddress = document.getElementById('subscribeProjectAddress').value;
            const tier = document.getElementById('subscribeTier').value;
            const period = document.getElementById('subscribePeriod').value;
            const referrer = document.getElementById('referrerAddress').value || '0x0000000000000000000000000000000000000000';

            if (!projectAddress) {
                showToast(currentLang === 'zh' ? '请输入项目地址' : 'Please enter project address', 'error');
                return;
            }

            try {
                const project = new web3.eth.Contract(PROJECT_ABI, projectAddress);
                const plan = await project.methods.getPlan(tier).call({ from: '0x0000000000000000000000000000000000000000' });
                const price = plan.prices[period];

                document.getElementById('paymentAmount').value = web3.utils.fromWei(price, 'ether') + ' ETH';

                await project.methods.subscribe(tier, period, referrer).send({
                    from: accounts[0],
                    value: price
                });

                showToast(currentLang === 'zh' ? '订阅成功！' : 'Subscription successful!', 'success');
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '订阅失败' : 'Subscription failed', 'error');
            }
        }

        window.loadMySubscription = async function loadMySubscription() {
            const projectAddress = document.getElementById('checkSubscriptionAddress').value;
            if (!projectAddress || !accounts[0]) {
                showToast(currentLang === 'zh' ? '请输入项目地址并连接钱包' : 'Please enter project address and connect wallet', 'error');
                return;
            }

            try {
                const project = new web3.eth.Contract(PROJECT_ABI, projectAddress);
                const subscription = await project.methods.getUserSubscription(accounts[0]).call({ from: '0x0000000000000000000000000000000000000000' });
                const hasActive = await project.methods.hasActiveSubscription(accounts[0]).call({ from: '0x0000000000000000000000000000000000000000' });

                const tierNames = ['Basic', 'Standard', 'Premium', 'Enterprise'];
                const periodNames = currentLang === 'zh' ?
                    ['月付', '季付', '半年付', '年付'] :
                    ['Monthly', 'Quarterly', 'Semi-Annual', 'Annual'];

                document.getElementById('currentTier').textContent = tierNames[subscription.tier];
                document.getElementById('currentPeriod').textContent = periodNames[subscription.period];
                document.getElementById('subStatus').innerHTML = hasActive ?
                    `<span class="badge badge-success">${currentLang === 'zh' ? '活跃' : 'Active'}</span>` :
                    `<span class="badge badge-danger">${currentLang === 'zh' ? '过期' : 'Expired'}</span>`;
                document.getElementById('expiryDate').textContent = new Date(subscription.endTime * 1000).toLocaleDateString();

                document.getElementById('subscriptionDetails').style.display = 'block';

                // Store for later use
                window.currentSubscriptionProject = projectAddress;
                window.currentSubscription = subscription;

            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '加载失败' : 'Loading failed', 'error');
            }
        }

        window.showRenewModal = function showRenewModal() {
            if (!window.currentSubscriptionProject) {
                showToast(currentLang === 'zh' ? '请先加载订阅信息' : 'Please load subscription first', 'error');
                return;
            }
            // You can create a modal for renewal similar to subscribe modal
            renewSubscription();
        }

        async function renewSubscription() {
            try {
                const project = new web3.eth.Contract(PROJECT_ABI, window.currentSubscriptionProject);
                const sub = window.currentSubscription;
                const plan = await project.methods.getPlan(sub.tier).call({ from: '0x0000000000000000000000000000000000000000' });
                const price = plan.prices[sub.period];

                await project.methods.renew(sub.tier, sub.period).send({
                    from: accounts[0],
                    value: price
                });

                showToast(currentLang === 'zh' ? '续订成功！' : 'Renewal successful!', 'success');
                loadMySubscription(); // Reload subscription info
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '续订失败' : 'Renewal failed', 'error');
            }
        }

        window.showUpgradeModal = function showUpgradeModal() {
            if (!window.currentSubscriptionProject) {
                showToast(currentLang === 'zh' ? '请先加载订阅信息' : 'Please load subscription first', 'error');
                return;
            }

            const newTier = prompt(currentLang === 'zh' ?
                '输入新层级 (1=Standard, 2=Pro, 3=Max):' :
                'Enter new tier (1=Standard, 2=Pro, 3=Max):');
            const newPeriod = prompt(currentLang === 'zh' ?
                '输入周期 (0=日付，1=周付，2=月付，3=年付):' :
                'Enter period (0=Daily, 1=Weekly, 2=Monthly, 3=Yearly):');

            if (newTier && newPeriod !== null) {
                upgradeSubscription(newTier, newPeriod);
            }
        }

        async function upgradeSubscription(newTier, newPeriod) {
            try {
                const project = new web3.eth.Contract(PROJECT_ABI, window.currentSubscriptionProject);
                const plan = await project.methods.getPlan(newTier).call({ from: '0x0000000000000000000000000000000000000000' });
                const price = plan.prices[newPeriod];

                await project.methods.upgrade(newTier, newPeriod).send({
                    from: accounts[0],
                    value: price
                });

                showToast(currentLang === 'zh' ? '升级成功！' : 'Upgrade successful!', 'success');
                loadMySubscription(); // Reload subscription info
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '升级失败' : 'Upgrade failed', 'error');
            }
        }

        window.showDowngradeModal = function showDowngradeModal() {
            if (!window.currentSubscriptionProject) {
                showToast(currentLang === 'zh' ? '请先加载订阅信息' : 'Please load subscription first', 'error');
                return;
            }

            const newTier = prompt(currentLang === 'zh' ?
                '输入新层级 (0=Starter, 1=Standard, 2=Pro):' :
                'Enter new tier (0=Starter, 1=Standard, 2=Pro):');
            const newPeriod = prompt(currentLang === 'zh' ?
                '输入周期 (0=日付，1=周付，2=月付，3=年付):' :
                'Enter period (0=Daily, 1=Weekly, 2=Monthly, 3=Yearly):');

            if (newTier !== null && newPeriod !== null) {
                downgradeSubscription(newTier, newPeriod);
            }
        }

        async function downgradeSubscription(newTier, newPeriod) {
            try {
                const project = new web3.eth.Contract(PROJECT_ABI, window.currentSubscriptionProject);
                const plan = await project.methods.getPlan(newTier).call({ from: '0x0000000000000000000000000000000000000000' });
                const price = plan.prices[newPeriod];

                await project.methods.downgrade(newTier, newPeriod).send({
                    from: accounts[0],
                    value: price
                });

                showToast(currentLang === 'zh' ? '降级成功！' : 'Downgrade successful!', 'success');
                loadMySubscription(); // Reload subscription info
            } catch (error) {
                console.error(error);
                showToast(currentLang === 'zh' ? '降级失败' : 'Downgrade failed', 'error');
            }
        }

        // ==================== Subscriber Section Functions ====================

        window.loadSubscriberProjectDetails = async function loadSubscriberProjectDetails() {
            try {
                const projectAddress = document.getElementById('subscriberProjectAddress').value;
                if (!projectAddress || !web3.utils.isAddress(projectAddress)) {
                    showToast(currentLang === 'zh' ? '请输入有效的项目地址' : 'Please enter a valid project address', 'error');
                    return;
                }

                showToast(currentLang === 'zh' ? '正在加载项目详情...' : 'Loading project details...', 'info');

                // Get RPC for read operations - IMPORTANT: Use RPC directly, not wallet
                const selectedChainId = localStorage.getItem('selectedNetwork') || '8453';
                const rpcUrl = getNetworkRpcUrl(selectedChainId);
                const web3Read = new Web3(new Web3.providers.HttpProvider(rpcUrl));
                const project = new web3Read.eth.Contract(PROJECT_ABI, projectAddress);

                // Store for later use
                window.currentSubscriberProject = projectAddress;

                console.log(11)
                // Fetch project details using RPC directly
                const [brandConfig, stats] = await Promise.all([
                    project.methods.getBrandConfig().call({ from: '0x0000000000000000000000000000000000000000' }),
                    project.methods.getProjectStats().call({ from: '0x0000000000000000000000000000000000000000' })
                ]);
                console.log(22)
                // Display project info with logo, website, and theme color
                const projectInfoDiv = document.getElementById('subscriberProjectInfo');
                projectInfoDiv.innerHTML = `
                    <div style="background: linear-gradient(135deg, ${brandConfig.primaryColor || '#4CAF50'}15 0%, ${brandConfig.primaryColor || '#4CAF50'}05 100%); padding: 20px; border-radius: 12px; border: 1px solid ${brandConfig.primaryColor || '#4CAF50'}30;">
                        <div style="display: flex; align-items: start; gap: 20px;">
                            ${brandConfig.logoUri ? `
                                <img src="${brandConfig.logoUri}" alt="Logo" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                            ` : ''}
                            <div style="flex: 1;">
                                <h3 style="color: ${brandConfig.primaryColor || '#4CAF50'}; margin-bottom: 10px;">
                                    ${brandConfig.name} (${brandConfig.symbol})
                                </h3>
                                <p style="color: #666; margin-bottom: 10px;">${brandConfig.description || (currentLang === 'zh' ? '暂无描述' : 'No description')}</p>
                                ${brandConfig.websiteUrl ? `
                                    <a href="${brandConfig.websiteUrl}" target="_blank" style="color: ${brandConfig.primaryColor || '#4CAF50'}; text-decoration: none;">
                                        🌐 ${currentLang === 'zh' ? '访问网站' : 'Visit Website'}
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                        <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div>
                                <div style="color: #999; font-size: 12px;">${currentLang === 'zh' ? '订阅者' : 'Subscribers'}</div>
                                <div style="font-size: 20px; font-weight: bold; color: ${brandConfig.primaryColor || '#4CAF50'};">${stats.subscribers}</div>
                            </div>
                            <div>
                                <div style="color: #999; font-size: 12px;">${currentLang === 'zh' ? '总收入' : 'Total Revenue'}</div>
                                <div style="font-size: 20px; font-weight: bold; color: ${brandConfig.primaryColor || '#4CAF50'};">${web3Read.utils.fromWei(stats.totalRevenue, 'ether')} ETH</div>
                            </div>
                            <div>
                                <div style="color: #999; font-size: 12px;">${currentLang === 'zh' ? '活跃订阅' : 'Active'}</div>
                                <div style="font-size: 20px; font-weight: bold; color: ${brandConfig.primaryColor || '#4CAF50'};">${stats.activeSubscriptions}</div>
                            </div>
                        </div>
                    </div>
                `;

                // Check user's subscription status if wallet is connected
                if (accounts.length > 0) {
                    const userSub = await project.methods.getSubscription(accounts[0]).call({ from: '0x0000000000000000000000000000000000000000' }).catch(() => null);

                    const statusDiv = document.getElementById('subscriberSubscriptionStatus');
                    if (userSub && userSub.endTime > Math.floor(Date.now() / 1000)) {
                        const tierNames = brandConfig.tierNames || ['Starter', 'Standard', 'Pro', 'Max'];
                        const periodNames = currentLang === 'zh' ?
                            ['日付', '周付', '月付', '年付'] :
                            ['Daily', 'Weekly', 'Monthly', 'Yearly'];

                        statusDiv.innerHTML = `
                            <div style="background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; padding: 20px; border-radius: 12px;">
                                <h4 style="margin-bottom: 15px;">${currentLang === 'zh' ? '当前订阅' : 'Current Subscription'}</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <div style="opacity: 0.9; font-size: 12px;">${currentLang === 'zh' ? '套餐' : 'Plan'}</div>
                                        <div style="font-size: 18px; font-weight: bold;">${tierNames[userSub.tier]}</div>
                                    </div>
                                    <div>
                                        <div style="opacity: 0.9; font-size: 12px;">${currentLang === 'zh' ? '周期' : 'Period'}</div>
                                        <div style="font-size: 18px; font-weight: bold;">${periodNames[userSub.period]}</div>
                                    </div>
                                    <div>
                                        <div style="opacity: 0.9; font-size: 12px;">${currentLang === 'zh' ? '到期时间' : 'Expires'}</div>
                                        <div style="font-size: 18px; font-weight: bold;">${new Date(userSub.endTime * 1000).toLocaleDateString()}</div>
                                    </div>
                                    <div>
                                        <div style="opacity: 0.9; font-size: 12px;">${currentLang === 'zh' ? '总消费' : 'Total Spent'}</div>
                                        <div style="font-size: 18px; font-weight: bold;">${web3Read.utils.fromWei(userSub.totalSpent, 'ether')} ETH</div>
                                    </div>
                                </div>
                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <button class="btn-secondary" onclick="showSubscriberRenewModal()" style="background: white; color: #4CAF50;">
                                        ${currentLang === 'zh' ? '续费' : 'Renew'}
                                    </button>
                                    ${userSub.tier < brandConfig.maxTier ? `
                                        <button class="btn-secondary" onclick="showSubscriberUpgradeModal()" style="background: white; color: #2196F3;">
                                            ${currentLang === 'zh' ? '升级' : 'Upgrade'}
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    } else if (userSub && userSub.endTime <= Math.floor(Date.now() / 1000) && userSub.tier >= 0) {
                        // Expired subscription
                        statusDiv.innerHTML = `
                            <div style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); color: white; padding: 20px; border-radius: 12px; text-align: center;">
                                <p style="margin-bottom: 15px;">${currentLang === 'zh' ? '您的订阅已过期' : 'Your subscription has expired'}</p>
                                <div style="display: flex; gap: 10px; justify-content: center;">
                                    <button class="btn-primary" onclick="showSubscriberRenewModal()" style="background: white; color: #FF9800;">
                                        ${currentLang === 'zh' ? '续费' : 'Renew'}
                                    </button>
                                    <button class="btn-secondary" onclick="showSubscribeModal()" style="background: white; color: #2196F3;">
                                        ${currentLang === 'zh' ? '选择新计划' : 'Choose New Plan'}
                                    </button>
                                </div>
                            </div>
                        `;
                    } else {
                        // No subscription
                        statusDiv.innerHTML = `
                            <div style="background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%); padding: 20px; border-radius: 12px; text-align: center;">
                                <p style="color: #666; margin-bottom: 15px;">${currentLang === 'zh' ? '您还没有订阅此项目' : 'You have no active subscription'}</p>
                                <button class="btn-primary" onclick="showSubscribeModal()">
                                    ${currentLang === 'zh' ? '立即订阅' : 'Subscribe Now'}
                                </button>
                            </div>
                        `;
                    }
                } else {
                    document.getElementById('subscriberSubscriptionStatus').innerHTML = `
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; color: #856404;">
                            ${currentLang === 'zh' ? '请先连接钱包查看订阅状态' : 'Please connect wallet to view subscription status'}
                        </div>
                    `;
                }

                // Load and display subscription plans
                await loadSubscriptionPlans(project, brandConfig);

                showToast(currentLang === 'zh' ? '项目详情加载成功' : 'Project details loaded', 'success');

            } catch (error) {
                console.error('Error loading project details:', error);
                showToast(currentLang === 'zh' ? '加载项目详情失败' : 'Failed to load project details', 'error');
            }
        }

        async function loadSubscriptionPlans(project, brandConfig) {
            try {
                const plansDiv = document.getElementById('subscriberPlans');
                const tierNames = brandConfig.tierNames || ['Starter', 'Standard', 'Pro', 'Max'];
                const periodNames = currentLang === 'zh' ?
                    ['日付', '周付', '月付', '年付'] :
                    ['Daily', 'Weekly', 'Monthly', 'Yearly'];

                let plansHTML = '<h3 style="margin-bottom: 20px;">' +
                    (currentLang === 'zh' ? '订阅计划' : 'Subscription Plans') + '</h3>';
                plansHTML += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">';

                // Use RPC for reading plans
                const selectedChainId = localStorage.getItem('selectedNetwork') || '8453';
                const rpcUrl = getNetworkRpcUrl(selectedChainId);
                const web3Read = new Web3(new Web3.providers.HttpProvider(rpcUrl));

                // Load all plans
                for (let tier = 0; tier <= brandConfig.maxTier; tier++) {
                    const plan = await project.methods.getPlan(tier).call({ from: '0x0000000000000000000000000000000000000000' });

                    if (plan.enabled) {
                        const tierColor = ['#9E9E9E', '#2196F3', '#9C27B0', '#FF9800'][tier];
                        plansHTML += `
                            <div style="background: white; border: 2px solid ${tierColor}20; border-radius: 12px; padding: 20px; position: relative; overflow: hidden;">
                                <div style="background: linear-gradient(135deg, ${tierColor}15 0%, ${tierColor}05 100%); position: absolute; top: 0; left: 0; right: 0; height: 80px;"></div>
                                <div style="position: relative;">
                                    <h4 style="color: ${tierColor}; margin-bottom: 10px;">${tierNames[tier]}</h4>
                                    <div style="margin-top: 15px;">
                        `;

                        // Display enabled periods and prices
                        let hasEnabledPeriod = false;
                        for (let period = 0; period < 4; period++) {
                            if (brandConfig.enabledPeriods[period] && plan.prices[period] > 0) {
                                hasEnabledPeriod = true;
                                const price = web3Read.utils.fromWei(plan.prices[period], 'ether');
                                plansHTML += `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                        <span style="color: #666;">${periodNames[period]}</span>
                                        <span style="font-weight: bold; color: ${tierColor};">${price} ETH</span>
                                    </div>
                                `;
                            }
                        }

                        if (!hasEnabledPeriod) {
                            plansHTML += `<p style="color: #999; text-align: center;">${currentLang === 'zh' ? '暂无可用周期' : 'No periods available'}</p>`;
                        }

                        // Display features if available
                        if (plan.features && plan.features.length > 0) {
                            plansHTML += '<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0;">';
                            plansHTML += '<div style="color: #999; font-size: 12px; margin-bottom: 8px;">' +
                                (currentLang === 'zh' ? '功能特性' : 'Features') + '</div>';
                            plan.features.forEach(feature => {
                                plansHTML += `<div style="color: #666; font-size: 14px; margin: 5px 0;">✓ ${feature}</div>`;
                            });
                            plansHTML += '</div>';
                        }

                        plansHTML += `
                                    </div>
                                    <button class="btn-primary" onclick="showSubscribeModal(${tier})" style="width: 100%; margin-top: 15px; background: ${tierColor};">
                                        ${currentLang === 'zh' ? '选择此计划' : 'Choose Plan'}
                                    </button>
                                </div>
                            </div>
                        `;
                    }
                }

                plansHTML += '</div>';
                plansDiv.innerHTML = plansHTML;

            } catch (error) {
                console.error('Error loading plans:', error);
            }
        }

        window.showSubscribeModal = function showSubscribeModal(preselectedTier) {
            if (!window.currentSubscriberProject) {
                showToast(currentLang === 'zh' ? '请先连接项目' : 'Please connect to a project first', 'error');
                return;
            }

            // Create subscribe modal
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>${currentLang === 'zh' ? '订阅项目' : 'Subscribe to Project'}</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>${currentLang === 'zh' ? '选择套餐等级' : 'Select Tier'}</label>
                            <select id="subscribeTier" class="form-input">
                                <option value="0" ${preselectedTier === 0 ? 'selected' : ''}>Starter</option>
                                <option value="1" ${preselectedTier === 1 ? 'selected' : ''}>Standard</option>
                                <option value="2" ${preselectedTier === 2 ? 'selected' : ''}>Pro</option>
                                <option value="3" ${preselectedTier === 3 ? 'selected' : ''}>Max</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>${currentLang === 'zh' ? '选择付费周期' : 'Select Period'}</label>
                            <select id="subscribePeriod" class="form-input">
                                <option value="0">${currentLang === 'zh' ? '日付' : 'Daily'}</option>
                                <option value="1">${currentLang === 'zh' ? '周付' : 'Weekly'}</option>
                                <option value="2">${currentLang === 'zh' ? '月付' : 'Monthly'}</option>
                                <option value="3">${currentLang === 'zh' ? '年付' : 'Yearly'}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>${currentLang === 'zh' ? '推荐人地址（可选）' : 'Referrer Address (Optional)'}</label>
                            <input type="text" id="subscribeReferrer" class="form-input" placeholder="0x...">
                            <small style="color: #999;">${currentLang === 'zh' ? '填写推荐人地址可获得返现奖励' : 'Enter referrer address to get cashback rewards'}</small>
                        </div>
                        <div id="subscribePrice" style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px; text-align: center;">
                            <div style="color: #999; font-size: 14px;">${currentLang === 'zh' ? '需支付' : 'Amount to Pay'}</div>
                            <div style="font-size: 24px; font-weight: bold; color: #4CAF50; margin-top: 5px;">-- ETH</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-secondary" onclick="this.closest('.modal').remove()">
                            ${currentLang === 'zh' ? '取消' : 'Cancel'}
                        </button>
                        <button class="btn-primary" onclick="confirmSubscribe()">
                            ${currentLang === 'zh' ? '确认订阅' : 'Confirm Subscribe'}
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Update price when selection changes
            const updatePrice = async () => {
                try {
                    const tier = document.getElementById('subscribeTier').value;
                    const period = document.getElementById('subscribePeriod').value;
                    const selectedChainId = localStorage.getItem('selectedNetwork') || '8453';
                    const rpcUrl = getNetworkRpcUrl(selectedChainId);
                    const web3Read = new Web3(new Web3.providers.HttpProvider(rpcUrl));
                    const project = new web3Read.eth.Contract(PROJECT_ABI, window.currentSubscriberProject);
                    const plan = await project.methods.getPlan(tier).call({ from: '0x0000000000000000000000000000000000000000' });
                    const price = web3Read.utils.fromWei(plan.prices[period], 'ether');
                    document.getElementById('subscribePrice').innerHTML = `
                        <div style="color: #999; font-size: 14px;">${currentLang === 'zh' ? '需支付' : 'Amount to Pay'}</div>
                        <div style="font-size: 24px; font-weight: bold; color: #4CAF50; margin-top: 5px;">${price} ETH</div>
                    `;
                } catch (error) {
                    console.error('Error updating price:', error);
                }
            };

            document.getElementById('subscribeTier').addEventListener('change', updatePrice);
            document.getElementById('subscribePeriod').addEventListener('change', updatePrice);
            updatePrice();
        }

        window.confirmSubscribe = async function confirmSubscribe() {
            try {
                const tier = document.getElementById('subscribeTier').value;
                const period = document.getElementById('subscribePeriod').value;
                const referrer = document.getElementById('subscribeReferrer').value || '0x0000000000000000000000000000000000000000';

                if (referrer !== '0x0000000000000000000000000000000000000000' && !web3.utils.isAddress(referrer)) {
                    showToast(currentLang === 'zh' ? '无效的推荐人地址' : 'Invalid referrer address', 'error');
                    return;
                }

                // Get price using RPC
                const selectedChainId = localStorage.getItem('selectedNetwork') || '8453';
                const rpcUrl = getNetworkRpcUrl(selectedChainId);
                const web3Read = new Web3(new Web3.providers.HttpProvider(rpcUrl));
                const projectRead = new web3Read.eth.Contract(PROJECT_ABI, window.currentSubscriberProject);
                const plan = await projectRead.methods.getPlan(tier).call({ from: '0x0000000000000000000000000000000000000000' });
                const price = plan.prices[period];

                // Use wallet for transaction
                const project = new web3.eth.Contract(PROJECT_ABI, window.currentSubscriberProject);
                await project.methods.subscribe(tier, period, referrer).send({
                    from: accounts[0],
                    value: price
                });

                showToast(currentLang === 'zh' ? '订阅成功！' : 'Subscription successful!', 'success');
                document.querySelector('.modal').remove();
                loadSubscriberProjectDetails(); // Reload to show new subscription status

            } catch (error) {
                console.error('Subscribe error:', error);
                showToast(currentLang === 'zh' ? '订阅失败' : 'Subscription failed', 'error');
            }
        }

        window.showSubscriberRenewModal = function showSubscriberRenewModal() {
            // Similar to showRenewModal but for subscriber section
            showRenewModal();
        }

        window.showSubscriberUpgradeModal = function showSubscriberUpgradeModal() {
            // Similar to showUpgradeModal but for subscriber section
            showUpgradeModal();
        }

        // View network details
        window.viewNetworkDetails = function viewNetworkDetails(chainId) {
            const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
            const network = customNetworks[chainId] || networks[chainId];

            // Default explorer URLs for built-in networks
            const defaultExplorers = {
                '1': 'https://etherscan.io',
                '11155111': 'https://sepolia.etherscan.io',
                '137': 'https://polygonscan.com',
                '56': 'https://bscscan.com',
                '42161': 'https://arbiscan.io',
                '10': 'https://optimistic.etherscan.io',
                '8453': 'https://basescan.org'
            };

            // Default symbols for built-in networks
            const defaultSymbols = {
                '1': 'ETH',
                '11155111': 'ETH',
                '137': 'MATIC',
                '56': 'BNB',
                '42161': 'ETH',
                '10': 'ETH',
                '8453': 'ETH'
            };

            document.getElementById('detailNetworkName').value = network.name || '';
            document.getElementById('detailChainId').value = chainId;
            document.getElementById('detailRpcUrl').value = network.rpc || '';
            document.getElementById('detailCurrencySymbol').value = network.symbol || defaultSymbols[chainId] || 'ETH';
            document.getElementById('detailExplorerUrl').value = network.explorer || defaultExplorers[chainId] || '';

            // Show delete button only for custom networks
            const deleteBtn = document.getElementById('deleteNetworkBtn');
            deleteBtn.style.display = customNetworks[chainId] ? 'block' : 'none';

            // Store current chainId for save/delete operations
            window.currentEditingChainId = chainId;

            document.getElementById('networkDetailsModal').classList.add('active');
        }

        window.closeNetworkDetailsModal = function closeNetworkDetailsModal() {
            document.getElementById('networkDetailsModal').classList.remove('active');
        }

        window.saveNetworkDetails = async function saveNetworkDetails() {
            const chainId = window.currentEditingChainId;
            const name = document.getElementById('detailNetworkName').value;
            const rpc = document.getElementById('detailRpcUrl').value;
            const symbol = document.getElementById('detailCurrencySymbol').value;
            const explorer = document.getElementById('detailExplorerUrl').value;

            if (!name || !rpc || !symbol) {
                showToast(currentLang === 'zh' ? '请填写所有必填字段' : 'Please fill all required fields', 'error');
                return;
            }

            // Update networks object
            networks[chainId] = { name, rpc };

            // Save to localStorage (for both custom and modified built-in networks)
            const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
            customNetworks[chainId] = { name, rpc, symbol, explorer };
            localStorage.setItem('customNetworks', JSON.stringify(customNetworks));

            // Update the dropdown item
            const dropdown = document.getElementById('networkDropdown');
            const items = dropdown.querySelectorAll('.network-item');
            for (let item of items) {
                if (item.onclick && item.onclick.toString().includes(chainId)) {
                    item.querySelector('span').textContent = name;
                    break;
                }
            }

            closeNetworkDetailsModal();
            showToast(currentLang === 'zh' ? '网络详情已更新' : 'Network details updated', 'success');
        }

        window.deleteCustomNetwork = function deleteCustomNetwork() {
            const chainId = window.currentEditingChainId;

            if (confirm(currentLang === 'zh' ? '确定要删除这个网络吗？' : 'Are you sure you want to delete this network?')) {
                // Remove from localStorage
                const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
                delete customNetworks[chainId];
                localStorage.setItem('customNetworks', JSON.stringify(customNetworks));

                // Remove from networks object if it's custom
                if (!['1', '11155111', '137', '56', '42161', '10', '8453'].includes(chainId)) {
                    delete networks[chainId];
                }

                // Remove from dropdown
                const dropdown = document.getElementById('networkDropdown');
                const items = dropdown.querySelectorAll('.network-item');
                for (let item of items) {
                    if (item.onclick && item.onclick.toString().includes(chainId)) {
                        item.remove();
                        break;
                    }
                }

                closeNetworkDetailsModal();
                showToast(currentLang === 'zh' ? '网络已删除' : 'Network deleted', 'success');
            }
        }

        // Function to load custom networks from localStorage
        function loadCustomNetworks() {
            const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
            const dropdown = document.getElementById('networkDropdown');
            const addNetworkBtn = dropdown.querySelector('.add-network-btn');

            for (const [chainId, network] of Object.entries(customNetworks)) {
                // Skip built-in networks that are just modified
                if (['1', '11155111', '137', '56', '42161', '10', '8453'].includes(chainId)) {
                    // Update built-in network info
                    networks[chainId] = { name: network.name, rpc: network.rpc };
                    continue;
                }

                // Add to networks object
                networks[chainId] = { name: network.name, rpc: network.rpc };

                // Create network item for dropdown
                const networkItem = document.createElement('div');
                networkItem.className = 'network-item';
                networkItem.onclick = function () { selectNetwork(chainId, network.name); };
                networkItem.innerHTML = `
                    <span>${network.name}</span>
                    <span style="display: flex; gap: 5px;">
                        <span style="cursor: pointer;" onclick="event.stopPropagation(); viewNetworkDetails('${chainId}')" title="查看详情">👁️</span>
                        <span>🟢</span>
                    </span>
                `;

                // Insert before the "Add Custom Network" button
                dropdown.insertBefore(networkItem, addNetworkBtn);
            }
        }

        // Initialize on page load
        window.addEventListener('load', async () => {
            // Load custom networks from localStorage
            loadCustomNetworks();

            // Add event listener for connect wallet button
            const connectBtn = document.getElementById('connectBtn');
            if (connectBtn) {
                connectBtn.addEventListener('click', connectWallet);
            }

            // Check for URL parameters (for referral links)
            const urlParams = new URLSearchParams(window.location.search);
            const projectParam = urlParams.get('project');
            const refParam = urlParams.get('ref');

            if (projectParam) {
                document.getElementById('subscribeProjectAddress').value = projectParam;
                document.getElementById('browseProjectAddress').value = projectParam;
            }

            if (refParam) {
                document.getElementById('referrerAddress').value = refParam;
            }

            // Auto-connect if MetaMask is available
            if (window.ethereum) {
                const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                if (accounts.length > 0) {
                    connectWallet();
                }
            }
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.network-selector')) {
                document.getElementById('networkDropdown').classList.remove('active');
            }
        });

        // Restore last selected network and Factory address on page load
        window.addEventListener('DOMContentLoaded', function () {
            const savedNetwork = localStorage.getItem('selectedNetwork');
            const savedNetworkName = localStorage.getItem('selectedNetworkName');

            if (savedNetwork && savedNetworkName) {
                document.getElementById('currentNetwork').textContent = savedNetworkName;
                currentChainId = savedNetwork;

                // Load saved Factory address for this network
                const savedFactoryAddress = localStorage.getItem(`factoryAddress_${savedNetwork}`);
                if (savedFactoryAddress) {
                    document.getElementById('globalFactoryAddress').value = savedFactoryAddress;
                    // Auto-connect Factory on page load
                    setTimeout(() => {
                        connectGlobalFactory();
                    }, 1000);
                }

                // Update pricing display with restored network currency
                if (typeof updatePricingDisplay === 'function') {
                    updatePricingDisplay();
                }

                // If network is custom, check if it still exists
                if (!['1', '11155111', '31337'].includes(savedNetwork)) {
                    const customNetworks = JSON.parse(localStorage.getItem('customNetworks') || '{}');
                    if (!customNetworks[savedNetwork]) {
                        // Custom network was deleted, reset to default
                        document.getElementById('currentNetwork').textContent = currentLang === 'zh' ? '选择网络' : 'Select Network';
                        localStorage.removeItem('selectedNetwork');
                        localStorage.removeItem('selectedNetworkName');
                    }
                }
            }
        });
    </script>
</body>

</html>